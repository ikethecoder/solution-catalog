[{"type":"tab","label":"AppRoles","id":"f2855f50.66cd5"},{"id":"eee2546a.4415e8","type":"function","z":"f2855f50.66cd5","name":"get-approles","func":"msg.topic = 'get-approles'\nreturn msg;","outputs":1,"noerr":0,"x":345,"y":74,"wires":[["1c6a34a7.b6311b"]]},{"id":"2b432062.481b6","type":"http in","z":"f2855f50.66cd5","name":"","url":"/approles","method":"get","upload":false,"swaggerDoc":"","x":123,"y":73,"wires":[["eee2546a.4415e8"]]},{"id":"2488aa11.cdae06","type":"http response","z":"f2855f50.66cd5","name":"","x":655,"y":153,"wires":[]},{"id":"ea456020.3ca2e","type":"function","z":"f2855f50.66cd5","name":"get-approle","func":"msg.key = msg.req.params.id;\nmsg.topic = 'get-approle'\nreturn msg;","outputs":1,"noerr":0,"x":346.5,"y":125,"wires":[["1c6a34a7.b6311b"]]},{"id":"ae104e51.3aa27","type":"http in","z":"f2855f50.66cd5","name":"","url":"/approle/:id","method":"get","swaggerDoc":"","x":124.5,"y":124,"wires":[["ea456020.3ca2e"]]},{"id":"bac35810.b73bd8","type":"function","z":"f2855f50.66cd5","name":"put-approle","func":"msg.key = msg.req.params.id;\nmsg.topic = 'put-approle'\nreturn msg;","outputs":1,"noerr":0,"x":345.5,"y":175,"wires":[["60bd9124.bfb8e"]]},{"id":"ee56764b.12c918","type":"http in","z":"f2855f50.66cd5","name":"","url":"/approle/:id","method":"put","swaggerDoc":"","x":123.5,"y":174,"wires":[["bac35810.b73bd8"]]},{"id":"51822a49.d30e14","type":"function","z":"f2855f50.66cd5","name":"delete-approle","func":"msg.key = msg.req.params.id;\nmsg.topic = 'delete-approle'\nreturn msg;","outputs":1,"noerr":0,"x":354.5,"y":225,"wires":[["1c6a34a7.b6311b"]]},{"id":"87e918f1.260e88","type":"http in","z":"f2855f50.66cd5","name":"","url":"/approle/:id","method":"delete","swaggerDoc":"","x":131.5,"y":225,"wires":[["51822a49.d30e14"]]},{"id":"60bd9124.bfb8e","type":"debug","z":"f2855f50.66cd5","name":"","active":true,"console":"false","complete":"false","x":660.5,"y":93,"wires":[]},{"id":"1c6a34a7.b6311b","type":"subflow:d773a612.5b2d98","z":"f2855f50.66cd5","x":512.5,"y":47,"wires":[["2488aa11.cdae06"]],"subflow":"d773a612.5b2d98"},{"type":"tab","label":"Canzea","id":"22e92ae6.851136"},{"id":"20bc93b6.437eec","type":"websocket in","z":"22e92ae6.851136","name":"","server":"7138d6b8.dc7bc8","client":"","x":141,"y":139,"wires":[["8ce3041c.bc6c88"]]},{"id":"d256768d.b28aa8","type":"websocket out","z":"22e92ae6.851136","name":"","server":"7138d6b8.dc7bc8","client":"","x":596,"y":144,"wires":[]},{"id":"16fd14e9.bbba3b","type":"cron","z":"22e92ae6.851136","name":"Every 5 seconds","crontab":"*/5 * * * * *","x":296,"y":75,"wires":[["62ee61e5.5c3f3","d256768d.b28aa8"]]},{"id":"62ee61e5.5c3f3","type":"debug","z":"22e92ae6.851136","name":"","active":false,"console":"false","complete":"true","x":493,"y":77,"wires":[]},{"id":"8ce3041c.bc6c88","type":"debug","z":"22e92ae6.851136","name":"","active":true,"console":"false","complete":"true","x":302.5,"y":139,"wires":[]},{"id":"e0610052.145a","type":"http in","z":"22e92ae6.851136","name":"","url":"/gateway/:resource","method":"post","swaggerDoc":"","x":137.5,"y":238,"wires":[["f97483df.3a3b8"]]},{"id":"f97483df.3a3b8","type":"json-schema","z":"22e92ae6.851136","name":"","func":"{\n    \"$schema\": \"http://json-schema.org/draft-04/schema#\",\n    \"title\": \"Resources\",\n    \"type\": \"object\",\n    \"properties\": {\n        \"collaboration_channel\": {\n            \"description\": \"Channel\",\n            \"type\": \"object\",\n            \"properties\": {\n                \"name\": {\n                    \"type\": \"string\"\n                }\n            },\n            \"required\": [\"name\"]\n        },\n        \"pipeline_environment\": {\n            \"description\": \"Pipeline Environment\",\n            \"type\": \"object\",\n            \"properties\": {\n                \"name\": {\n                    \"type\": \"string\"\n                }\n            },\n            \"required\": [\"name\"]\n        },\n        \"service_discovery_service\": {\n            \"description\": \"Service Discovery Service\",\n            \"type\": \"object\",\n            \"properties\": {\n                \"Name\": {\n                    \"type\": \"string\"\n                },\n                \"ID\": {\n                    \"type\": \"string\"\n                },\n                \"Address\": {\n                    \"type\": \"string\"\n                },\n                \"Port\": {\n                    \"type\": \"number\"\n                },\n                \"Tags\": {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"type\": \"string\"\n                    }\n                },\n                \"Check\": {\n                    \"type\": \"object\",\n                    \"properties\": {\n                        \"http\": {\n                            \"type\": \"string\"\n                        },\n                        \"interval\": {\n                            \"type\": \"string\"\n                        },\n                        \"timeout\": {\n                            \"type\": \"string\"\n                        }\n                    }\n                }\n                \n            },\n            \"required\": [\"Name\"]\n        }\n    }\n}\n","x":118.5,"y":316,"wires":[["7366cbdf.1b04d4"]]},{"id":"8d118121.b6063","type":"http response","z":"22e92ae6.851136","name":"","x":554.5,"y":297,"wires":[]},{"id":"7366cbdf.1b04d4","type":"function","z":"22e92ae6.851136","name":"Set Topic","func":"msg.topic = \"plus:\" + msg.req.params.resource;\nreturn msg;","outputs":1,"noerr":0,"x":276.5,"y":297,"wires":[["23b4138d.0e2ecc"]]},{"id":"bcdf6bf.9dc8f98","type":"http in","z":"22e92ae6.851136","name":"","url":"/bulk","method":"post","swaggerDoc":"","x":126.5,"y":580,"wires":[["cf74e76a.902498"]]},{"id":"cf74e76a.902498","type":"function","z":"22e92ae6.851136","name":"","func":"msg.payload = msg.payload.resources;\nreturn msg;","outputs":1,"noerr":0,"x":282.5,"y":580,"wires":[["522bb079.16564"]]},{"id":"522bb079.16564","type":"split","z":"22e92ae6.851136","name":"","splt":"\\n","x":405.5,"y":581,"wires":[["eb7cc7e7.9fa348"]]},{"id":"e2544175.29e6f","type":"join","z":"22e92ae6.851136","name":"","mode":"auto","build":"string","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","timeout":"","count":"","x":868.5,"y":581,"wires":[["44adc81b.841fa8"]]},{"id":"48ce6537.6d251c","type":"http response","z":"22e92ae6.851136","name":"","x":1145,"y":621,"wires":[]},{"id":"23b4138d.0e2ecc","type":"subflow:9e3e25e6.0e0308","z":"22e92ae6.851136","x":419.5,"y":297,"wires":[["8d118121.b6063"]],"subflow":"9e3e25e6.0e0308"},{"id":"2c371cb3.f910b4","type":"subflow:9e3e25e6.0e0308","z":"22e92ae6.851136","x":737,"y":581,"wires":[["e2544175.29e6f"]],"subflow":"9e3e25e6.0e0308"},{"id":"eb7cc7e7.9fa348","type":"function","z":"22e92ae6.851136","name":"Set Topic","func":"action = 'plus'; // plus | minus\nk = Object.keys(msg.payload)[0];\nmsg.topic = action + \":\" + k;\nreturn msg;","outputs":1,"noerr":0,"x":544.5,"y":581,"wires":[["2c371cb3.f910b4"]]},{"id":"284b75e8.d813ca","type":"http in","z":"22e92ae6.851136","name":"","url":"/bulk","method":"delete","swaggerDoc":"","x":128,"y":625,"wires":[["dea7045c.7c69f8"]]},{"id":"dea7045c.7c69f8","type":"function","z":"22e92ae6.851136","name":"","func":"msg.payload = msg.payload.resources;\nreturn msg;","outputs":1,"noerr":0,"x":285,"y":626,"wires":[["d7dc9c41.ea694"]]},{"id":"d7dc9c41.ea694","type":"split","z":"22e92ae6.851136","name":"","splt":"\\n","x":411,"y":626,"wires":[["f965c608.a823d8"]]},{"id":"f965c608.a823d8","type":"function","z":"22e92ae6.851136","name":"Set Topic","func":"action = 'minus'; // plus | minus\nk = Object.keys(msg.payload)[0];\nmsg.topic = action + \":\" + k;\nreturn msg;","outputs":1,"noerr":0,"x":542,"y":625,"wires":[["2c371cb3.f910b4"]]},{"id":"9d48781c.0b9d88","type":"http in","z":"22e92ae6.851136","name":"","url":"/check","method":"post","swaggerDoc":"","x":128,"y":535,"wires":[["5a8fa2f8.d872fc"]]},{"id":"5a8fa2f8.d872fc","type":"function","z":"22e92ae6.851136","name":"","func":"msg.payload = msg.payload.resources;\nreturn msg;","outputs":1,"noerr":0,"x":284,"y":535,"wires":[["77b52971.527168"]]},{"id":"77b52971.527168","type":"split","z":"22e92ae6.851136","name":"","splt":"\\n","x":407,"y":536,"wires":[["41fe63c1.86f22c"]]},{"id":"41fe63c1.86f22c","type":"function","z":"22e92ae6.851136","name":"Set Topic","func":"action = 'check'; // plus | minus\nk = Object.keys(msg.payload)[0];\nmsg.topic = action + \":\" + k;\nreturn msg;","outputs":1,"noerr":0,"x":546,"y":536,"wires":[["2c371cb3.f910b4"]]},{"id":"e2e30c43.2d5af","type":"http in","z":"22e92ae6.851136","name":"","url":"/gateway/:resource/:id","method":"delete","swaggerDoc":"","x":154,"y":448,"wires":[["2c05a2e0.4edeee"]]},{"id":"2c05a2e0.4edeee","type":"function","z":"22e92ae6.851136","name":"Set Topic","func":"msg.topic = \"minus:\" + msg.req.params.resource;\nreturn msg;","outputs":1,"noerr":0,"x":382,"y":449,"wires":[[]]},{"id":"44adc81b.841fa8","type":"function","z":"22e92ae6.851136","name":"","func":"msg.statusCode = 200;\nreturn msg;","outputs":1,"noerr":0,"x":1015.5,"y":622,"wires":[["48ce6537.6d251c"]]},{"id":"138d9c21.257f14","type":"http in","z":"22e92ae6.851136","name":"","url":"/bulk/list","method":"post","upload":false,"swaggerDoc":"","x":139,"y":495,"wires":[["42375c69.f6b844"]]},{"id":"42375c69.f6b844","type":"function","z":"22e92ae6.851136","name":"","func":"msg.payload = msg.payload.resources;\nreturn msg;","outputs":1,"noerr":0,"x":285,"y":495,"wires":[["36f9fb5a.ab77c4"]]},{"id":"36f9fb5a.ab77c4","type":"split","z":"22e92ae6.851136","name":"","splt":"\\n","x":408,"y":496,"wires":[["4bf75e2.2032fa"]]},{"id":"4bf75e2.2032fa","type":"function","z":"22e92ae6.851136","name":"Set Topic","func":"action = 'list'; // plus | minus\nk = Object.keys(msg.payload)[0];\nmsg.topic = action + \":\" + k;\nreturn msg;","outputs":1,"noerr":0,"x":547,"y":496,"wires":[["2c371cb3.f910b4"]]},{"id":"7b4142f.27fa9bc","type":"http in","z":"22e92ae6.851136","name":"","url":"/minus","method":"post","upload":false,"swaggerDoc":"","x":127,"y":672,"wires":[["dea7045c.7c69f8"]]},{"type":"tab","label":"Components","id":"794773f5.e7838c"},{"id":"ef7d8a1d.9d3968","type":"http in","z":"794773f5.e7838c","name":"","url":"/components","method":"post","swaggerDoc":"","x":137,"y":91,"wires":[["f8cbf808.cfb9c8"]]},{"id":"f8cbf808.cfb9c8","type":"json-schema","z":"794773f5.e7838c","name":"","func":"{\n    \"$schema\": \"http://json-schema.org/draft-04/schema#\",\n    \"title\": \"Component\",\n    \"type\": \"object\",\n    \"properties\": {\n        \"name\": {\n            \"description\": \"Name of the component\",\n            \"type\": \"string\"\n        },\n        \"url\": {\n            \"description\": \"URL\",\n            \"type\": \"string\"\n        },\n        \"branch\": {\n            \"description\": \"Branch\",\n            \"type\": \"string\"\n        },\n        \"version\": {\n            \"description\": \"Current version on the branch\",\n            \"type\": \"string\"\n        }\n    },\n    \"required\": [\"name\", \"url\", \"branch\", \"version\"]\n}","x":383,"y":91,"wires":[["d934c3b0.c1072"]]},{"id":"b5e9cb35.52c2a8","type":"subflow:ea5122d7.76e78","z":"794773f5.e7838c","name":"","x":637.125,"y":121,"wires":[["2698baa5.ab36a6"]],"subflow":"ea5122d7.76e78"},{"id":"2698baa5.ab36a6","type":"http response","z":"794773f5.e7838c","name":"","x":735.625,"y":212,"wires":[]},{"id":"e20ec5b3.387458","type":"catch","z":"794773f5.e7838c","name":"","scope":null,"x":175.5,"y":271,"wires":[["2cc83ee2.394222"]]},{"id":"2cc83ee2.394222","type":"function","z":"794773f5.e7838c","name":"Error","func":"msg.payload = {\n    \"error\": (msg.error ? msg.error : msg.message)\n};\nmsg.statusCode = 400;\nreturn msg;","outputs":1,"noerr":0,"x":333,"y":271,"wires":[["2698baa5.ab36a6"]]},{"id":"13398b31.8d67e5","type":"http in","z":"794773f5.e7838c","name":"","url":"/analyze","method":"post","swaggerDoc":"","x":127,"y":146,"wires":[["323eb9b5.762b76","1b6ace2c.0fd502"]]},{"id":"323eb9b5.762b76","type":"json-schema","z":"794773f5.e7838c","name":"","func":"{\n    \"$schema\": \"http://json-schema.org/draft-04/schema#\",\n    \"title\": \"Component\",\n    \"type\": \"object\",\n    \"properties\": {\n        \"name\": {\n            \"description\": \"Name of the component\",\n            \"type\": \"string\"\n        },\n        \"sourceRepo\": {\n            \"description\": \"URL\",\n            \"type\": \"string\"\n        },\n        \"branch\": {\n            \"description\": \"Branch\",\n            \"type\": \"string\"\n        },\n        \"credential_resource\": {\n            \"description\": \"Credentials for project.\",\n            \"type\": \"string\"\n        }\n    },\n    \"required\": [\"name\", \"sourceRepo\"]\n}","x":331,"y":146,"wires":[["cf8d2e6f.747d"]]},{"id":"cf8d2e6f.747d","type":"function","z":"794773f5.e7838c","name":"","func":"msg.topic = 'analyze-project';\nreturn msg;","outputs":1,"noerr":0,"x":482.5,"y":146,"wires":[["b5e9cb35.52c2a8"]]},{"id":"d934c3b0.c1072","type":"function","z":"794773f5.e7838c","name":"add-component","func":"msg.topic = 'add-component';\nreturn msg;","outputs":1,"noerr":0,"x":461,"y":50,"wires":[["b5e9cb35.52c2a8"]]},{"id":"1b6ace2c.0fd502","type":"debug","z":"794773f5.e7838c","name":"","active":true,"console":"false","complete":"false","x":296.5,"y":187,"wires":[]},{"id":"fd0889cf.48ed78","type":"http in","z":"794773f5.e7838c","name":"","url":"/all_components","method":"get","swaggerDoc":"","x":150,"y":420,"wires":[["19fcc784.487d28"]]},{"id":"19fcc784.487d28","type":"function","z":"794773f5.e7838c","name":"list-components","func":"msg.payload = {\"key\" : 'components?recurse=true'}\nmsg.topic = 'list-components'\nreturn msg;","outputs":1,"noerr":0,"x":357,"y":499,"wires":[["c9e33065.9f497"]]},{"id":"c9e33065.9f497","type":"subflow:a6b9a798.463af8","z":"794773f5.e7838c","x":537,"y":499,"wires":[["9f408973.e3c128"]],"subflow":"a6b9a798.463af8"},{"id":"a32a621d.11e1a","type":"http response","z":"794773f5.e7838c","name":"","x":724,"y":499,"wires":[]},{"id":"9f408973.e3c128","type":"function","z":"794773f5.e7838c","name":"Parse","func":"p = msg.payload\n\nif (msg.statusCode == 200) {\n    \n    out = {};\n    for ( var i = 0; i < p.length; i++) {\n        d = p[i];\n        val = Buffer.from(\"\"+d['Value'], 'base64').toString('utf8');\n    \n        keys = d.Key.split('/')\n        node = out;\n        for ( var k = 0; k < keys.length - 1; k++) {\n            if (node.hasOwnProperty(keys[k])) {\n                node = node[keys[k]];\n            } else {\n                node = node[keys[k]] = {}\n            }\n        }\n        node[keys[keys.length-1]] = val;\n    }\n}\n\nmsg.payload = out\nreturn msg;","outputs":1,"noerr":0,"x":728,"y":441,"wires":[["a32a621d.11e1a","29e31c9d.a0cdd4"]]},{"id":"29e31c9d.a0cdd4","type":"debug","z":"794773f5.e7838c","name":"","active":true,"console":"false","complete":"false","x":762.5,"y":553,"wires":[]},{"type":"tab","label":"Export Flows","id":"e643c992.30bf48"},{"id":"804bc58.5f2f338","type":"subflow:9223e50a.f92628","z":"e643c992.30bf48","x":342.3333435058594,"y":119.44444274902344,"wires":[["86db2614.109ef8"]],"subflow":"9223e50a.f92628"},{"id":"18b981e3.d65c5e","type":"inject","z":"e643c992.30bf48","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":149.5,"y":119,"wires":[["804bc58.5f2f338"]]},{"id":"86db2614.109ef8","type":"debug","z":"e643c992.30bf48","name":"","active":true,"console":"false","complete":"false","x":540.5,"y":120,"wires":[]},{"id":"aeb0c9df.0e1318","type":"http in","z":"e643c992.30bf48","name":"","url":"/export_flows","method":"get","swaggerDoc":"","x":129.00000762939453,"y":207.00000190734863,"wires":[["a95a4ebe.9a328"]]},{"id":"a95a4ebe.9a328","type":"subflow:9223e50a.f92628","z":"e643c992.30bf48","x":370.0555623372395,"y":207.55555894639758,"wires":[["f19ce22e.e02a7"]],"subflow":"9223e50a.f92628"},{"id":"56bfe2c8.1f579c","type":"http in","z":"e643c992.30bf48","name":"","url":"/export_grafana","method":"get","swaggerDoc":"","x":139.5,"y":257.5555419921875,"wires":[[]]},{"id":"9dded12f.d544a","type":"http response","z":"e643c992.30bf48","name":"","x":611.5,"y":348,"wires":[]},{"id":"700a035c.b926ac","type":"http in","z":"e643c992.30bf48","name":"","url":"/file/:id","method":"get","swaggerDoc":"","x":126,"y":345,"wires":[["6e24002f.b58b3"]]},{"id":"ca7600d3.8aa78","type":"http response","z":"e643c992.30bf48","name":"","x":676,"y":240,"wires":[]},{"id":"6e24002f.b58b3","type":"function","z":"e643c992.30bf48","name":"Set Filename","func":"msg.filename = \"/home/pm2user/.ecosystem-catalog/catalog/flows-\" + msg.req.params.id + \".zip\"\nmsg.headers = {\n    \"Content-Type\": \"application/octet-stream\"\n}\nreturn msg;","outputs":1,"noerr":0,"x":308,"y":348,"wires":[["8b4dc32e.99841"]]},{"id":"8b4dc32e.99841","type":"file in","z":"e643c992.30bf48","name":"","filename":"","format":"","x":469,"y":348,"wires":[["9dded12f.d544a"]]},{"id":"f19ce22e.e02a7","type":"function","z":"e643c992.30bf48","name":"","func":"msg.payload = {\n    \"file-id\": msg.payload.trim()\n}\nreturn msg;","outputs":1,"noerr":0,"x":541.5,"y":239,"wires":[["ca7600d3.8aa78"]]},{"type":"tab","label":"Go.CD Tester","id":"fa7a1c9e.59a6a"},{"id":"e0413da6.d43c1","type":"subflow:357b5975.8ef876","z":"fa7a1c9e.59a6a","x":430,"y":120,"wires":[["6fe113cb.6b4c2c"]],"subflow":"357b5975.8ef876"},{"id":"f13a4d41.53c84","type":"inject","z":"fa7a1c9e.59a6a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":140,"y":120,"wires":[["ed361800.e0d1a8"]]},{"id":"ed361800.e0d1a8","type":"function","z":"fa7a1c9e.59a6a","name":"Check","func":"msg.key = \"hello-world-1\"\nmsg.topic = \"check:pipeline_pipeline\"\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":120,"wires":[["e0413da6.d43c1"]]},{"id":"6fe113cb.6b4c2c","type":"debug","z":"fa7a1c9e.59a6a","name":"","active":true,"console":"false","complete":"true","x":610,"y":120,"wires":[]},{"id":"87db5e85.4ba8c","type":"subflow:357b5975.8ef876","z":"fa7a1c9e.59a6a","name":"","x":430,"y":200,"wires":[["9fd5f191.6c6b2"]],"subflow":"357b5975.8ef876"},{"id":"f76cc6b4.36b348","type":"inject","z":"fa7a1c9e.59a6a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":140,"y":200,"wires":[["dc77c764.6e6818"]]},{"id":"dc77c764.6e6818","type":"function","z":"fa7a1c9e.59a6a","name":"Plus","func":"msg.key = \"hello-world-1\"\nmsg.topic = \"plus:pipeline_pipeline\"\nmsg.payload = { \"group\": \"defaultGroup\",\n  \"pipeline\": {\n    \"label_template\": \"${COUNT}\",\n    \"enable_pipeline_locking\": true,\n    \"name\": \"hello-world-1\",\n    \"template\": null,\n    \"materials\": [\n\n      {\n        \"type\": \"git\",\n        \"attributes\": {\n          \"url\": \"http://localhost/root/hello-world-svc-app.git\",\n          \"destination\": \"hello-world-svc-app\",\n          \"filter\": null,\n          \"name\": null,\n          \"auto_update\": true,\n          \"branch\": \"master\",\n          \"submodule_folder\": null,\n          \"shallow_clone\": true\n        }\n      }\n\n    ],\n    \"stages\": [\n      {\n        \"name\": \"Build\",\n        \"fetch_materials\": true,\n        \"clean_working_directory\": false,\n        \"never_cleanup_artifacts\": false,\n        \"approval\": {\n          \"type\": \"success\",\n          \"authorization\": {\n            \"roles\": [],\n            \"users\": []\n          }\n        },\n        \"environment_variables\": [],\n        \"jobs\": [\n          {\n            \"name\": \"defaultJob\",\n            \"run_instance_count\": null,\n            \"timeout\": 0,\n            \"environment_variables\": [],\n            \"resources\": [],\n            \"tasks\": [\n              {\n                \"type\": \"exec\",\n                \"attributes\": {\n                  \"run_if\": [\n                    \"passed\"\n                  ],\n                  \"command\": \"ls\",\n                  \"working_directory\": null\n                }\n              },\n              {\n                \"type\": \"exec\",\n                \"attributes\": {\n                  \"run_if\": [\n                    \"passed\"\n                  ],\n                  \"command\": \"mvn\",\n                  \"arguments\": [ \"clean\", \"install\" ],\n                  \"working_directory\": \"hello-world-svc-app\"\n                }\n              }\n            ]\n          }\n        ]\n      },\n      {\n        \"name\": \"Deploy\",\n        \"fetch_materials\": true,\n        \"clean_working_directory\": false,\n        \"never_cleanup_artifacts\": false,\n        \"approval\": {\n          \"type\": \"success\",\n          \"authorization\": {\n            \"roles\": [],\n            \"users\": []\n          }\n        },\n        \"environment_variables\": [],\n        \"jobs\": [\n          {\n            \"name\": \"defaultJob\",\n            \"run_instance_count\": null,\n            \"timeout\": 0,\n            \"environment_variables\": [],\n            \"resources\": [],\n            \"tasks\": [\n              {\n                \"type\": \"exec\",\n                \"attributes\": {\n                  \"run_if\": [\n                    \"passed\"\n                  ],\n                  \"command\": \"mvn\",\n                  \"arguments\": [\n                    \"deploy\",\n                    \"-DaltDeploymentRepository=snapshotRepository::default::http://localhost:9080/repository/snapshots\"\n                  ],\n                  \"working_directory\": \"hello-world-svc-app\"\n                }\n              }\n            ]\n          }\n        ]\n      }\n    ]\n  }\n}\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":200,"wires":[["87db5e85.4ba8c"]]},{"id":"9fd5f191.6c6b2","type":"debug","z":"fa7a1c9e.59a6a","name":"","active":true,"console":"false","complete":"true","x":570,"y":200,"wires":[]},{"id":"33b98003.95e8b","type":"subflow:357b5975.8ef876","z":"fa7a1c9e.59a6a","x":430,"y":280,"wires":[["d534495c.97f0f8"]],"subflow":"357b5975.8ef876"},{"id":"f5dd2832.3df388","type":"inject","z":"fa7a1c9e.59a6a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":140,"y":280,"wires":[["99b8aa33.ff8988"]]},{"id":"99b8aa33.ff8988","type":"function","z":"fa7a1c9e.59a6a","name":"Minus","func":"msg.key = \"hello-world-1\"\nmsg.topic = \"minus:pipeline_pipeline\"\n\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":280,"wires":[["33b98003.95e8b"]]},{"id":"d534495c.97f0f8","type":"debug","z":"fa7a1c9e.59a6a","name":"","active":true,"console":"false","complete":"true","x":570,"y":280,"wires":[]},{"type":"tab","label":"Go.CD","id":"5e4f6959.449008"},{"id":"f1eff82e.669eb8","type":"websocket in","z":"5e4f6959.449008","name":"Go.CD Listener","server":"","client":"692f4929.e69968","x":122.5,"y":110,"wires":[["73b83f6b.fddcc","9a02eba1.c6e438","cc669faf.2e0c7"]]},{"id":"73b83f6b.fddcc","type":"debug","z":"5e4f6959.449008","name":"","active":false,"console":"false","complete":"false","x":340.5,"y":110,"wires":[]},{"id":"9a02eba1.c6e438","type":"file","z":"5e4f6959.449008","name":"","filename":"/home/pm2user/nodered-gocd-events.log","appendNewline":true,"createDir":false,"overwriteFile":"false","x":404.5,"y":194,"wires":[]},{"id":"1121eaa0.f82f15","type":"function","z":"5e4f6959.449008","name":"","func":"msg.payload = JSON.stringify(msg.payload, null, 3);\nreturn msg;","outputs":1,"noerr":0,"x":298.5,"y":271,"wires":[["242fd676.a865aa"]]},{"id":"242fd676.a865aa","type":"file","z":"5e4f6959.449008","name":"","filename":"/home/pm2user/nodered-gocd-last-message.log","appendNewline":true,"createDir":false,"overwriteFile":"true","x":568,"y":273,"wires":[]},{"id":"cc669faf.2e0c7","type":"json","z":"5e4f6959.449008","name":"","x":107.5,"y":337,"wires":[["1121eaa0.f82f15","9bc3721e.c859a"]]},{"id":"278a0945.6ceb96","type":"template","z":"5e4f6959.449008","name":"Build Document","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\n    \"@timestamp\":\"{{payload.ts}}\",\n    \"group\":\"{{payload.pipeline.group}}\",\n    \"counter\":\"{{payload.pipeline.counter}}\",\n    \"stage\":\"{{payload.pipeline.stage.name}}\",\n    \"state\":\"{{payload.pipeline.stage.state}}\",\n    \"ts\":\"{{payload.pipeline.stage.last-transition-time}}\",\n    \"message\":\"{{payload.pipeline.name}}\",\n    \"label\":\"{{payload.x-pipeline-instance-details.label}}\",\n    \"pipeline\":\"{{payload.pipeline.name}}\"\n}\n","output":"json","x":292.5,"y":590,"wires":[["6039f470.059b3c","d4fc044.2dc4ff8","ab8a608f.dfdef"]]},{"id":"6039f470.059b3c","type":"es-create","z":"5e4f6959.449008","name":"","documentIndex":"ecosystem","documentType":"new","server":"c636bc4a.a28ab","x":770,"y":540,"wires":[[]]},{"id":"9bc3721e.c859a","type":"function","z":"5e4f6959.449008","name":"Set TS","func":"\nvar lastts = msg.payload.pipeline.stage['last-transition-time'];\nvar ts = msg.payload.pipeline.stage['create-time'];\nts = ts.substr(0, ts.indexOf('.'));\nmsg.payload.ts = ts;\nmsg.payload.lastts = lastts;\nmsg.documentId = msg._msgid;\nreturn msg;\n","outputs":1,"noerr":0,"x":127.5,"y":590,"wires":[["278a0945.6ceb96","80fb0b03.7d4a28"]]},{"id":"c78f054d.0b5938","type":"catch","z":"5e4f6959.449008","name":"","scope":null,"x":300,"y":400,"wires":[["80fb0b03.7d4a28"]]},{"id":"80fb0b03.7d4a28","type":"debug","z":"5e4f6959.449008","name":"","active":true,"console":"false","complete":"true","x":310,"y":460,"wires":[]},{"id":"ab8a608f.dfdef","type":"switch","z":"5e4f6959.449008","name":"","property":"payload.state","propertyType":"msg","rules":[{"t":"eq","v":"Building","vt":"str"},{"t":"eq","v":"Passed","vt":"str"},{"t":"eq","v":"Failed","vt":"str"},{"t":"eq","v":"Cancelled","vt":"str"},{"t":"else"}],"checkall":"true","outputs":5,"x":447.5,"y":692,"wires":[["50f4be4e.a912b"],["50f4be4e.a912b","b8f59824.c1f1b8"],["50f4be4e.a912b"],["50f4be4e.a912b"],["50f4be4e.a912b"]]},{"id":"4416833c.84bd9c","type":"subflow:459ae946.b59388","z":"5e4f6959.449008","name":"","x":820.5,"y":688,"wires":[[]],"subflow":"459ae946.b59388"},{"id":"50f4be4e.a912b","type":"function","z":"5e4f6959.449008","name":"","func":"p = msg.payload;\nmsg.channel = 'general';\nmsg.payload = \"Pipeline \" + p.state;\n\ncolors = {\n    'Passed' : '#00ff00',\n    'Building' : '#0000ff',\n    'Failed' : '#ff0000',\n    'Cancelled' : '#ff00ff'\n};\ncolor = colors[p.state];\n\ntextmsgs = [\n    \"** >\" + p.pipeline + '**\\n',\n    \"STAGE: **\" + p.stage + '**',\n    \"BUILD: **\" + p.label + '**'\n];\n\nmsg.topic = 'send-message';\nmsg.payload = {\n    \"text\": msg.payload,\n    \"avatar\": \"https://es0390.canzea.cc/images/canzea_gw_icon_es.svg\",\n    \"attachments\": [{\n        \"color\": color,\n        \"text\": textmsgs.join('\\n')\n    }]\n};\nreturn msg;\n","outputs":1,"noerr":0,"x":600.5,"y":689,"wires":[["4416833c.84bd9c"]]},{"id":"b8f59824.c1f1b8","type":"function","z":"5e4f6959.449008","name":"Update COMPONENT","func":"msg.topic = \"plus:component_metadata\";\n\nevent = msg.payload;\n\nresId = event.group +\"/pipelines/\" + event.pipeline;\nmsg.payload = { \"component_metadata\": {}}\n\nmsg.payload['component_metadata'][resId] = {\n      \"lastDeploy\": event.ts,\n      \"version\": event.label\n};\n\nreturn msg;","outputs":1,"noerr":0,"x":500,"y":820,"wires":[["7d43245.19bf6dc"]]},{"id":"7d43245.19bf6dc","type":"subflow:9e3e25e6.0e0308","z":"5e4f6959.449008","x":708.5,"y":819,"wires":[["f7ed093b.85ffb8"]],"subflow":"9e3e25e6.0e0308"},{"id":"f7ed093b.85ffb8","type":"debug","z":"5e4f6959.449008","name":"","active":true,"console":"false","complete":"true","x":867.5,"y":821,"wires":[]},{"id":"7cc08be9.3b68b4","type":"es-create","z":"5e4f6959.449008","name":"","documentIndex":"ecosystem_looking_glass","documentType":"new","server":"c636bc4a.a28ab","x":1210,"y":640,"wires":[[]]},{"id":"d4fc044.2dc4ff8","type":"function","z":"5e4f6959.449008","name":"","func":"msg.temp = msg.payload;\nmsg.payload = {\"key\": \"components/\" + msg.temp['group'] + \"/?recurse=true\"};\nmsg.topic = 'list-components';\nreturn msg;\n","outputs":1,"noerr":0,"x":710,"y":640,"wires":[["2a52783e.3b4098"]]},{"id":"2a52783e.3b4098","type":"subflow:a6b9a798.463af8","z":"5e4f6959.449008","name":"","x":880,"y":640,"wires":[["44a56020.083f1"]],"subflow":"a6b9a798.463af8"},{"id":"44a56020.083f1","type":"function","z":"5e4f6959.449008","name":"","func":"payload = msg.temp;\n\ntry {\ncomponentKey = \"components/\" + msg.temp['group'] + \"/\";\n\nstartKey = \"pipelines/\" + msg.temp['pipeline'];\n\n\nfor ( var i in msg.payload ) {\n    var key = msg.payload[i]['Key'];\n\n    var encval = msg.payload[i]['Value'];\n    \n    if (encval !== null) {\n        var val = new Buffer(encval, 'base64').toString('utf8');\n        key = key.slice(componentKey.length);\n\n        if (key.startsWith('versioning')) {\n            // do nothing\n        } else\n        if (key.startsWith('pipelines')) {\n            if (key.startsWith(startKey)) {\n                var k = key.slice(startKey.length);\n                payload['pipeline' + k] = val;\n            }\n        } else {\n            payload['component/' + key] = val;\n        }\n    }\n}\n\nmsg.payload = payload;\n\n    \n} catch (e) {\n  node.error(\"Error\");\n  node.error(e);\n  raise (e);\n}\nreturn msg;","outputs":1,"noerr":0,"x":1050,"y":640,"wires":[["7cc08be9.3b68b4","fcd53f06.919c1"]]},{"id":"fcd53f06.919c1","type":"debug","z":"5e4f6959.449008","name":"","active":true,"console":"false","complete":"false","x":1218.5,"y":578,"wires":[]},{"type":"tab","label":"Hello World","id":"886c5c4e.9e8cd"},{"id":"a7d9dd62.50bbc","type":"http in","z":"886c5c4e.9e8cd","name":"","url":"/bounce","method":"post","swaggerDoc":"","x":110,"y":80,"wires":[["cdea1387.fb334"]]},{"id":"cdea1387.fb334","type":"function","z":"886c5c4e.9e8cd","name":"","func":"msg.payload = \"hi\"\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":80,"wires":[["20526f0f.db87c"]]},{"id":"20526f0f.db87c","type":"http response","z":"886c5c4e.9e8cd","name":"","x":510,"y":80,"wires":[]},{"id":"692f4929.e69968","type":"websocket-client","z":"","path":"ws://gocd.service.dc1.consul:8887","wholemsg":"false","_users":["f1eff82e.669eb8"]},{"id":"d8eec1bf.7984a","type":"ui_base","theme":{"name":"theme-dark","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"Helvetica Neue","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"customTheme":{"name":"","default":"#4B7930","baseColor":"#4B7930","baseFont":"Helvetica Neue"},"themeState":{"base-color":{"default":"#097479","value":"#097479","edited":false},"page-titlebar-backgroundColor":{"value":"#097479","edited":false},"page-backgroundColor":{"value":"#111111","edited":false},"page-sidebar-backgroundColor":{"value":"#000000","edited":false},"group-textColor":{"value":"#0eb8c0","edited":false},"group-borderColor":{"value":"#555555","edited":false},"group-backgroundColor":{"value":"#333333","edited":false},"widget-textColor":{"value":"#eeeeee","edited":false},"widget-backgroundColor":{"value":"#097479","edited":false},"widget-borderColor":{"value":"#333333","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":10,"py":10}},"_users":[]},{"id":"76aa82b9.d5030c","type":"ui_tab","name":"Tab 1","icon":"dashboard","order":1,"_users":["813d2a41.9c0228","316384a.3cbc27c","ccd5aecb.3b7e9"]},{"id":"813d2a41.9c0228","type":"ui_group","z":"","name":"Col1","tab":"76aa82b9.d5030c","disp":true,"width":"12","_users":[]},{"id":"fe3cec98.8cee2","type":"ui_tab","name":"Tab 2","icon":"dashboard","order":2,"_users":[]},{"id":"316384a.3cbc27c","type":"ui_group","z":"","name":"Default","tab":"76aa82b9.d5030c","disp":true,"width":"8","_users":[]},{"id":"ccd5aecb.3b7e9","type":"ui_group","z":"","name":"Default","tab":"76aa82b9.d5030c","disp":true,"width":"6","_users":[]},{"id":"7138d6b8.dc7bc8","type":"websocket-listener","z":"","path":"/ws/canzea","wholemsg":"false","_users":["20bc93b6.437eec","d256768d.b28aa8"]},{"id":"c636bc4a.a28ab","type":"remote-server","z":"","name":"Elasticsearch","host":"http://elasticsearch.service.dc1.consul:9200","_users":["6039f470.059b3c","7cc08be9.3b68b4"]},{"id":"c792be07.29d4","type":"tls-config","z":"","name":"CONSUL","cert":"/etc/vault/ssl/consul.cert","key":"/etc/vault/ssl/consul.key","ca":"/etc/vault/ssl/ca.cert","certname":"","keyname":"","caname":"","verifyservercert":true,"_users":["93d4f6fd.453358","bcc4f1bb.54c44","3a3892f4.b262fe","e8540b41.b7f818","aed4e776.4f6468","64b7d53f.ea6cfc","e677b09d.f63f1","c9e6186b.7a2788","c6260b5f.7a4118","3d57f7bf.77ce68","9da3fb6f.18c028","ad4df813.558948"]},{"id":"a0ccc8b4.4e82d8","type":"selenium-server","z":"","remoteurl":"http://localhost:8001/wd/hub","_users":[]},{"id":"5d04b4f1.4b454c","type":"websocket-client","z":"","path":"ws://ese00c.canzea.cc/gw/api/ws/canzea","wholemsg":"false","_users":[]},{"id":"94073df5.ac54f","type":"tls-config","z":"","name":"VAULT","cert":"/etc/vault/ssl/vault.cert","key":"/etc/vault/ssl/vault.key","ca":"/etc/vault/ssl/ca.cert","certname":"","keyname":"","caname":"","verifyservercert":true,"_users":["92b17b2b.624c98","b5640c37.19e05","138e59.c6ee91a7","56c8fd71.86e484","f238ced3.21639","54b908b1.b6d058","407e4c12.066984","ffd0e092.8655d","90061bb4.000bc8","65cf8ef3.29e59"]},{"id":"484da96d.3150f8","type":"websocket-client","z":"","path":"ws://$HOSTNAME/api/ws/canzea","wholemsg":"false","_users":[]},{"id":"55967ecb.8ad8c","type":"http request","z":"459ae946.b59388","name":"Login","method":"POST","ret":"obj","url":"http://rocketchat.service.dc1.consul:8780/api/login","tls":"","x":338,"y":66,"wires":[["23dd6000.df81c"]]},{"id":"73431067.17be4","type":"function","z":"459ae946.b59388","name":"Prep Creds","func":"msg.message = msg.payload;\nmsg.params = msg.channel ? {\"channel\":msg.channel}:msg.req.params;\nmsg.payload = {\n    \"user\": \"esadmin\",\n    \"password\": \"admin1admin1\"\n};\nreturn msg;","outputs":1,"noerr":0,"x":178,"y":68,"wires":[["55967ecb.8ad8c"]]},{"id":"23dd6000.df81c","type":"function","z":"459ae946.b59388","name":"Set Headers","func":"token = msg.payload.data.authToken;\nuserId = msg.payload.data.userId;\nmsg.req_headers = {\n    \"X-Auth-Token\": token,\n    \"X-User-Id\": userId,\n    'Content-Type': 'application/json'\n};\nreturn msg;","outputs":1,"noerr":0,"x":507,"y":68,"wires":[["ffca7df7.7c2eb"]]},{"id":"fa28791b.390f18","type":"http request","z":"459ae946.b59388","name":"Post Message","method":"POST","ret":"txt","url":"http://rocketchat.service.dc1.consul:8780/api/v1/chat.postMessage","tls":"","x":455,"y":155,"wires":[["12f83637.c38aea"]]},{"id":"8effb7ac.68f778","type":"function","z":"459ae946.b59388","name":"Post Message","func":"//msg.topic = msg.payload.channels[0]._id;\nmsg.headers = msg.req_headers;\nmsg.payload = msg.message;\nmsg.payload.channel = \"#\" + msg.params.channel;\nreturn msg;\n","outputs":1,"noerr":0,"x":271,"y":155,"wires":[["fa28791b.390f18"]]},{"id":"ffca7df7.7c2eb","type":"switch","z":"459ae946.b59388","name":"","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"send-message","vt":"str"},{"t":"eq","v":"plus:collaboration_message","vt":"str"},{"t":"else"}],"checkall":"false","outputs":3,"x":105.5,"y":161,"wires":[["8effb7ac.68f778"],["b9734344.54db5"],["553f1c2c.d2a694"]]},{"id":"2f18cbf7.b83dc4","type":"function","z":"459ae946.b59388","name":"Success","func":"msg.payload = '';\nreturn msg;","outputs":1,"noerr":0,"x":743.5,"y":148,"wires":[[]]},{"id":"b2c1caa6.c5d178","type":"catch","z":"459ae946.b59388","name":"","scope":null,"x":564.5,"y":415,"wires":[["29396b5b.bdef54"]]},{"id":"29396b5b.bdef54","type":"function","z":"459ae946.b59388","name":"Error","func":"msg.payload = {\n    \"error\": msg.message\n};\nmsg.statusCode = 400;\nreturn msg;","outputs":1,"noerr":0,"x":693,"y":415,"wires":[[]]},{"id":"12f83637.c38aea","type":"switch","z":"459ae946.b59388","name":"","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","outputs":2,"x":603,"y":155,"wires":[["2f18cbf7.b83dc4"],["e7d3f617.97bdf8"]]},{"id":"e7d3f617.97bdf8","type":"function","z":"459ae946.b59388","name":"Error","func":"msg.statusCode = 400;\nreturn msg;","outputs":1,"noerr":0,"x":734,"y":186,"wires":[[]]},{"id":"553f1c2c.d2a694","type":"function","z":"459ae946.b59388","name":"Invalid Topic","func":"msg.payload = {\n    \"error\": \"Unknown topic for Rocket.Chat Send Message \" + msg.topic\n};\nmsg.statusCode = 400;\nreturn msg;","outputs":1,"noerr":0,"x":573.5,"y":376,"wires":[[]]},{"id":"b9734344.54db5","type":"function","z":"459ae946.b59388","name":"Post Message","func":"//msg.topic = msg.payload.channels[0]._id;\n//k = Object.keys(msg.message)[0];\nmsg.headers = msg.req_headers;\nmsg.payload = msg.message;\nreturn msg;\n","outputs":1,"noerr":0,"x":287,"y":205,"wires":[["fa28791b.390f18","cbfd33f3.e743d"]]},{"id":"cbfd33f3.e743d","type":"debug","z":"459ae946.b59388","name":"","active":true,"console":"false","complete":"false","x":468.5,"y":219,"wires":[]},{"id":"459ae946.b59388","type":"subflow","name":"Rocket.Chat Send Message","info":"# Input\n\n````\nmsg.topic = 'send-message'\nmsg.channel = '#general'\nmsg.payload = {\n    \"text\": \"hello team\"\n}\n````\n\n# Output\n\nmsg.payload : \"success\"","in":[{"x":50,"y":30,"wires":[{"id":"73431067.17be4"}]}],"out":[{"x":803,"y":357,"wires":[{"id":"2f18cbf7.b83dc4","port":0},{"id":"29396b5b.bdef54","port":0},{"id":"e7d3f617.97bdf8","port":0},{"id":"553f1c2c.d2a694","port":0}]}]},{"id":"28aa0d23.ba8a42","type":"http request","z":"4fc6c84.9271b38","name":"Login","method":"POST","ret":"obj","url":"http://rocketchat.service.dc1.consul:8780/api/login","tls":"","x":363,"y":108,"wires":[["3a657acb.d24796"]]},{"id":"ece03586.523688","type":"function","z":"4fc6c84.9271b38","name":"Prep Creds","func":"msg.message = msg.payload;\nmsg.params = msg.req.params;\nmsg.payload = {\n    \"user\": msg.envs.SERVICE_ROCKETCHAT_ESADMIN_CREDENTIALS_USER_NAME,\n    \"password\": msg.envs.SERVICE_ROCKETCHAT_ESADMIN_CREDENTIALS_PASSWORD\n};\nreturn msg;","outputs":1,"noerr":0,"x":203,"y":110,"wires":[["28aa0d23.ba8a42"]]},{"id":"3a657acb.d24796","type":"function","z":"4fc6c84.9271b38","name":"Set Headers","func":"token = msg.payload.data.authToken;\nuserId = msg.payload.data.userId;\nmsg.req_headers = {\n    \"X-Auth-Token\": token,\n    \"X-User-Id\": userId,\n    'Content-Type': 'application/json'\n};\nreturn msg;","outputs":1,"noerr":0,"x":532,"y":110,"wires":[["32bdae49.975b12"]]},{"id":"e2231f34.974c5","type":"http request","z":"4fc6c84.9271b38","name":"Create Channel","method":"POST","ret":"obj","url":"{{{envs.ROCKETCHAT_URL}}}/api/v1/channels.create","tls":"","x":483,"y":164,"wires":[["18739691.dce0e9"]]},{"id":"aac89601.9d9d38","type":"function","z":"4fc6c84.9271b38","name":"Create Channel","func":"//msg.topic = msg.payload.channels[0]._id;\nmsg.headers = msg.req_headers;\nmsg.payload = {\n    \"name\": msg.key\n}\nreturn msg;\n","outputs":1,"noerr":0,"x":310,"y":173,"wires":[["e2231f34.974c5"]]},{"id":"32bdae49.975b12","type":"switch","z":"4fc6c84.9271b38","name":"","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"plus:collaboration_channel","vt":"str"},{"t":"eq","v":"minus:collaboration_channel","vt":"str"},{"t":"else"}],"checkall":"false","outputs":3,"x":132.5,"y":169,"wires":[["aac89601.9d9d38"],["fa42936c.62197"],["777696ff.8bd858"]]},{"id":"c84a327b.f1cc","type":"function","z":"4fc6c84.9271b38","name":"Success","func":"msg.payload = '';\nreturn msg;","outputs":1,"noerr":0,"x":788.5,"y":140,"wires":[[]]},{"id":"e0645b4a.9fceb8","type":"catch","z":"4fc6c84.9271b38","name":"","scope":null,"x":589.5,"y":457,"wires":[["aad2cb53.5f59f8"]]},{"id":"aad2cb53.5f59f8","type":"function","z":"4fc6c84.9271b38","name":"Error","func":"msg.payload = {\n    \"error\": msg.message\n};\nmsg.statusCode = 400;\nreturn msg;","outputs":1,"noerr":0,"x":718,"y":457,"wires":[[]]},{"id":"18739691.dce0e9","type":"switch","z":"4fc6c84.9271b38","name":"","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","outputs":2,"x":641,"y":160,"wires":[["c84a327b.f1cc"],["220cc5d7.760e4a"]]},{"id":"777696ff.8bd858","type":"function","z":"4fc6c84.9271b38","name":"Invalid Topic","func":"msg.payload = {\n    \"error\": \"Unknown topic \" + msg.topic\n};\nmsg.statusCode = 400;\nreturn msg;","outputs":1,"noerr":0,"x":598.5,"y":418,"wires":[[]]},{"id":"220cc5d7.760e4a","type":"function","z":"4fc6c84.9271b38","name":"Graceful OK","func":"if (msg.payload.errorType == \"error-duplicate-channel-name\") {\n    msg.statusCode = 200;\n    msg.payload = {\n        \"warning\": \"Channel already created.\"\n    }\n} else {\n    msg.statusCode = 400;\n    msg.payload = {\n        \"source\": \"rocketchat\",\n        \"message\": msg.payload\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"x":667,"y":242,"wires":[[]]},{"id":"ff7d9b64.77e428","type":"http request","z":"4fc6c84.9271b38","name":"Get Channel","method":"GET","ret":"obj","url":"http://localhost:8780/api/v1/channels.info?roomName={{{key}}}","tls":"","x":143,"y":308,"wires":[["69e87996.4aca08","fbd80a31.632598"]]},{"id":"85872bfb.e398c8","type":"function","z":"4fc6c84.9271b38","name":"Transform","func":"msg.payload = {\n    \"roomId\": msg.payload.channel._id\n}\nmsg.headers = msg.req_headers;\n\nreturn msg;","outputs":1,"noerr":0,"x":190,"y":425,"wires":[["3f6eaea.4fbc852"]]},{"id":"3f6eaea.4fbc852","type":"http request","z":"4fc6c84.9271b38","name":"Delete Channel","method":"POST","ret":"obj","url":"http://localhost:8780/api/v1/channels.delete","tls":"","x":375,"y":426,"wires":[["3511fd0b.a12e52"]]},{"id":"69e87996.4aca08","type":"debug","z":"4fc6c84.9271b38","name":"","active":true,"console":"false","complete":"true","x":279.5,"y":308,"wires":[]},{"id":"fa42936c.62197","type":"function","z":"4fc6c84.9271b38","name":"Set Headers","func":"//msg.topic = msg.payload.channels[0]._id;\nmsg.headers = msg.req_headers;\nreturn msg;\n","outputs":1,"noerr":0,"x":198,"y":253,"wires":[["ff7d9b64.77e428"]]},{"id":"3511fd0b.a12e52","type":"switch","z":"4fc6c84.9271b38","name":"","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","outputs":2,"x":452,"y":508,"wires":[["7d64214a.92502"],["2d347082.b7fcb"]]},{"id":"7d64214a.92502","type":"function","z":"4fc6c84.9271b38","name":"Graceful OK","func":"\nmsg.statusCode = 200;\nmsg.payload = {\n    \"source\": \"rocketchat\",\n    \"message\": msg.payload\n}\nreturn msg;","outputs":1,"noerr":0,"x":611,"y":511,"wires":[[]]},{"id":"2d347082.b7fcb","type":"function","z":"4fc6c84.9271b38","name":"Return error","func":"\n    msg.statusCode = 400;\n    msg.payload = {\n        \"source\": \"rocketchat\",\n        \"message\": msg.payload\n    }\n    return msg;","outputs":1,"noerr":0,"x":608,"y":559,"wires":[[]]},{"id":"fbd80a31.632598","type":"switch","z":"4fc6c84.9271b38","name":"","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","outputs":2,"x":88,"y":366,"wires":[["85872bfb.e398c8"],["2d347082.b7fcb"]]},{"id":"e1055459.5ed2d8","type":"comment","z":"4fc6c84.9271b38","name":"DELETE and UPDATE","info":"DELETE:\nhttps://ese00c.canzea.cc/gw/api/gateway/channel/Integration2\n\nUPDATE:\nhttps://ese00c.canzea.cc/gw/api/gateway/channel\n\n{\n\t\"channel\": {\n\t\t\"name\": \"Integration\"\n\t}\n}\n","x":137.5,"y":496,"wires":[]},{"id":"93d4f6fd.453358","type":"vars","z":"4fc6c84.9271b38","name":"CONSUL","propertyType":{"context":{"location":{"href":"https://es110c.canzea.cc/gw/admin/#flow/4fc6c84.9271b38","ancestorOrigins":{},"origin":"https://es110c.canzea.cc","protocol":"https:","host":"es110c.canzea.cc","hostname":"es110c.canzea.cc","port":"","pathname":"/gw/admin/","search":"","hash":"#flow/4fc6c84.9271b38"},"jQuery111305858287869232":1},"selector":"#node-input-property"},"rules":[{"t":"service","v":"rocketchat","vt":"str"}],"checkall":"true","outputs":1,"tls":"c792be07.29d4","url":"https://consul.service.dc1.consul:8080","x":198,"y":37,"wires":[["92b17b2b.624c98"]]},{"id":"92b17b2b.624c98","type":"vars","z":"4fc6c84.9271b38","name":"VAULT","propertyType":{"context":{"location":{"href":"https://8281205.xyz/gwadmin/#flow/d773a612.5b2d98","ancestorOrigins":{},"origin":"https://8281205.xyz","protocol":"https:","host":"8281205.xyz","hostname":"8281205.xyz","port":"","pathname":"/gwadmin/","search":"","hash":"#flow/d773a612.5b2d98"},"jQuery1113097090410759886":1},"selector":"#node-input-property"},"rules":[{"t":"secret","v":"service/rocketchat/esadmin/credentials","vt":"str"}],"checkall":"true","outputs":1,"tls":"94073df5.ac54f","url":"https://vault.service.dc1.consul:8200","x":382,"y":43,"wires":[["ece03586.523688"]]},{"id":"4fc6c84.9271b38","type":"subflow","name":"Rocket.Chat Channels","info":"","in":[{"x":50,"y":30,"wires":[{"id":"93d4f6fd.453358"}]}],"out":[{"x":831,"y":335,"wires":[{"id":"c84a327b.f1cc","port":0},{"id":"777696ff.8bd858","port":0},{"id":"aad2cb53.5f59f8","port":0},{"id":"220cc5d7.760e4a","port":0},{"id":"7d64214a.92502","port":0},{"id":"2d347082.b7fcb","port":0}]}]},{"id":"8f5dbf2d.fd6b1","type":"http request","z":"9ed8bb48.699498","name":"Login","method":"POST","ret":"obj","url":"http://localhost:8780/api/login","tls":"","x":414.3888702392578,"y":109.99999237060547,"wires":[["fc402e1a.0369b"]]},{"id":"624b89c0.987a98","type":"function","z":"9ed8bb48.699498","name":"Prep Creds","func":"msg.message = msg.payload;\nmsg.params = msg.req.params;\nmsg.payload = {\n    \"user\": \"admin\",\n    \"password\": \"admin1admin\"\n};\nreturn msg;","outputs":1,"noerr":0,"x":254.3888702392578,"y":111.99999237060547,"wires":[["8f5dbf2d.fd6b1"]]},{"id":"fc402e1a.0369b","type":"function","z":"9ed8bb48.699498","name":"Set Headers","func":"token = msg.payload.data.authToken;\nuserId = msg.payload.data.userId;\nmsg.req_headers = {\n    \"X-Auth-Token\": token,\n    \"X-User-Id\": userId,\n    'Content-Type': 'application/json'\n};\nreturn msg;","outputs":1,"noerr":0,"x":583.3888702392578,"y":111.99999237060547,"wires":[["6e1a8708.c5fc78"]]},{"id":"7a2c803d.753e2","type":"http request","z":"9ed8bb48.699498","name":"Create User","method":"POST","ret":"txt","url":"http://localhost:8780/api/v1/users.create","tls":"","x":521.3888702392578,"y":198.99999237060547,"wires":[["14530014.402bc"]]},{"id":"6e284823.de3f48","type":"function","z":"9ed8bb48.699498","name":"Create User","func":"//msg.topic = msg.payload.channels[0]._id;\nmsg.headers = msg.req_headers;\nmsg.payload = msg.message;\nreturn msg;\n","outputs":1,"noerr":0,"x":337.3888702392578,"y":198.99999237060547,"wires":[["7a2c803d.753e2"]]},{"id":"6e1a8708.c5fc78","type":"switch","z":"9ed8bb48.699498","name":"","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"create-user","vt":"str"},{"t":"else"}],"checkall":"false","outputs":2,"x":183.8888702392578,"y":170.99999237060547,"wires":[["6e284823.de3f48"],["74617625.e54388"]]},{"id":"472f5778.caef18","type":"function","z":"9ed8bb48.699498","name":"Success","func":"msg.payload = '';\nreturn msg;","outputs":1,"noerr":0,"x":819.8888702392578,"y":191.99999237060547,"wires":[[]]},{"id":"f7137cc3.5c541","type":"catch","z":"9ed8bb48.699498","name":"","scope":null,"x":640.8888702392578,"y":458.99999237060547,"wires":[["f9469784.1fa678"]]},{"id":"f9469784.1fa678","type":"function","z":"9ed8bb48.699498","name":"Error","func":"msg.payload = {\n    \"error\": msg.message\n};\nmsg.statusCode = 400;\nreturn msg;","outputs":1,"noerr":0,"x":769.3888702392578,"y":458.99999237060547,"wires":[[]]},{"id":"14530014.402bc","type":"switch","z":"9ed8bb48.699498","name":"","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","outputs":2,"x":679.3888702392578,"y":198.99999237060547,"wires":[["472f5778.caef18"],["7256c98d.8beac8"]]},{"id":"7256c98d.8beac8","type":"function","z":"9ed8bb48.699498","name":"Error","func":"msg.statusCode = 400;\nreturn msg;","outputs":1,"noerr":0,"x":810.3888702392578,"y":229.99999237060547,"wires":[[]]},{"id":"74617625.e54388","type":"function","z":"9ed8bb48.699498","name":"Invalid Topic","func":"msg.payload = {\n    \"error\": \"Unknown topic \" + msg.topic\n};\nmsg.statusCode = 400;\nreturn msg;","outputs":1,"noerr":0,"x":649.8888702392578,"y":419.99999237060547,"wires":[[]]},{"id":"9ed8bb48.699498","type":"subflow","name":"Rocket.Chat Users","info":"","in":[{"x":50,"y":30,"wires":[{"id":"624b89c0.987a98"}]}],"out":[{"x":931.1110696792603,"y":292.2222023010254,"wires":[{"id":"472f5778.caef18","port":0},{"id":"7256c98d.8beac8","port":0},{"id":"74617625.e54388","port":0},{"id":"f9469784.1fa678","port":0}]}]},{"id":"959c7509.06f018","type":"http request","z":"3206ac46.8fc5e4","name":"Login","method":"POST","ret":"obj","url":"http://localhost:8780/api/login","tls":"","x":395.5555419921875,"y":122.22221374511719,"wires":[["8c71ed65.7e45"]]},{"id":"2f0d33f6.59d3ac","type":"function","z":"3206ac46.8fc5e4","name":"Prep Creds","func":"msg.message = msg.payload;\nmsg.params = msg.req.params;\nmsg.payload = {\n    \"user\": \"admin\",\n    \"password\": \"admin1admin\"\n};\nreturn msg;","outputs":1,"noerr":0,"x":235.5555419921875,"y":124.22221374511719,"wires":[["959c7509.06f018"]]},{"id":"8c71ed65.7e45","type":"function","z":"3206ac46.8fc5e4","name":"Set Headers","func":"token = msg.payload.data.authToken;\nuserId = msg.payload.data.userId;\nmsg.req_headers = {\n    \"X-Auth-Token\": token,\n    \"X-User-Id\": userId,\n    'Content-Type': 'application/json'\n};\nreturn msg;","outputs":1,"noerr":0,"x":564.5555419921875,"y":124.22221374511719,"wires":[["96ea9808.6b2d18"]]},{"id":"4b1d496.9abd5b8","type":"http request","z":"3206ac46.8fc5e4","name":"Create Group","method":"POST","ret":"txt","url":"http://localhost:8780/api/v1/groups.create","tls":"","x":512.5555419921875,"y":211.2222137451172,"wires":[["48eea152.5f465"]]},{"id":"96cd0fcb.8d846","type":"function","z":"3206ac46.8fc5e4","name":"Create Group","func":"//msg.topic = msg.payload.channels[0]._id;\nmsg.headers = msg.req_headers;\nmsg.payload = msg.message;\nreturn msg;\n","outputs":1,"noerr":0,"x":328.5555419921875,"y":211.2222137451172,"wires":[["4b1d496.9abd5b8"]]},{"id":"96ea9808.6b2d18","type":"switch","z":"3206ac46.8fc5e4","name":"","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"create-group","vt":"str"},{"t":"else"}],"checkall":"false","outputs":2,"x":165.0555419921875,"y":183.2222137451172,"wires":[["96cd0fcb.8d846"],["e27e3c57.d1de6"]]},{"id":"b9406d77.b5896","type":"function","z":"3206ac46.8fc5e4","name":"Success","func":"msg.payload = '';\nreturn msg;","outputs":1,"noerr":0,"x":801.0555419921875,"y":204.2222137451172,"wires":[[]]},{"id":"73d3c736.c150a8","type":"catch","z":"3206ac46.8fc5e4","name":"","scope":null,"x":622.0555419921875,"y":471.2222137451172,"wires":[["74af886f.114368"]]},{"id":"74af886f.114368","type":"function","z":"3206ac46.8fc5e4","name":"Error","func":"msg.payload = {\n    \"error\": msg.message\n};\nmsg.statusCode = 400;\nreturn msg;","outputs":1,"noerr":0,"x":750.5555419921875,"y":471.2222137451172,"wires":[[]]},{"id":"48eea152.5f465","type":"switch","z":"3206ac46.8fc5e4","name":"","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","outputs":2,"x":660.5555419921875,"y":211.2222137451172,"wires":[["b9406d77.b5896"],["5b5ec790.f056b8"]]},{"id":"5b5ec790.f056b8","type":"function","z":"3206ac46.8fc5e4","name":"Error","func":"msg.statusCode = 400;\nreturn msg;","outputs":1,"noerr":0,"x":791.5555419921875,"y":242.2222137451172,"wires":[[]]},{"id":"e27e3c57.d1de6","type":"function","z":"3206ac46.8fc5e4","name":"Invalid Topic","func":"msg.payload = {\n    \"error\": \"Unknown topic \" + msg.topic\n};\nmsg.statusCode = 400;\nreturn msg;","outputs":1,"noerr":0,"x":631.0555419921875,"y":432.2222137451172,"wires":[[]]},{"id":"3206ac46.8fc5e4","type":"subflow","name":"Rocket.Chat Groups","info":"","in":[{"x":50,"y":30,"wires":[{"id":"2f0d33f6.59d3ac"}]}],"out":[{"x":922.2222213745117,"y":299.9999942779541,"wires":[{"id":"b9406d77.b5896","port":0},{"id":"5b5ec790.f056b8","port":0},{"id":"e27e3c57.d1de6","port":0},{"id":"74af886f.114368","port":0}]}]},{"id":"42625c48.dbece4","type":"bigexec","z":"9223e50a.f92628","name":"","command":"/home/pm2user/canzea.sh","commandArgs":"--lifecycle=wire --solution=nodered --action=export-flows --raw","minError":1,"minWarning":1,"cwd":"/home/pm2user/.ecosystem-catalog/catalog","shell":"","extraArgumentProperty":"","envProperty":"","format":"utf8","limiter":true,"payloadIs":"triggerNoStdin","x":298.6666717529297,"y":217.77777099609375,"wires":[[],[],[]]},{"id":"dcef7767.7eb788","type":"function","z":"9223e50a.f92628","name":"","func":"\nreturn msg;","outputs":1,"noerr":0,"x":109.66667175292969,"y":139.27777099609375,"wires":[["42625c48.dbece4"]]},{"id":"9223e50a.f92628","type":"subflow","name":"Exports / Nodered","info":"","in":[{"x":50,"y":30,"wires":[{"id":"dcef7767.7eb788"}]}],"out":[{"x":579.9999618530273,"y":473.333345413208,"wires":[{"id":"42625c48.dbece4","port":0}]}]},{"id":"cb398cc2.c4dca","type":"inject","z":"ea5122d7.76e78","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":151.25,"y":228.75,"wires":[["acab1536.bbca78"]]},{"id":"acab1536.bbca78","type":"function","z":"ea5122d7.76e78","name":"Prep New Component","func":"pl = msg.payload;\n\nargs = {\n    \"root\": \"components\",\n    \"key\": pl.name,\n    \"values\": pl\n};\n\nfunction replaceAll(str, find, replace) {\n  return str.replace(new RegExp(find, 'g'), replace);\n}\n\nargsString = replaceAll(JSON.stringify(args),'\"', '\"');\n\nmsg.payload = \"--lifecycle=wire --solution=consul --action=add_keyvalue --args='\" + argsString + \"'\";\n\nreturn msg;\n","outputs":1,"noerr":0,"x":418.25,"y":224.75,"wires":[["eadeecad.f2baf"]]},{"id":"eadeecad.f2baf","type":"bigexec","z":"ea5122d7.76e78","name":"","command":"/home/pm2user/canzea.sh","commandArgs":"","minError":1,"minWarning":1,"cwd":"/home/pm2user/.ecosystem-catalog/catalog","shell":"","extraArgumentProperty":"","envProperty":"","format":"utf8","limiter":true,"payloadIs":"argumentNoStdin","x":700,"y":300,"wires":[[],["999cb956.5d6018"],[]]},{"id":"5dbb09c7.7f3108","type":"inject","z":"ea5122d7.76e78","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":152.25,"y":303.75,"wires":[["b91e0771.ab0008"]]},{"id":"b91e0771.ab0008","type":"function","z":"ea5122d7.76e78","name":"Prep New Component Pipeline","func":"pl = msg.payload;\nname = pl.name;\n\nargs = {\n    \"root\": \"components\",\n    \"key\": \"gs-actuator-service/pipelines/gs-actuator-service-1.0.3-Build\",\n    \"values\": {\n        \"type\": \"build\"\n    }\n};\n\nfunction replaceAll(str, find, replace) {\n  return str.replace(new RegExp(find, 'g'), replace);\n}\n\nargsString = replaceAll(JSON.stringify(args),'\"', '\"');\n\nmsg.payload = \"--lifecycle=wire --solution=consul --action=add_keyvalue --args='\" + argsString + \"'\";\n\nreturn msg;\n","outputs":1,"noerr":0,"x":449.25,"y":299.75,"wires":[["eadeecad.f2baf"]]},{"id":"bca9e29b.3efc6","type":"catch","z":"ea5122d7.76e78","name":"","scope":null,"x":860,"y":400,"wires":[["530496a.2ecf268"]]},{"id":"530496a.2ecf268","type":"function","z":"ea5122d7.76e78","name":"Error","func":"msg.payload = {\n    \"error\": msg.message\n};\nmsg.statusCode = 400;\nreturn msg;","outputs":1,"noerr":0,"x":988.5,"y":400,"wires":[[]]},{"id":"999cb956.5d6018","type":"switch","z":"ea5122d7.76e78","name":"","property":"control.state","propertyType":"msg","rules":[{"t":"eq","v":"end","vt":"str"},{"t":"eq","v":"error","vt":"str"},{"t":"else"}],"checkall":"false","outputs":3,"x":855.75,"y":295.5,"wires":[["caf35c01.cde71"],["98ce0df9.bb629"],[]]},{"id":"98ce0df9.bb629","type":"function","z":"ea5122d7.76e78","name":"Error","func":"msg.statusCode = 400;\nreturn msg;","outputs":1,"noerr":0,"x":982.75,"y":324.5,"wires":[[]]},{"id":"1c9d34b6.48706b","type":"function","z":"ea5122d7.76e78","name":"Analyze","func":"args = msg.payload;\n\nfunction replaceAll(str, find, replace) {\n  return str.replace(new RegExp(find, 'g'), replace);\n}\n\nargsString = replaceAll(JSON.stringify(args),'\"', '\"');\n\nmsg.payload = \"--lifecycle=wire --raw --solution=application --action=analyze-project --args='\" + argsString + \"'\";\n\nreturn msg;\n","outputs":1,"noerr":0,"x":521,"y":36,"wires":[["96c46328.96cb7"]]},{"id":"19b02aef.72eaf5","type":"switch","z":"ea5122d7.76e78","name":"","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"analyze-project","vt":"str"},{"t":"eq","v":"add-component","vt":"str"},{"t":"eq","v":"plus:component_metadata","vt":"str"},{"t":"eq","v":"minus:component_metadata","vt":"str"},{"t":"else"}],"checkall":"false","outputs":5,"x":215.5,"y":51,"wires":[["1c9d34b6.48706b"],["acab1536.bbca78"],["7a1da86c.1cefd8"],["87f8878c.20d6f8"],["e37a45a.a7760b8"]]},{"id":"e37a45a.a7760b8","type":"function","z":"ea5122d7.76e78","name":"Invalid Topic","func":"msg.payload = {\n    \"error\": \"Invalid Topic \" + msg.topic\n};\nmsg.statusCode = 400;\nreturn msg;","outputs":1,"noerr":0,"x":862.5,"y":67,"wires":[[]]},{"id":"96c46328.96cb7","type":"bigexec","z":"ea5122d7.76e78","name":"","command":"/home/pm2user/canzea.sh","commandArgs":"","minError":1,"minWarning":1,"cwd":"/home/pm2user/.ecosystem-catalog/catalog","shell":"","extraArgumentProperty":"","envProperty":"","format":"utf8","limiter":true,"payloadIs":"argumentNoStdin","x":703,"y":142,"wires":[["1a420c7f.9005c4","c5af3e19.b6246"],[],[]]},{"id":"caf35c01.cde71","type":"function","z":"ea5122d7.76e78","name":"Success","func":"msg.statusCode = 200;\nreturn msg;","outputs":1,"noerr":0,"x":993,"y":283,"wires":[[]]},{"id":"87f8878c.20d6f8","type":"function","z":"ea5122d7.76e78","name":"Minus:component_metadata","func":"pl = msg.payload;\n\nargs = {\n    \"root\": \"components\",\n    \"key\": msg.key,\n    \"values\": pl\n};\n\nfunction replaceAll(str, find, replace) {\n  return str.replace(new RegExp(find, 'g'), replace);\n}\n\nargsString = replaceAll(JSON.stringify(args),'\"', '\"');\n\nmsg.payload = \"--lifecycle=wire --solution=consul --action=delete_keyvalue --args='\" + argsString + \"'\";\n\nreturn msg;\n","outputs":1,"noerr":0,"x":461,"y":182,"wires":[["da5bf87f.edeab8"]]},{"id":"da5bf87f.edeab8","type":"bigexec","z":"ea5122d7.76e78","name":"","command":"/home/pm2user/canzea.sh","commandArgs":"","minError":1,"minWarning":1,"cwd":"/home/pm2user/.ecosystem-catalog/catalog","shell":"","extraArgumentProperty":"","envProperty":"","format":"utf8","limiter":true,"payloadIs":"argumentNoStdin","x":701,"y":221,"wires":[[],["999cb956.5d6018"],[]]},{"id":"7a1da86c.1cefd8","type":"function","z":"ea5122d7.76e78","name":"Plus:component_metadata","func":"pl = msg.payload;\n\nargs = {\n    \"root\": \"components\",\n    \"key\": msg.key,\n    \"values\": pl\n};\n\nfunction replaceAll(str, find, replace) {\n  return str.replace(new RegExp(find, 'g'), replace);\n}\n\nargsString = replaceAll(JSON.stringify(args),'\"', '\"');\n\nmsg.payload = \"--lifecycle=wire --solution=consul --action=add_keyvalue --args='\" + argsString + \"'\";\n\nreturn msg;\n","outputs":1,"noerr":0,"x":456,"y":123,"wires":[["da5bf87f.edeab8"]]},{"id":"7386e52b.22813c","type":"function","z":"ea5122d7.76e78","name":"","func":"if (msg.payload.code == '-1') {\n    msg.statusCode = 400;\n}\nreturn msg;","outputs":1,"noerr":0,"x":1144,"y":134,"wires":[[]]},{"id":"1a420c7f.9005c4","type":"json","z":"ea5122d7.76e78","name":"","pretty":false,"x":848,"y":130,"wires":[["7386e52b.22813c","808c1b37.17fe88"]]},{"id":"808c1b37.17fe88","type":"debug","z":"ea5122d7.76e78","name":"","active":true,"console":"false","complete":"false","x":1121.5,"y":70,"wires":[]},{"id":"c5af3e19.b6246","type":"debug","z":"ea5122d7.76e78","name":"","active":true,"console":"false","complete":"false","x":897,"y":183,"wires":[]},{"id":"ea5122d7.76e78","type":"subflow","name":"Components","info":"","in":[{"x":50,"y":30,"wires":[{"id":"19b02aef.72eaf5"}]}],"out":[{"x":1158.75,"y":291.75,"wires":[{"id":"530496a.2ecf268","port":0},{"id":"98ce0df9.bb629","port":0},{"id":"e37a45a.a7760b8","port":0},{"id":"caf35c01.cde71","port":0},{"id":"7386e52b.22813c","port":0}]}]},{"id":"9feb67be.1e39d8","type":"switch","z":"a1cb3587.05ca68","name":"","property":"control.state","propertyType":"msg","rules":[{"t":"eq","v":"start","vt":"str"},{"t":"eq","v":"running","vt":"str"},{"t":"eq","v":"end","vt":"str"},{"t":"eq","v":"error","vt":"str"}],"checkall":"false","outputs":4,"x":705.5,"y":296,"wires":[[],[],["6ec8b063.eb31a"],["c82394d4.3bd098"]]},{"id":"5ca32374.a6013c","type":"function","z":"a1cb3587.05ca68","name":"Prepare GET","func":"pl = msg.payload;\n\nargs = {\n    \"qualifier\": \"A\",\n    \"A\": {\n        \"type\": \"pipelines\",\n        \"name\": pl.name + \"-\" + pl.branch + \"-Build\"\n    }\n};\n\n\nfunction replaceAll(str, find, replace) {\n  return str.replace(new RegExp(find, 'g'), replace);\n}\n\nargsString = replaceAll(JSON.stringify(args),'\"', '\"');\n\nmsg.payload = \"--lifecycle=wire --solution=gocd --action=get-object --args='\" + argsString + \"'\";\n\nreturn msg;\n\n","outputs":"1","noerr":0,"x":309.5,"y":250,"wires":[["ec0f5e65.28ec4"]]},{"id":"28da27c6.08b1d8","type":"function","z":"a1cb3587.05ca68","name":"create-build-pipeline","func":"pl = msg.payload;\n\nargs = {\n    \"qualifier\": \"A\",\n    \"A\": {\n        \"type\":\"pipelines\",\n        \"name\": pl.pipelineName\n    }\n};\n\nfunction replaceAll(str, find, replace) {\n  return str.replace(new RegExp(find, 'g'), replace);\n}\n\nargsString = replaceAll(JSON.stringify(args),'\"', '\"');\n\nmsg.payload = \"--lifecycle=wire --solution=gocd --action=post-object --args='\" + argsString + \"'\";\n\nreturn msg;\n\n","outputs":"1","noerr":0,"x":320,"y":340,"wires":[["9ad44d91.13f87"]]},{"id":"9ad44d91.13f87","type":"bigexec","z":"a1cb3587.05ca68","name":"","command":"/home/pm2user/canzea.sh","commandArgs":"","minError":1,"minWarning":1,"cwd":"/home/pm2user/.ecosystem-catalog/catalog","shell":"","extraArgumentProperty":"","envProperty":"","format":"utf8","limiter":true,"payloadIs":"argumentNoStdin","x":478.5,"y":329,"wires":[["dd651a31.1779b8"],["9feb67be.1e39d8"],["dd651a31.1779b8"]]},{"id":"79cc2dd2.2e9744","type":"function","z":"a1cb3587.05ca68","name":"Prepare UNPAUSE","func":"pl = msg.payload;\n\nargs = {\n    \"qualifier\": \"A\",\n    \"A\": {\n        \"name\": pl.pipelineName\n    }\n};\n\nfunction replaceAll(str, find, replace) {\n  return str.replace(new RegExp(find, 'g'), replace);\n}\n\nargsString = replaceAll(JSON.stringify(args),'\"', '\"');\n\nmsg.payload = \"--lifecycle=wire --solution=gocd --action=unpause --args='\" + argsString + \"'\";\n\nreturn msg;\n\n","outputs":"1","noerr":0,"x":297.5,"y":439,"wires":[["a9ff3c48.849d5"]]},{"id":"a9ff3c48.849d5","type":"bigexec","z":"a1cb3587.05ca68","name":"","command":"/home/pm2user/canzea.sh","commandArgs":"","minError":1,"minWarning":1,"cwd":"/home/pm2user/.ecosystem-catalog/catalog","shell":"","extraArgumentProperty":"","envProperty":"","format":"utf8","limiter":true,"payloadIs":"argumentNoStdin","x":501.5,"y":445,"wires":[[],["9feb67be.1e39d8"],[]]},{"id":"cc918e27.33987","type":"function","z":"a1cb3587.05ca68","name":"Prepare Add to Environment","func":"pl = msg.payload;\n\nargs = {\n    \"qualifier\": \"A\",\n    \"A\": {\n        \"type\":\"environments\",\n        \"name\": pl.environment,\n        \"pipelineName\": pl.pipelineName\n    }\n};\n\nfunction replaceAll(str, find, replace) {\n  return str.replace(new RegExp(find, 'g'), replace);\n}\n\nargsString = replaceAll(JSON.stringify(args),'\"', '\"');\n\nmsg.payload = \"--lifecycle=wire --solution=gocd --action=add-pipeline-to-environment --args='\" + argsString + \"'\";\n\nreturn msg;\n\n","outputs":"1","noerr":0,"x":322.5,"y":536,"wires":[["5b613472.09fcdc"]]},{"id":"5b613472.09fcdc","type":"bigexec","z":"a1cb3587.05ca68","name":"","command":"/home/pm2user/canzea.sh","commandArgs":"","minError":1,"minWarning":1,"cwd":"/home/pm2user/.ecosystem-catalog/catalog","shell":"","extraArgumentProperty":"","envProperty":"","format":"utf8","limiter":true,"payloadIs":"argumentNoStdin","x":694.5,"y":501,"wires":[["c9bc3421.f55bd8"],["9feb67be.1e39d8"],[]]},{"id":"4d099c74.66e8b4","type":"function","z":"a1cb3587.05ca68","name":"Prepare SCHEDULE","func":"pl = msg.payload;\n\nargs = {\n    \"qualifier\": \"A\",\n    \"A\": {\n        \"name\": pl.pipelineName\n    }\n};\n\nfunction replaceAll(str, find, replace) {\n  return str.replace(new RegExp(find, 'g'), replace);\n}\n\nargsString = replaceAll(JSON.stringify(args),'\"', '\"');\n\nmsg.payload = \"--lifecycle=wire --solution=gocd --action=schedule --args='\" + argsString + \"'\";\n\nreturn msg;\n\n","outputs":"1","noerr":0,"x":297.5,"y":384,"wires":[["cb41efdc.c4c9b"]]},{"id":"cb41efdc.c4c9b","type":"bigexec","z":"a1cb3587.05ca68","name":"","command":"/home/pm2user/canzea.sh","commandArgs":"","minError":1,"minWarning":1,"cwd":"/home/pm2user/.ecosystem-catalog/catalog","shell":"","extraArgumentProperty":"","envProperty":"","format":"utf8","limiter":true,"payloadIs":"argumentNoStdin","x":484.5,"y":386,"wires":[[],["9feb67be.1e39d8"],[]]},{"id":"eac99bac.c14ee8","type":"function","z":"a1cb3587.05ca68","name":"prepare-for-build","func":"pl = msg.payload;\n\nargs = {\n    \"type\": pl.type,\n    \"name\": pl.name,\n    \"version\": pl.version,\n    \"qualifier\":\"N\", \n    \"N\":{\n        \"pattern\":\"Build\",\n        \"name\": pl.pipelineName\n    }, \n    \"localUrl\": pl.url,\n    \"localBranch\": pl.branch\n};\n\nfunction replaceAll(str, find, replace) {\n  return str.replace(new RegExp(find, 'g'), replace);\n}\n\nargsString = replaceAll(JSON.stringify(args),'\"', '\"');\n\nmsg.payload = [\n    \"--lifecycle=wire\",\n    \"--solution=gocd\",\n    \"--action=update-pipeline-for-build\",\n    \"--args='\" + argsString + \"'\"].join(' ');\n\n\nreturn msg;\n\n","outputs":"1","noerr":0,"x":290,"y":159,"wires":[["ec0f5e65.28ec4"]]},{"id":"ec0f5e65.28ec4","type":"bigexec","z":"a1cb3587.05ca68","name":"","command":"/home/pm2user/canzea.sh","commandArgs":"","minError":1,"minWarning":1,"cwd":"/home/pm2user/.ecosystem-catalog/catalog","shell":"","extraArgumentProperty":"","envProperty":"","format":"utf8","limiter":true,"payloadIs":"argumentNoStdin","x":533,"y":191,"wires":[[],["9feb67be.1e39d8"],[]]},{"id":"68568a1e.58a984","type":"switch","z":"a1cb3587.05ca68","name":"","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"prepare-for-deploy","vt":"str"},{"t":"eq","v":"prepare-for-build","vt":"str"},{"t":"eq","v":"create-build-pipeline","vt":"str"},{"t":"eq","v":"create-deploy-pipeline","vt":"str"},{"t":"eq","v":"unpause","vt":"str"},{"t":"eq","v":"schedule","vt":"str"},{"t":"eq","v":"get-pipeline","vt":"str"},{"t":"eq","v":"get-environment","vt":"str"},{"t":"eq","v":"add-pipeline-to-environment","vt":"str"},{"t":"eq","v":"save-environment","vt":"str"},{"t":"eq","v":"enable-agent","vt":"str"},{"t":"eq","v":"disable-agent","vt":"str"},{"t":"eq","v":"link-agent-to-environment","vt":"str"},{"t":"eq","v":"unlink-agent-from-environment","vt":"str"},{"t":"eq","v":"delete-agent","vt":"str"},{"t":"eq","v":"plus:pipeline_environment","vt":"str"},{"t":"eq","v":"minus:pipeline_environment","vt":"str"},{"t":"eq","v":"plus:pipeline_pipeline","vt":"str"},{"t":"eq","v":"minus:pipeline_pipeline","vt":"str"},{"t":"eq","v":"unlink-pipeline-from-environment","vt":"str"},{"t":"else"}],"checkall":"false","outputs":21,"x":66,"y":238,"wires":[["bb42f351.29665"],["eac99bac.c14ee8"],["28da27c6.08b1d8"],["c5dd1680.b940f8"],["79cc2dd2.2e9744"],["4d099c74.66e8b4"],["5ca32374.a6013c"],["b426554a.f6fee8"],["cc918e27.33987"],["921157ec.f93fd8"],["5e74494e.dc0638"],["10776d95.1dd122"],["cee840ab.17eb7"],["7d0cb397.7fdecc"],["ca2ae57c.01b738"],["8481ad6b.e380e"],["99cf1bde.3fd588"],["db80eee6.42424","9381935.5677b7"],["db80eee6.42424"],["963cfeb0.49032"],["6a21d3e1.de7c0c"]]},{"id":"6ec8b063.eb31a","type":"function","z":"a1cb3587.05ca68","name":"Success","func":"msg.payload = '';\nmsg.statusCode = 200;\nreturn msg;","outputs":1,"noerr":0,"x":865,"y":289,"wires":[[]]},{"id":"c82394d4.3bd098","type":"function","z":"a1cb3587.05ca68","name":"Error","func":"msg.statusCode = 400;\nreturn msg;","outputs":1,"noerr":0,"x":855.5,"y":327,"wires":[[]]},{"id":"20839f2d.dca2c","type":"catch","z":"a1cb3587.05ca68","name":"","scope":null,"x":760,"y":386,"wires":[["62f08c58.9168b4","85db0135.02b9e"]]},{"id":"62f08c58.9168b4","type":"function","z":"a1cb3587.05ca68","name":"Error","func":"msg.payload = {\n    \"error\": msg.message\n};\nmsg.statusCode = 400;\nreturn msg;","outputs":1,"noerr":0,"x":934.5,"y":457,"wires":[[]]},{"id":"6a21d3e1.de7c0c","type":"function","z":"a1cb3587.05ca68","name":"Error","func":"msg.payload = 'Undefined topic' + msg.topic;\nreturn msg;","outputs":1,"noerr":0,"x":263,"y":696,"wires":[[]]},{"id":"dd651a31.1779b8","type":"debug","z":"a1cb3587.05ca68","name":"","active":true,"console":"false","complete":"true","x":1164.5,"y":334,"wires":[]},{"id":"bb42f351.29665","type":"function","z":"a1cb3587.05ca68","name":"prepare-for-deploy","func":"pl = msg.payload;\n\nargs = {\n    \"name\": pl.component,\n    \"version\": pl.version,\n    \"branch\" : pl.branch,\n    \"qualifier\":\"N\", \n    \"N\":{\n        \"pattern\":\"Deploy\",\n        \"name\": pl.pipelineName\n    }, \n    \"localUrl\": pl.url,\n    \"localBranch\": pl.branch,\n    \"build_pipeline\": pl.build_pipeline,\n    \"port\":pl.port,\n    \"env\":\"prod\"\n};\n\nfunction replaceAll(str, find, replace) {\n  return str.replace(new RegExp(find, 'g'), replace);\n}\n\nargsString = replaceAll(JSON.stringify(args),'\"', '\"');\n\nmsg.payload = [\n    \"--lifecycle=wire\",\n    \"--solution=gocd\",\n    \"--action=update-pipeline-for-deploy\",\n    \"--args='\" + argsString + \"'\"].join(' ');\n\nreturn msg;\n\n","outputs":"1","noerr":0,"x":281,"y":100,"wires":[["ec0f5e65.28ec4"]]},{"id":"c5dd1680.b940f8","type":"function","z":"a1cb3587.05ca68","name":"create-deploy-pipeline","func":"pl = msg.payload;\n\nargs = {\n    \"qualifier\": \"A\",\n    \"A\": {\n        \"type\":\"pipelines\",\n        \"name\": pl.pipelineName\n    }\n};\n\nfunction replaceAll(str, find, replace) {\n  return str.replace(new RegExp(find, 'g'), replace);\n}\n\nargsString = replaceAll(JSON.stringify(args),'\"', '\"');\n\nmsg.payload = \"--lifecycle=wire --solution=gocd --action=post-object --args='\" + argsString + \"'\";\n\nreturn msg;\n\n","outputs":"1","noerr":0,"x":291,"y":295,"wires":[["9ad44d91.13f87"]]},{"id":"b426554a.f6fee8","type":"function","z":"a1cb3587.05ca68","name":"Prepare Get Environment","func":"pl = msg.payload;\n\nargs = {\n    \"qualifier\": \"A\",\n    \"A\": {\n        \"type\":\"environments\",\n        \"name\":pl.environment,\n        \"version\": 2\n    }\n};\n\nfunction replaceAll(str, find, replace) {\n  return str.replace(new RegExp(find, 'g'), replace);\n}\n\nargsString = replaceAll(JSON.stringify(args),'\"', '\"');\n\nmsg.payload = \"--lifecycle=wire --solution=gocd --action=get-admin-object --args='\" + argsString + \"'\";\n\nreturn msg;\n\n","outputs":"1","noerr":0,"x":312,"y":491,"wires":[["5b613472.09fcdc"]]},{"id":"921157ec.f93fd8","type":"function","z":"a1cb3587.05ca68","name":"Prepare Save Environment","func":"pl = msg.payload;\n\nargs = {\n    \"qualifier\": \"A\",\n    \"A\": {\n        \"type\":\"environments\",\n        \"name\":pl.environment\n    }\n};\n\nfunction replaceAll(str, find, replace) {\n  return str.replace(new RegExp(find, 'g'), replace);\n}\n\nargsString = replaceAll(JSON.stringify(args),'\"', '\"');\n\nmsg.payload = \"--lifecycle=wire --solution=gocd --action=put-admin-object --args='\" + argsString + \"'\";\n\nreturn msg;\n\n","outputs":"1","noerr":0,"x":322,"y":576,"wires":[["5b613472.09fcdc"]]},{"id":"c9bc3421.f55bd8","type":"debug","z":"a1cb3587.05ca68","name":"","active":true,"console":"false","complete":"false","x":873.5,"y":513,"wires":[]},{"id":"5e74494e.dc0638","type":"function","z":"a1cb3587.05ca68","name":"Enable Agent","func":"pl = msg.payload;\n\nargs = {\n    \"agent\": pl.agent\n};\n\nfunction replaceAll(str, find, replace) {\n  return str.replace(new RegExp(find, 'g'), replace);\n}\n\nargsString = replaceAll(JSON.stringify(args),'\"', '\"');\n\nmsg.payload = \"--lifecycle=wire --solution=gocd --action=combined/enable-agent --args='\" + argsString + \"'\";\n\nreturn msg;\n\n","outputs":"1","noerr":0,"x":270,"y":741,"wires":[["5b613472.09fcdc"]]},{"id":"85db0135.02b9e","type":"function","z":"a1cb3587.05ca68","name":"","func":"msg.flow = 'GoCD Pipeline';\nreturn msg;","outputs":1,"noerr":0,"x":1017.5,"y":339,"wires":[["dd651a31.1779b8"]]},{"id":"cee840ab.17eb7","type":"function","z":"a1cb3587.05ca68","name":"Link Agent to Environment","func":"pl = msg.payload;\n\nargs = {\n    \"environment\": pl.environment,\n    \"agent\": pl.agent\n};\n\nfunction replaceAll(str, find, replace) {\n  return str.replace(new RegExp(find, 'g'), replace);\n}\n\nargsString = replaceAll(JSON.stringify(args),'\"', '\\\"');\n\nmsg.payload = \"--lifecycle=wire --solution=gocd --action=combined/add-agent-to-env --args='\" + argsString + \"'\";\n\nreturn msg;\n\n","outputs":"1","noerr":0,"x":313,"y":789,"wires":[["5b613472.09fcdc"]]},{"id":"7d0cb397.7fdecc","type":"function","z":"a1cb3587.05ca68","name":"Unlink Agent from Environment","func":"pl = msg.payload;\n\nargs = {\n    \"environment\": pl.environment,\n    \"agent\": pl.agent\n};\n\nfunction replaceAll(str, find, replace) {\n  return str.replace(new RegExp(find, 'g'), replace);\n}\n\nargsString = replaceAll(JSON.stringify(args),'\"', '\\\"');\n\nmsg.payload = \"--lifecycle=wire --solution=gocd --action=combined/unlink-agent-from-environment --args='\" + argsString + \"'\";\n\nreturn msg;\n\n","outputs":"1","noerr":0,"x":320,"y":831.25,"wires":[["5b613472.09fcdc"]]},{"id":"ca2ae57c.01b738","type":"function","z":"a1cb3587.05ca68","name":"Delete Agent","func":"pl = msg.payload;\n\nargs = {\n    \"environment\": pl.environment,\n    \"agent\": pl.agent\n};\n\nfunction replaceAll(str, find, replace) {\n  return str.replace(new RegExp(find, 'g'), replace);\n}\n\nargsString = replaceAll(JSON.stringify(args),'\"', '\"');\n\nmsg.payload = \"--lifecycle=wire --solution=gocd --action=combined/delete-agent --args='\" + argsString + \"'\";\n\nreturn msg;\n\n","outputs":"1","noerr":0,"x":263.75,"y":870,"wires":[["5b613472.09fcdc"]]},{"id":"8481ad6b.e380e","type":"function","z":"a1cb3587.05ca68","name":"Create Environment","func":"pl = msg.payload;\n\nargs = {\n    \"name\": msg.key\n};\n\nfunction replaceAll(str, find, replace) {\n  return str.replace(new RegExp(find, 'g'), replace);\n}\n\nargsString = replaceAll(JSON.stringify(args), '\"', '\"');\n\n//argsString = JSON.stringify(args);\n\nnode.warn(\"Arg String : \" +argsString);\n\nmsg.payload = \"--lifecycle=wire --solution=gocd --action=create-environment --args='\" + argsString + \"'\";\n\nnode.warn(\"Payload : \" + msg.payload);\n\nreturn msg;\n\n","outputs":"1","noerr":0,"x":301,"y":622,"wires":[["5b613472.09fcdc"]]},{"id":"99cf1bde.3fd588","type":"function","z":"a1cb3587.05ca68","name":"Delete Environment","func":"pl = msg.payload;\n\nargs = {\n    \"type\": \"environments\",\n    \"name\": msg.key,\n    \"qualifier\": \"N/A\"\n};\n\nfunction replaceAll(str, find, replace) {\n  return str.replace(new RegExp(find, 'g'), replace);\n}\n\nargsString = replaceAll(JSON.stringify(args), '\"', '\"');\n\nmsg.payload = \"--lifecycle=wire --solution=gocd --action=delete-object --args='\" + argsString + \"'\";\n\nreturn msg;\n\n","outputs":"1","noerr":0,"x":292,"y":654,"wires":[["5b613472.09fcdc"]]},{"id":"10776d95.1dd122","type":"function","z":"a1cb3587.05ca68","name":"Disable Agent","func":"pl = msg.payload;\n\nargs = {\n    \"agent\": pl.agent\n};\n\nfunction replaceAll(str, find, replace) {\n  return str.replace(new RegExp(find, 'g'), replace);\n}\n\nargsString = replaceAll(JSON.stringify(args),'\"', '\"');\n\nmsg.payload = \"--lifecycle=wire --solution=gocd --action=combined/disable-agent --args='\" + argsString + \"'\";\n\nreturn msg;\n\n","outputs":"1","noerr":0,"x":278,"y":768,"wires":[["5b613472.09fcdc"]]},{"id":"963cfeb0.49032","type":"function","z":"a1cb3587.05ca68","name":"Unlink Pipeline from Environment","func":"pl = msg.payload;\n\nargs = {\n    \"environment\": pl.environment,\n    \"pipeline\": pl.pipeline\n};\n\nfunction replaceAll(str, find, replace) {\n  return str.replace(new RegExp(find, 'g'), replace);\n}\n\nargsString = replaceAll(JSON.stringify(args),'\"', '\\\"');\n\nmsg.payload = \"--lifecycle=wire --solution=gocd --action=combined/unlink-pipeline-from-environment --args='\" + argsString + \"'\";\n\nreturn msg;\n\n","outputs":"1","noerr":0,"x":334,"y":955,"wires":[["5b613472.09fcdc"]]},{"id":"862cd383.bbfce","type":"function","z":"a1cb3587.05ca68","name":"prepare-for-build","func":"pl = msg.payload;\n\nargs = {\n    \"type\": pl.type,\n    \"name\": pl.name,\n    \"version\": pl.version,\n    \"qualifier\":\"N\", \n    \"N\":{\n        \"pattern\":\"Build\",\n        \"name\": msg.key\n    }, \n    \"localUrl\": pl.url,\n    \"localBranch\": pl.branch\n};\n\nfunction replaceAll(str, find, replace) {\n  return str.replace(new RegExp(find, 'g'), replace);\n}\n\nargsString = replaceAll(JSON.stringify(args),'\"', '\"');\n\nmsg.payload = [\n    \"--lifecycle=wire\",\n    \"--solution=gocd\",\n    \"--action=combined/add-pipeline\",\n    \"--args='\" + argsString + \"'\"].join(' ');\n\n\nreturn msg;\n\n","outputs":"1","noerr":0,"x":312,"y":1043,"wires":[["5b613472.09fcdc"]]},{"id":"db80eee6.42424","type":"subflow:109c70f5.f87c1f","z":"a1cb3587.05ca68","name":"","x":596.5,"y":58,"wires":[[]],"subflow":"109c70f5.f87c1f"},{"id":"9381935.5677b7","type":"debug","z":"a1cb3587.05ca68","name":"","active":true,"console":"false","complete":"false","x":310.5,"y":46,"wires":[]},{"id":"a1cb3587.05ca68","type":"subflow","name":"Go.CD Pipelines v1","info":"","in":[{"x":50,"y":30,"wires":[{"id":"68568a1e.58a984"}]}],"out":[{"x":1154,"y":507,"wires":[{"id":"6ec8b063.eb31a","port":0},{"id":"c82394d4.3bd098","port":0},{"id":"62f08c58.9168b4","port":0},{"id":"6a21d3e1.de7c0c","port":0}]},{"x":749,"y":54,"wires":[{"id":"db80eee6.42424","port":0}]}]},{"id":"39f65ba.c8c33a4","type":"function","z":"cfce5daf.36867","name":"Prep New Application","func":"args = msg.payload;\n\nfunction replaceAll(str, find, replace) {\n  return str.replace(new RegExp(find, 'g'), replace);\n}\n\nargsString = replaceAll(JSON.stringify(args),'\"', '\"');\n\nmsg.payload = \"--lifecycle=wire --solution=branching --action=new-application --args='\" + argsString + \"'\";\n\nreturn msg;\n","outputs":1,"noerr":0,"x":379,"y":142,"wires":[["55cf36b7.64ee48"]]},{"id":"55cf36b7.64ee48","type":"bigexec","z":"cfce5daf.36867","name":"","command":"/home/pm2user/canzea.sh","commandArgs":"","minError":1,"minWarning":1,"cwd":"/home/pm2user/.ecosystem-catalog/catalog","shell":"","extraArgumentProperty":"","envProperty":"","format":"utf8","limiter":true,"payloadIs":"argumentNoStdin","x":646.5,"y":222,"wires":[[],["d298e2e7.03682"],[]]},{"id":"b28af2e.55eca1","type":"function","z":"cfce5daf.36867","name":"Prep Merge Develop","func":"pl = msg.payload;\nname = pl.name;\n\nargs = {\n    \"type\": pl.type,\n    \"app\": pl.name,\n    \"url\": pl.url,\n    \"branch\": pl.branch\n};\n\nfunction replaceAll(str, find, replace) {\n  return str.replace(new RegExp(find, 'g'), replace);\n}\n\nargsString = replaceAll(JSON.stringify(args),'\"', '\"');\n\nmsg.payload = \"--lifecycle=wire --solution=branching --action=merge-develop --args='\" + argsString + \"'\";\n\nreturn msg;\n","outputs":1,"noerr":0,"x":394.5,"y":251,"wires":[["55cf36b7.64ee48"]]},{"id":"4e42501f.4bc4a","type":"function","z":"cfce5daf.36867","name":"Prep Finish","func":"pl = msg.payload;\n\nargs = {\n    \"type\": pl.type,\n    \"app\": pl.name,\n    \"url\": pl.url,\n    \"branch\": pl.branch\n};\n\nfunction replaceAll(str, find, replace) {\n  return str.replace(new RegExp(find, 'g'), replace);\n}\n\nargsString = replaceAll(JSON.stringify(args),'\"', '\"');\n\nmsg.payload = \"--lifecycle=wire --solution=branching --action=finish --args='\" + argsString + \"'\";\n\nreturn msg;\n","outputs":1,"noerr":0,"x":367.5,"y":305,"wires":[["55cf36b7.64ee48"]]},{"id":"4a59b7b.19cba48","type":"function","z":"cfce5daf.36867","name":"Prep Cleanup","func":"pl = msg.payload;\nname = pl.name;\n\nargs = {\n    \"type\": pl.type,\n    \"app\": pl.name,\n    \"url\": pl.url,\n    \"branch\": pl.branch\n};\n\nfunction replaceAll(str, find, replace) {\n  return str.replace(new RegExp(find, 'g'), replace);\n}\n\nargsString = replaceAll(JSON.stringify(args),'\"', '\"');\n\nmsg.payload = \"--lifecycle=wire --solution=branching --action=cleanup --args='\" + argsString + \"'\";\n\nreturn msg;\n","outputs":1,"noerr":0,"x":375.5,"y":351,"wires":[["55cf36b7.64ee48"]]},{"id":"35717101.a446fe","type":"function","z":"cfce5daf.36867","name":"Prep Create","func":"pl = msg.payload;\n\nargs = {\n    \"type\": pl.type,\n    \"app\": pl.name,\n    \"url\": pl.url,\n    \"branch\": pl.branch\n};\n\nfunction replaceAll(str, find, replace) {\n  return str.replace(new RegExp(find, 'g'), replace);\n}\n\nargsString = replaceAll(JSON.stringify(args),'\"', '\"');\n\nmsg.payload = \"--lifecycle=wire --solution=branching --action=create --args='\" + argsString + \"'\";\n\nreturn msg;\n","outputs":1,"noerr":0,"x":352.5,"y":194,"wires":[["55cf36b7.64ee48"]]},{"id":"d298e2e7.03682","type":"switch","z":"cfce5daf.36867","name":"","property":"control.state","propertyType":"msg","rules":[{"t":"eq","v":"start","vt":"str"},{"t":"eq","v":"running","vt":"str"},{"t":"eq","v":"end","vt":"str"},{"t":"eq","v":"error","vt":"str"}],"checkall":"false","outputs":4,"x":782,"y":222,"wires":[[],[],["e336eb48.cc1b78"],["8b4ccd03.63b6f"]]},{"id":"e336eb48.cc1b78","type":"function","z":"cfce5daf.36867","name":"Success","func":"msg.payload = '';\nreturn msg;","outputs":1,"noerr":0,"x":941.5,"y":215,"wires":[[]]},{"id":"8b4ccd03.63b6f","type":"function","z":"cfce5daf.36867","name":"Error","func":"msg.statusCode = 400;\nreturn msg;","outputs":1,"noerr":0,"x":932,"y":253,"wires":[[]]},{"id":"5383f2c9.36f0cc","type":"catch","z":"cfce5daf.36867","name":"","scope":null,"x":908.5,"y":363,"wires":[["97def39a.c6821"]]},{"id":"97def39a.c6821","type":"function","z":"cfce5daf.36867","name":"Error","func":"msg.payload = {\n    \"error\": msg.message\n};\nmsg.statusCode = 400;\nreturn msg;","outputs":1,"noerr":0,"x":1037,"y":363,"wires":[[]]},{"id":"b208c042.9883c","type":"switch","z":"cfce5daf.36867","name":"","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"new","vt":"str"},{"t":"eq","v":"create","vt":"str"},{"t":"eq","v":"merge-develop","vt":"str"},{"t":"eq","v":"finish","vt":"str"},{"t":"eq","v":"cleanup","vt":"str"},{"t":"else"}],"checkall":"false","outputs":6,"x":153,"y":218,"wires":[["39f65ba.c8c33a4"],["35717101.a446fe"],["b28af2e.55eca1"],["4e42501f.4bc4a"],["4a59b7b.19cba48"],["877c34dc.fb22f8"]]},{"id":"877c34dc.fb22f8","type":"function","z":"cfce5daf.36867","name":"Error","func":"msg.payload = 'Undefined topic' + msg.topic;\nreturn msg;","outputs":1,"noerr":0,"x":588,"y":492,"wires":[[]]},{"id":"cfce5daf.36867","type":"subflow","name":"Versioning","info":"","in":[{"x":67,"y":50,"wires":[{"id":"b208c042.9883c"}]}],"out":[{"x":1145,"y":278,"wires":[{"id":"97def39a.c6821","port":0},{"id":"8b4ccd03.63b6f","port":0},{"id":"e336eb48.cc1b78","port":0},{"id":"877c34dc.fb22f8","port":0}]}]},{"id":"ef505d18.7367","type":"switch","z":"a6b9a798.463af8","name":"","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"list-components","vt":"str"},{"t":"eq","v":"set-key-value","vt":"str"},{"t":"eq","v":"list-health","vt":"str"},{"t":"eq","v":"list-service-health","vt":"str"},{"t":"cont","v":"service","vt":"str"},{"t":"else"}],"checkall":"false","outputs":6,"x":145.61111450195312,"y":178.22222900390625,"wires":[["6a433a50.1ba1d4"],["6a433a50.1ba1d4"],["ad4df813.558948"],["9da3fb6f.18c028"],["33fad3f.b4b082c"],["7f08106e.19757"]]},{"id":"dbf15835.5ee688","type":"catch","z":"a6b9a798.463af8","name":"","scope":null,"x":672.5,"y":21,"wires":[["6dd7b3d.d4dda4c"]]},{"id":"6dd7b3d.d4dda4c","type":"function","z":"a6b9a798.463af8","name":"Error","func":"msg.payload = {\n    \"error\": msg.message\n};\nmsg.statusCode = 400;\nreturn msg;","outputs":1,"noerr":0,"x":826,"y":23,"wires":[[]]},{"id":"5e75657b.1e49bc","type":"function","z":"a6b9a798.463af8","name":"Error","func":"return msg;","outputs":1,"noerr":0,"x":703,"y":211,"wires":[[]]},{"id":"7f08106e.19757","type":"function","z":"a6b9a798.463af8","name":"Invalid Topic","func":"msg.payload = {\n    \"error\": \"Unknown topic \" + msg.topic\n};\nmsg.statusCode = 500;\nreturn msg;","outputs":1,"noerr":0,"x":430,"y":320,"wires":[[]]},{"id":"bcc4f1bb.54c44","type":"http request","z":"a6b9a798.463af8","name":"POST","method":"PUT","ret":"txt","url":"https://consul.service.dc1.consul:8080/v1/agent/service/register","tls":"c792be07.29d4","x":610,"y":400,"wires":[["bde421d8.76287"]]},{"id":"3a3892f4.b262fe","type":"http request","z":"a6b9a798.463af8","name":"DELETE","method":"PUT","ret":"txt","url":"https://consul.service.dc1.consul:8080/v1/agent/service/deregister/{{key}}","tls":"c792be07.29d4","x":481,"y":443,"wires":[["bde421d8.76287"]]},{"id":"e8540b41.b7f818","type":"http request","z":"a6b9a798.463af8","name":"GET LIST","method":"GET","ret":"txt","url":"https://consul.service.dc1.consul:8080/v1/health/state/{{payload.state}}","tls":"c792be07.29d4","x":482,"y":482,"wires":[["bde421d8.76287"]]},{"id":"b3150035.75da2","type":"switch","z":"a6b9a798.463af8","name":"","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","outputs":2,"x":660,"y":170,"wires":[[],["5e75657b.1e49bc"]]},{"id":"5d11203e.7932a","type":"http request","z":"a6b9a798.463af8","name":"GET SERVICES","method":"GET","ret":"txt","url":"https://consul.service.dc1.consul:8080/v1/agent/services","tls":"","x":458,"y":169,"wires":[["b3150035.75da2"]]},{"id":"aed4e776.4f6468","type":"http request","z":"a6b9a798.463af8","name":"GET KEY VALUES","method":"GET","ret":"obj","url":"https://consul.service.dc1.consul:8080/v1/kv/{{{payload.key}}}","tls":"c792be07.29d4","x":445,"y":60,"wires":[["adf50611.70f568","3b45a3ac.e78b7c"]]},{"id":"64b7d53f.ea6cfc","type":"http request","z":"a6b9a798.463af8","name":"SET KEY VALUE","method":"PUT","ret":"txt","url":"https://consul.service.dc1.consul:8080/v1/kv/{{key}}","tls":"c792be07.29d4","x":444,"y":99,"wires":[["adf50611.70f568"]]},{"id":"86013aba.94fb18","type":"function","z":"a6b9a798.463af8","name":"","func":"msg.payload['ID'] = msg.key;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":471.5,"y":400,"wires":[["bcc4f1bb.54c44"]]},{"id":"33fad3f.b4b082c","type":"switch","z":"a6b9a798.463af8","name":"SERVICES","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"plus:service_discovery_service","vt":"str"},{"t":"eq","v":"minus:service_discovery_service","vt":"str"},{"t":"eq","v":"check:service_discovery_service","vt":"str"},{"t":"eq","v":"list-services","vt":"str"}],"checkall":"false","outputs":4,"x":285,"y":454,"wires":[["86013aba.94fb18"],["3a3892f4.b262fe"],["e8540b41.b7f818"],["e677b09d.f63f1"]]},{"id":"e677b09d.f63f1","type":"http request","z":"a6b9a798.463af8","name":"GET SERVICES","method":"GET","ret":"txt","url":"https://consul.service.dc1.consul:8080/v1/agent/services","tls":"c792be07.29d4","x":503,"y":522,"wires":[["bde421d8.76287"]]},{"id":"6a433a50.1ba1d4","type":"switch","z":"a6b9a798.463af8","name":"KEYVAL","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"list-components","vt":"str"},{"t":"eq","v":"set-key-value","vt":"str"}],"checkall":"false","outputs":2,"x":278,"y":81,"wires":[["aed4e776.4f6468"],["64b7d53f.ea6cfc"]]},{"id":"b41465b0.dff418","type":"function","z":"a6b9a798.463af8","name":"Success","func":"msg.payload = (msg.payload.data ? msg.payload.data : msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":800,"y":60,"wires":[[]]},{"id":"adf50611.70f568","type":"switch","z":"a6b9a798.463af8","name":"","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","outputs":2,"x":645.5,"y":78,"wires":[["b41465b0.dff418"],["6b9c82dc.ca52ec"]]},{"id":"6b9c82dc.ca52ec","type":"function","z":"a6b9a798.463af8","name":"Error","func":"msg.payload = {\n    \"error\": msg.payload\n};\nmsg.statusCode = 400;\nreturn msg;","outputs":1,"noerr":0,"x":785.5,"y":102,"wires":[[]]},{"id":"1497a281.b22ffd","type":"function","z":"a6b9a798.463af8","name":"Success","func":"msg.payload = (msg.payload.data ? msg.payload.data:msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":910,"y":445,"wires":[[]]},{"id":"bde421d8.76287","type":"switch","z":"a6b9a798.463af8","name":"","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","outputs":2,"x":771.5,"y":464,"wires":[["1497a281.b22ffd"],["d584c3b6.b66d"]]},{"id":"d584c3b6.b66d","type":"function","z":"a6b9a798.463af8","name":"Error","func":"return msg;","outputs":1,"noerr":0,"x":903.5,"y":481,"wires":[[]]},{"id":"3b45a3ac.e78b7c","type":"debug","z":"a6b9a798.463af8","name":"","active":true,"console":"false","complete":"true","x":1010,"y":40,"wires":[]},{"id":"9da3fb6f.18c028","type":"http request","z":"a6b9a798.463af8","name":"SERVICE HEALTH","method":"GET","ret":"txt","url":"https://consul.service.dc1.consul:8080/v1/health/service/{{{payload.service}}}","tls":"c792be07.29d4","x":450,"y":260,"wires":[["fb5d2f2a.65202"]]},{"id":"fb5d2f2a.65202","type":"switch","z":"a6b9a798.463af8","name":"","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","outputs":2,"x":630,"y":260,"wires":[[],["5e75657b.1e49bc"]]},{"id":"ad4df813.558948","type":"http request","z":"a6b9a798.463af8","name":"BY HEALTH","method":"GET","ret":"txt","url":"https://consul.service.dc1.consul:8080/v1/health/state/{{{payload.state}}}","tls":"c792be07.29d4","x":430,"y":220,"wires":[["fb5d2f2a.65202"]]},{"id":"a6b9a798.463af8","type":"subflow","name":"Consul Services","info":"","in":[{"x":50,"y":179,"wires":[{"id":"ef505d18.7367"}]}],"out":[{"x":1040,"y":220,"wires":[{"id":"5e75657b.1e49bc","port":0},{"id":"7f08106e.19757","port":0},{"id":"6dd7b3d.d4dda4c","port":0},{"id":"b3150035.75da2","port":0},{"id":"b41465b0.dff418","port":0},{"id":"6b9c82dc.ca52ec","port":0},{"id":"1497a281.b22ffd","port":0},{"id":"d584c3b6.b66d","port":0},{"id":"fb5d2f2a.65202","port":0}]}]},{"id":"ed51b3f2.faa4f","type":"debug","z":"78d32ab1.ca8c04","name":"","active":true,"console":"false","complete":"true","x":382.5,"y":95,"wires":[]},{"id":"fb88b106.0a1f5","type":"function","z":"78d32ab1.ca8c04","name":"Process Event","func":"if (msg.statusCode >= 200 && msg.statusCode < 300) {\n    node.warn(\"SUCCESS [\" + msg.topic + \"] \" + JSON.stringify(msg.payload));\n} else {\n    node.warn(\"FAILURE [\" + msg.topic + \"]\" + JSON.stringify(msg.payload));\n}\nmsg.payload = {\n    \"statusCode\" : msg.statusCode,\n    \"result\" : msg.payload\n}\nreturn msg;","outputs":1,"noerr":0,"x":376.5,"y":154,"wires":[[]]},{"id":"68e752dc.2a343c","type":"es-create","z":"78d32ab1.ca8c04","name":"","documentIndex":"flowsgateway","documentType":"metrics","server":"c3f3e417.af7f68","x":478.5,"y":261,"wires":[[]]},{"id":"34ca5a39.444d36","type":"function","z":"78d32ab1.ca8c04","name":"","func":"msg.payload = {\n    \"statusCode\" : msg.statusCode,\n    \"result\" : msg.payload,\n    \"@timestamp\" : Date.now(),\n    \"triggerDate\" : new Date().toISOString()\n}\nmsg.documentType = msg.topic;\nmsg.documentId = msg._msgid;\nreturn msg;","outputs":1,"noerr":0,"x":312.5,"y":261,"wires":[["68e752dc.2a343c","777e7524.37916c"]]},{"id":"777e7524.37916c","type":"debug","z":"78d32ab1.ca8c04","name":"","active":true,"console":"false","complete":"true","x":416.5,"y":315,"wires":[]},{"id":"42d9b7bf.1aaf68","type":"subflow:459ae946.b59388","z":"78d32ab1.ca8c04","x":540,"y":200,"wires":[[]],"subflow":"459ae946.b59388"},{"id":"8374fceb.06d8d","type":"function","z":"78d32ab1.ca8c04","name":"","func":"p = msg.payload;\nmsg.channel = 'general';\n\nsuccess = (msg.statusCode >= 200 && msg.statusCode <= 299);\n\nmsg.payload = \"Gateway Call \" + (success ? 'Succeeded':'Failed');\n\ncolor = (success ? '#00ff00' : '#ff0000');\n\ntextmsgs = [\n    \"**> \" + msg.topic + '**'\n];\nif (msg.key) {\n    textmsgs.push(\"** \" + msg.key + '**');\n}\n\nif (!success) {\n    textmsgs.push ('\\n' + JSON.stringify(JSON.parse(p), null, 2));\n}\nmsg.topic = 'send-message';\nmsg.payload = {\n    \"text\": msg.payload,\n    \"avatar\": \"https://es0390.canzea.cc/images/canzea_gw_icon_es.svg\",\n    \"attachments\": [{\n        \"color\": color,\n        \"text\": textmsgs.join('\\n')\n    }]\n};\nreturn msg;\n","outputs":1,"noerr":0,"x":320,"y":201,"wires":[["42d9b7bf.1aaf68"]]},{"id":"a97f301b.affa7","type":"catch","z":"78d32ab1.ca8c04","name":"","scope":null,"x":133.5,"y":41,"wires":[["de0f054f.e51b58"]]},{"id":"90376924.59bff8","type":"debug","z":"78d32ab1.ca8c04","name":"","active":true,"console":"false","complete":"false","x":370,"y":40,"wires":[]},{"id":"de0f054f.e51b58","type":"function","z":"78d32ab1.ca8c04","name":"","func":"msg.payload = 'Caught error on Async Events ' + msg.payload;\nreturn msg;","outputs":1,"noerr":0,"x":240.5,"y":80,"wires":[["90376924.59bff8"]]},{"id":"c3f3e417.af7f68","type":"remote-server","z":"78d32ab1.ca8c04","name":"mon-elastic","host":"http://elasticsearch.service.dc1.consul:9200"},{"id":"78d32ab1.ca8c04","type":"subflow","name":"Async Events","info":"","in":[{"x":197,"y":153,"wires":[{"id":"ed51b3f2.faa4f"},{"id":"fb88b106.0a1f5"},{"id":"34ca5a39.444d36"},{"id":"8374fceb.06d8d"}]}],"out":[{"x":541,"y":154,"wires":[{"id":"fb88b106.0a1f5","port":0}]}]},{"id":"39129e2d.1b8d12","type":"catch","z":"9e3e25e6.0e0308","name":"","scope":null,"x":258,"y":492,"wires":[["1e7d8fe.133aa7"]]},{"id":"1e7d8fe.133aa7","type":"function","z":"9e3e25e6.0e0308","name":"Unexpected Error","func":"msg.payload = {\n    \"source\": \"flows_gateway\",\n    \"message\": msg.error,\n    \"detail\": msg._error\n} \nmsg.statusCode = 400\nreturn msg;","outputs":1,"noerr":0,"x":435,"y":494,"wires":[["9020744f.79bbf8"]]},{"id":"a4de2042.85a16","type":"switch","z":"9e3e25e6.0e0308","name":"","property":"resource","propertyType":"msg","rules":[{"t":"eq","v":"collaboration_channel","vt":"str"},{"t":"eq","v":"collaboration_message","vt":"str"},{"t":"eq","v":"pipeline_environment","vt":"str"},{"t":"eq","v":"pipeline_pipeline","vt":"str"},{"t":"eq","v":"service_discovery_service","vt":"str"},{"t":"eq","v":"component_metadata","vt":"str"},{"t":"eq","v":"vault_policy","vt":"str"},{"t":"eq","v":"vault_user","vt":"str"},{"t":"eq","v":"vault_secret","vt":"str"},{"t":"eq","v":"monitoring_dashboard","vt":"str"},{"t":"eq","v":"monitoring_datasource","vt":"str"},{"t":"eq","v":"grafana_auth_key","vt":"str"},{"t":"eq","v":"source_control_repository","vt":"str"},{"t":"eq","v":"source_control_user","vt":"str"},{"t":"eq","v":"source_control_user_repo","vt":"str"},{"t":"eq","v":"source_control_token","vt":"str"},{"t":"eq","v":"source_control_public_key","vt":"str"},{"t":"eq","v":"service_endpoint","vt":"str"},{"t":"else"}],"checkall":"false","outputs":19,"x":246,"y":209,"wires":[["bcb3534d.a0a29"],["e205a621.617e18"],["25e8c9ea.4e0b46"],["25e8c9ea.4e0b46"],["b1d6a9aa.fd1098"],["218de7de.341c28"],["a00b6013.c2f58"],["a00b6013.c2f58"],["a00b6013.c2f58"],["c01a6c07.e2379"],["c01a6c07.e2379"],["c01a6c07.e2379"],["c36921e9.a1a59"],["c36921e9.a1a59"],["c36921e9.a1a59"],["c36921e9.a1a59"],["c36921e9.a1a59"],["7c64ea81.28e544"],["ed9292b3.ee39b"]]},{"id":"bcb3534d.a0a29","type":"subflow:4fc6c84.9271b38","z":"9e3e25e6.0e0308","x":445,"y":110,"wires":[["9020744f.79bbf8"]],"subflow":"4fc6c84.9271b38"},{"id":"25e8c9ea.4e0b46","type":"subflow:a1cb3587.05ca68","z":"9e3e25e6.0e0308","name":"","x":422,"y":184,"wires":[["9020744f.79bbf8"],["9020744f.79bbf8"]],"subflow":"a1cb3587.05ca68"},{"id":"9020744f.79bbf8","type":"subflow:78d32ab1.ca8c04","z":"9e3e25e6.0e0308","name":"","x":858,"y":231,"wires":[[]],"subflow":"78d32ab1.ca8c04"},{"id":"b1d6a9aa.fd1098","type":"subflow:a6b9a798.463af8","z":"9e3e25e6.0e0308","x":422,"y":220,"wires":[["9020744f.79bbf8"]],"subflow":"a6b9a798.463af8"},{"id":"ed9292b3.ee39b","type":"function","z":"9e3e25e6.0e0308","name":"Invalid Resource","func":"msg.payload = {\n    \"source\": \"flows_gateway\",\n    \"message\": \"Invalid resource \" + msg.resource\n} \nmsg.statusCode = 400\nreturn msg;","outputs":1,"noerr":0,"x":429.5,"y":456,"wires":[["9020744f.79bbf8"]]},{"id":"218de7de.341c28","type":"subflow:ea5122d7.76e78","z":"9e3e25e6.0e0308","name":"","x":409,"y":254,"wires":[["9020744f.79bbf8"]],"subflow":"ea5122d7.76e78"},{"id":"1310b17.58a994f","type":"function","z":"9e3e25e6.0e0308","name":"Set Resource","func":"msg.resource = msg.topic.split(':')[1];\nreturn msg;","outputs":1,"noerr":0,"x":182.5,"y":32,"wires":[["6d409ec7.5f861","2e52c9f5.387d56"]]},{"id":"6d409ec7.5f861","type":"debug","z":"9e3e25e6.0e0308","name":"","active":true,"console":"false","complete":"false","x":374.5,"y":38,"wires":[]},{"id":"2e52c9f5.387d56","type":"json-schema","z":"9e3e25e6.0e0308","name":"","func":"{\n    \"$schema\": \"http://json-schema.org/draft-04/schema#\",\n    \"title\": \"Resources\",\n    \"type\": \"object\",\n    \"properties\": {\n        \"collaboration_channel\": {\n            \"description\": \"Channel\",\n            \"type\": \"object\",\n            \"patternProperties\": {\n                \"^.*$\": {\n                  \"anyOf\": [\n                    {\"type\": \"object\",\n\n                        \"properties\": {\n                        }\n                    }\n                ]\n                }\n            }\n        },\n        \"pipeline_environment\": {\n            \"description\": \"Pipeline Environment\",\n            \"type\": \"object\",\n            \"patternProperties\": {\n                \"^.*$\": {\n                  \"anyOf\": [\n                    {\"type\": \"object\",\n                        \"properties\": {\n                        }\n                    }\n                ]\n                }\n            }\n        },\n        \"pipeline_pipeline\": {\n            \"description\": \"Pipeline Pipeline\",\n            \"type\": \"object\",\n            \"patternProperties\": {\n                \"^.*$\": {\n                  \"anyOf\": [\n                    {\"type\": \"object\",\n                        \"properties\": {\n                        }\n                    }\n                ]\n                }\n            }\n        },        \n        \"service_discovery_service\": {\n            \"description\": \"Service Discovery Service\",\n            \"type\": \"object\",\n            \"patternProperties\": {\n                \"^.*$\": {\n                  \"anyOf\": [\n                    {\"type\": \"object\",\n                        \"properties\": {\n                            \"Name\": {\n                                \"type\": \"string\"\n                            },\n                            \"Address\": {\n                                \"type\": \"string\"\n                            },\n                            \"Port\": {\n                                \"type\": \"number\"\n                            },\n                            \"Tags\": {\n                                \"type\": \"array\",\n                                \"items\": {\n                                    \"type\": \"string\"\n                                }\n                            },\n                            \"Check\": {\n                                \"type\": \"object\",\n                                \"properties\": {\n                                    \"http\": {\n                                        \"type\": \"string\"\n                                    },\n                                    \"interval\": {\n                                        \"type\": \"string\"\n                                    },\n                                    \"timeout\": {\n                                        \"type\": \"string\"\n                                    }\n                                }\n                            }\n                            \n                        },\n                        \"required\": [\"Name\"]\n                    }\n                ]\n                }\n            }\n        },\n        \"component_metadata\": {\n            \"description\": \"Component Metadata\",\n            \"type\": \"object\",\n            \"patternProperties\": {\n                \"^.*$\": {\n                  \"anyOf\": [\n                    {\"type\": \"object\",\n\n                        \"properties\": {\n                        }\n                    }\n                ]\n                }\n            }\n        },\n        \"source_control_user\": {\n            \"description\": \"Source Control User\",\n            \"type\": \"object\",\n            \"patternProperties\": {\n                \"^.*$\": {\n                  \"anyOf\": [\n                    {\"type\": \"object\",\n                        \"properties\": {\n                        }\n                    }\n                ]\n                }\n            }\n        },\n        \"source_control_repository\": {\n            \"description\": \"Source Control Repository\",\n            \"type\": \"object\",\n            \"patternProperties\": {\n                \"^.*$\": {\n                  \"anyOf\": [\n                    {\"type\": \"object\",\n                        \"properties\": {\n                        }\n                    }\n                ]\n                }\n            }\n        },\n        \"vault_user\": {\n            \"description\": \"Vault User\",\n            \"type\": \"object\",\n            \"patternProperties\": {\n                \"^.*$\": {\n                  \"anyOf\": [\n                    {\"type\": \"object\",\n                        \"properties\": {\n                        }\n                    }\n                ]\n                }\n            }\n        },\n        \"vault_policy\": {\n            \"type\": \"object\",\n            \"patternProperties\": {\n                \"^.*$\": {\n                  \"anyOf\": [\n                    {\"type\": \"object\",\n                        \"properties\": {\n                            \"message\": {\n                                \"type\": \"string\"\n                            },\n                            \"channel\": {\n                                \"type\": \"string\"\n                            }\n                        }\n                    }\n                  ]\n                }\n            },\n            \"additionalProperties\": false\n        }\n    }\n}\n","x":107,"y":107,"wires":[["baf867e3.181548"]]},{"id":"e205a621.617e18","type":"subflow:459ae946.b59388","z":"9e3e25e6.0e0308","x":463.5,"y":147,"wires":[["9020744f.79bbf8"]],"subflow":"459ae946.b59388"},{"id":"baf867e3.181548","type":"function","z":"9e3e25e6.0e0308","name":"Set Body","func":"msg.key = Object.keys(msg.payload[msg.resource])[0];\nmsg.payload = msg.payload[msg.resource][msg.key];\nreturn msg;","outputs":1,"noerr":0,"x":106.5,"y":196,"wires":[["a4de2042.85a16"]]},{"id":"d9c84573.f01308","type":"comment","z":"9e3e25e6.0e0308","name":"Valid Resources (POST/DELETE)","info":"# MINUS/PLUS/CHECK Resources\n\n- collaboration_channel\n- collaboration_message\n- pipeline_environment\n- pipeline_pipeline\n- vault_user\n- vault_policy\n- vault_secret\n- service_discovery_service\n- component_metadata (inc. pipelines)\n- monitoring_dashboard\n- source_control_repository\n- source_control_user\n- source_control_token\n- source_control_public_key\n\n- vault_token\n- vault_approle\n- source_control_branch\n- pipeline_agent\n- infrastructure (terraform)\n- cd_flow\n- chatbot_rule\n- monitoring_datasource\n- file_stream\n\n\nchatbots, agile PM, incidents, alerts\n\n\n","x":151,"y":416,"wires":[]},{"id":"c01a6c07.e2379","type":"subflow:811542a8.5ac78","z":"9e3e25e6.0e0308","x":398.5,"y":338,"wires":[["9020744f.79bbf8"]],"subflow":"811542a8.5ac78"},{"id":"c36921e9.a1a59","type":"subflow:cc909323.1bc6b","z":"9e3e25e6.0e0308","x":400.5,"y":377,"wires":[["9020744f.79bbf8"]],"subflow":"cc909323.1bc6b"},{"id":"7c64ea81.28e544","type":"function","z":"9e3e25e6.0e0308","name":"NO OP","func":"msg.statusCode = 200;\nmsg.payload = \"ok\"\n\nreturn msg;","outputs":1,"noerr":0,"x":422.5,"y":415,"wires":[["9020744f.79bbf8"]]},{"id":"a00b6013.c2f58","type":"subflow:d773a612.5b2d98","z":"9e3e25e6.0e0308","name":"","x":393.5,"y":293,"wires":[["9020744f.79bbf8"]],"subflow":"d773a612.5b2d98"},{"id":"9e3e25e6.0e0308","type":"subflow","name":"Routing","info":"","in":[{"x":50,"y":30,"wires":[{"id":"1310b17.58a994f"}]}],"out":[{"x":1002,"y":230,"wires":[{"id":"9020744f.79bbf8","port":0}]}]},{"id":"3d9848a8.843468","type":"http request","z":"811542a8.5ac78","name":"POST","method":"POST","ret":"obj","url":"{{{envs.GRAFANA_URL}}}/api/dashboards/db","tls":"","x":470,"y":320,"wires":[["375f7d6f.7965f2"]]},{"id":"face2f6d.bc923","type":"function","z":"811542a8.5ac78","name":"","func":"if (msg.payload.definition && msg.payload.definition.contents) {\n    msg.payload = {\n        \"dashboard\" : msg.payload.definition.contents,\n        \"overwrite\" : true\n    }\n    \n} else {\n    msg.payload = {\n        \"dashboard\" : msg.payload,\n        \"overwrite\" : true\n    }\n}\nreturn msg;\n","outputs":1,"noerr":0,"x":341,"y":321,"wires":[["3d9848a8.843468"]]},{"id":"d7519b62.f9dbe8","type":"switch","z":"811542a8.5ac78","name":"DASHBOARD","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"plus:monitoring_dashboard","vt":"str"},{"t":"eq","v":"minus:monitoring_dashboard","vt":"str"},{"t":"eq","v":"check:monitoring_dashboard","vt":"str"},{"t":"eq","v":"list:monitoring_dashboard","vt":"str"},{"t":"else"}],"checkall":"false","outputs":5,"x":175.5,"y":349,"wires":[["face2f6d.bc923"],["d3e8a97a.81e188"],["a134a82e.20d198"],["e79ab70f.a51998"],["96fc9ea4.276e5"]]},{"id":"d3e8a97a.81e188","type":"http request","z":"811542a8.5ac78","name":"DELETE","method":"DELETE","ret":"obj","url":"{{{envs.GRAFANA_URL}}}/api/dashboards/db/{{key}}","tls":"","x":476.5,"y":356,"wires":[["375f7d6f.7965f2"]]},{"id":"a134a82e.20d198","type":"http request","z":"811542a8.5ac78","name":"GET","method":"GET","ret":"obj","url":"{{{envs.GRAFANA_URL}}}/api/dashboards/db/{{{key}}}","tls":"","x":468.5,"y":391,"wires":[["375f7d6f.7965f2"]]},{"id":"375f7d6f.7965f2","type":"switch","z":"811542a8.5ac78","name":"","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","outputs":2,"x":623.5,"y":357,"wires":[["dd593ed3.d54e4"],["ce6df830.fc0b48"]]},{"id":"dd593ed3.d54e4","type":"function","z":"811542a8.5ac78","name":"Success","func":"//msg.payload = (msg.payload ? msg.payload.data:\"\");\nreturn msg;","outputs":1,"noerr":0,"x":765.5,"y":329,"wires":[[]]},{"id":"ce6df830.fc0b48","type":"function","z":"811542a8.5ac78","name":"Error","func":"return msg;","outputs":1,"noerr":0,"x":753,"y":363,"wires":[[]]},{"id":"c9e6186b.7a2788","type":"vars","z":"811542a8.5ac78","name":"CONSUL","propertyType":{"context":{"location":{"href":"https://es110c.canzea.cc/gw/admin/#flow/4fc6c84.9271b38","ancestorOrigins":{},"origin":"https://es110c.canzea.cc","protocol":"https:","host":"es110c.canzea.cc","hostname":"es110c.canzea.cc","port":"","pathname":"/gw/admin/","search":"","hash":"#flow/4fc6c84.9271b38"},"jQuery111305858287869232":1},"selector":"#node-input-property"},"rules":[{"t":"service","v":"grafana","vt":"str"}],"checkall":"true","outputs":1,"tls":"c792be07.29d4","url":"https://consul.service.dc1.consul:8080","x":440,"y":220,"wires":[["28a51115.6cffee"]]},{"id":"36c3fb5.aeb7404","type":"function","z":"811542a8.5ac78","name":"Set Header","func":"msg.headers = {\n    'Accept': 'application/json',\n    'Content-Type' : 'application/json',\n    'Authorization': 'Bearer ' + msg.envs.GRAFANA_EDIT_TOKEN\n}\nreturn msg;","outputs":1,"noerr":0,"x":750,"y":60,"wires":[["c9e6186b.7a2788"]]},{"id":"96fc9ea4.276e5","type":"function","z":"811542a8.5ac78","name":"Invalid Topic","func":"msg.payload = {\n    \"error\": \"Unknown topic \" + msg.topic\n};\nmsg.statusCode = 400;\nreturn msg;","outputs":1,"noerr":0,"x":488.5,"y":466,"wires":[[]]},{"id":"e79ab70f.a51998","type":"http request","z":"811542a8.5ac78","name":"LIST","method":"GET","ret":"obj","url":"{{{envs.GRAFANA_URL}}}/api/search","tls":"","x":469.5,"y":429,"wires":[["375f7d6f.7965f2"]]},{"id":"e4171429.5229d8","type":"http request","z":"811542a8.5ac78","name":"POST","method":"POST","ret":"obj","url":"{{{envs.GRAFANA_URL}}}/api/auth/keys","tls":"","x":482.5,"y":545,"wires":[["375f7d6f.7965f2"]]},{"id":"fb560ba0.962c68","type":"function","z":"811542a8.5ac78","name":"","func":"msg.payload['Name'] = msg.key;\nreturn msg;\n","outputs":1,"noerr":0,"x":302.5,"y":545,"wires":[["e4171429.5229d8"]]},{"id":"2f2d391b.37c226","type":"switch","z":"811542a8.5ac78","name":"Auth Choice","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"plus:grafana_auth_key","vt":"str"},{"t":"else"}],"checkall":"false","outputs":2,"x":230,"y":80,"wires":[["e66526db.49ea28"],["138e59.c6ee91a7"]]},{"id":"81b474e.4d86d88","type":"function","z":"811542a8.5ac78","name":"CREDS","func":"username = msg.envs['SERVICE_GRAFANA_ADMIN_CREDENTIALS_USER_NAME'];\npassword = msg.envs['SERVICE_GRAFANA_ADMIN_CREDENTIALS_PASSWORD'];\n\nup = new Buffer(username + \":\" + password).toString('base64');\n\nmsg.headers = {\n    'Authorization': 'Basic ' + up\n}\nreturn msg;","outputs":1,"noerr":0,"x":576.5,"y":17,"wires":[["c9e6186b.7a2788","2c4b779b.45a678"]]},{"id":"b5640c37.19e05","type":"vars","z":"811542a8.5ac78","name":"","propertyType":{"context":{"location":{"href":"https://es5ab5.canzea.cc/gw/admin/#flow/811542a8.5ac78","ancestorOrigins":{},"origin":"https://es5ab5.canzea.cc","protocol":"https:","host":"es5ab5.canzea.cc","hostname":"es5ab5.canzea.cc","port":"","pathname":"/gw/admin/","search":"","hash":"#flow/811542a8.5ac78"},"jQuery1113034684408510297815":1},"selector":"#node-input-property"},"rules":[{"t":"secret","v":"service/grafana/admin/credentials","vt":"str"}],"checkall":"true","outputs":1,"tls":"94073df5.ac54f","url":"https://vault.service.dc1.consul:8200","x":429,"y":18,"wires":[["81b474e.4d86d88"]]},{"id":"138e59.c6ee91a7","type":"vars","z":"811542a8.5ac78","name":"","propertyType":{"context":{"location":{"href":"https://es5ab5.canzea.cc/gw/admin/#flow/811542a8.5ac78","ancestorOrigins":{},"origin":"https://es5ab5.canzea.cc","protocol":"https:","host":"es5ab5.canzea.cc","hostname":"es5ab5.canzea.cc","port":"","pathname":"/gw/admin/","search":"","hash":"#flow/811542a8.5ac78"},"jQuery1113034684408510297815":1},"selector":"#node-input-property"},"rules":[{"t":"secret","v":"grafana/edit","vt":"str"}],"checkall":"true","outputs":1,"tls":"94073df5.ac54f","url":"https://vault.service.dc1.consul:8200","x":426.5,"y":57,"wires":[["36c3fb5.aeb7404"]]},{"id":"e66526db.49ea28","type":"function","z":"811542a8.5ac78","name":"","func":"msg.secretKey = \"service/grafana/{{msg.key}}/credentials\";\nreturn msg;","outputs":1,"noerr":0,"x":292,"y":16,"wires":[["b5640c37.19e05"]]},{"id":"2c4b779b.45a678","type":"debug","z":"811542a8.5ac78","name":"","active":true,"console":"false","complete":"true","x":731.5,"y":20,"wires":[]},{"id":"f981e00c.61b88","type":"switch","z":"811542a8.5ac78","name":"DATA SOURCE","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"plus:monitoring_datasource","vt":"str"},{"t":"eq","v":"minus:monitoring_datasource","vt":"str"},{"t":"eq","v":"check:monitoring_datasource","vt":"str"},{"t":"eq","v":"list:monitoring_datasource","vt":"str"},{"t":"else"}],"checkall":"false","outputs":5,"x":180,"y":640,"wires":[["e951355e.a41d88"],["d6cbde6f.17779"],["5ff82b19.5d32b4"],["a08e0aa.649dcf8"],["c3c96893.02b9e8"]]},{"id":"e951355e.a41d88","type":"http request","z":"811542a8.5ac78","name":"POST","method":"POST","ret":"obj","url":"{{{envs.GRAFANA_URL}}}/api/datasources","tls":"","x":490,"y":620,"wires":[["41bc5d3c.03c314"]]},{"id":"d6cbde6f.17779","type":"http request","z":"811542a8.5ac78","name":"DELETE","method":"DELETE","ret":"obj","url":"{{{envs.GRAFANA_URL}}}/api/datasources/{{key}}","tls":"","x":496.5,"y":656,"wires":[["41bc5d3c.03c314"]]},{"id":"5ff82b19.5d32b4","type":"http request","z":"811542a8.5ac78","name":"GET","method":"GET","ret":"obj","url":"{{{envs.GRAFANA_URL}}}/api/datasources/{{{key}}}","tls":"","x":488.5,"y":691,"wires":[["41bc5d3c.03c314"]]},{"id":"c3c96893.02b9e8","type":"function","z":"811542a8.5ac78","name":"Invalid Topic","func":"msg.payload = {\n    \"error\": \"Unknown topic \" + msg.topic\n};\nmsg.statusCode = 400;\nreturn msg;","outputs":1,"noerr":0,"x":508.5,"y":766,"wires":[[]]},{"id":"a08e0aa.649dcf8","type":"http request","z":"811542a8.5ac78","name":"LIST","method":"GET","ret":"obj","url":"{{{envs.GRAFANA_URL}}}/api/datasources","tls":"","x":489.5,"y":729,"wires":[["41bc5d3c.03c314"]]},{"id":"28a51115.6cffee","type":"switch","z":"811542a8.5ac78","name":"Resource Type","property":"topic","propertyType":"msg","rules":[{"t":"cont","v":"monitoring_dashboard","vt":"str"},{"t":"cont","v":"monitoring_datasource","vt":"str"},{"t":"eq","v":"plus:grafana_auth_key","vt":"str"},{"t":"else"}],"checkall":"false","outputs":4,"x":173,"y":219,"wires":[["d7519b62.f9dbe8"],["f981e00c.61b88"],["fb560ba0.962c68"],["74630651.5545c8"]]},{"id":"74630651.5545c8","type":"function","z":"811542a8.5ac78","name":"Invalid Topic","func":"msg.payload = {\n    \"error\": \"Unknown topic \" + msg.topic\n};\nmsg.statusCode = 400;\nreturn msg;","outputs":1,"noerr":0,"x":450,"y":260,"wires":[[]]},{"id":"41bc5d3c.03c314","type":"switch","z":"811542a8.5ac78","name":"","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","outputs":2,"x":650,"y":660,"wires":[["6c3c8c6.844c274"],["fd82916f.5c0e"]]},{"id":"6c3c8c6.844c274","type":"function","z":"811542a8.5ac78","name":"Success","func":"//msg.payload = (msg.payload ? msg.payload.data:\"\");\nreturn msg;","outputs":1,"noerr":0,"x":792,"y":632,"wires":[[]]},{"id":"fd82916f.5c0e","type":"function","z":"811542a8.5ac78","name":"Error","func":"return msg;","outputs":1,"noerr":0,"x":779.5,"y":666,"wires":[[]]},{"id":"811542a8.5ac78","type":"subflow","name":"Grafana","info":"","in":[{"x":60,"y":60,"wires":[{"id":"2f2d391b.37c226"}]}],"out":[{"x":960,"y":360,"wires":[{"id":"dd593ed3.d54e4","port":0},{"id":"ce6df830.fc0b48","port":0},{"id":"96fc9ea4.276e5","port":0},{"id":"74630651.5545c8","port":0},{"id":"6c3c8c6.844c274","port":0},{"id":"fd82916f.5c0e","port":0},{"id":"c3c96893.02b9e8","port":0}]}]},{"id":"7ad0842f.de8a4c","type":"function","z":"d8491633.ad8e18","name":"Set Token","func":"if (msg.req.headers.hasOwnProperty(\"x-vault-token\") === false) {\n        throw new Error(\"Vault Token Missing\");\n}\n\nmsg.headers = {\n    \"X-Vault-Token\":msg.req.headers['x-vault-token']\n};\nreturn msg;\n","outputs":1,"noerr":0,"x":200,"y":191,"wires":[["56c8fd71.86e484"]]},{"id":"56c8fd71.86e484","type":"http request","z":"d8491633.ad8e18","name":"Get Secret","method":"GET","ret":"obj","url":"https://vault.service.dc1.consul:8200/v1/secret/{{{payload}}}","tls":"94073df5.ac54f","x":381,"y":192,"wires":[["3f1e28c4.56c508"]]},{"id":"f9a7b523.867e18","type":"function","z":"d8491633.ad8e18","name":"Success","func":"msg.payload = (msg.payload ? msg.payload.data:\"\");\nreturn msg;","outputs":1,"noerr":0,"x":723.5,"y":184,"wires":[[]]},{"id":"3f1e28c4.56c508","type":"switch","z":"d8491633.ad8e18","name":"","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","outputs":2,"x":583,"y":191,"wires":[["f9a7b523.867e18"],["dd5d56cb.a62df8"]]},{"id":"dd5d56cb.a62df8","type":"function","z":"d8491633.ad8e18","name":"Error","func":"throw new Error(\"Secret not found\")","outputs":1,"noerr":0,"x":714,"y":222,"wires":[[]]},{"id":"c8ef3dae.04646","type":"debug","z":"d8491633.ad8e18","name":"","active":true,"console":"false","complete":"true","x":173.5,"y":50,"wires":[]},{"id":"d8491633.ad8e18","type":"subflow","name":"Vault READ","info":"","in":[{"x":50,"y":30,"wires":[{"id":"7ad0842f.de8a4c"},{"id":"c8ef3dae.04646"}]}],"out":[{"x":910,"y":200,"wires":[{"id":"f9a7b523.867e18","port":0},{"id":"dd5d56cb.a62df8","port":0}]}]},{"id":"680bc877.c49c08","type":"http request","z":"cc909323.1bc6b","name":"POST","method":"POST","ret":"obj","url":"http://gitea.service.dc1.consul:11080/api/v1/user/repos","tls":"","x":689,"y":247,"wires":[["5a8b7fc4.342d5"]]},{"id":"13d0e456.ce5b4c","type":"function","z":"cc909323.1bc6b","name":"","func":"msg.payload['name'] = msg.key;\nreturn msg;\n","outputs":1,"noerr":0,"x":437,"y":248,"wires":[["680bc877.c49c08"]]},{"id":"cbce0248.c4efb","type":"switch","z":"cc909323.1bc6b","name":"","property":"topic","propertyType":"msg","rules":[{"t":"cont","v":"source_control_repository","vt":"str"},{"t":"cont","v":"source_control_user","vt":"str"},{"t":"cont","v":"source_control_token","vt":"str"},{"t":"eq","v":"plus:source_control_public_key","vt":"str"},{"t":"else"}],"checkall":"true","outputs":5,"x":93,"y":300,"wires":[["f5681294.672e6"],["2e878982.65ae26"],["9038ddeb.6cd72"],["9c6a0471.7859d8"],["1a339ad.58b0965"]]},{"id":"5a8b7fc4.342d5","type":"function","z":"cc909323.1bc6b","name":"","func":"msg.payload = {\n    \"result\" : msg.payload,\n    \"statusCode\" : msg.statusCode\n}\nreturn msg;","outputs":1,"noerr":0,"x":885,"y":257,"wires":[[]]},{"id":"4364655e.d9be7c","type":"http request","z":"cc909323.1bc6b","name":"DELETE","method":"DELETE","ret":"obj","url":"http://174.138.36.126:10080/api/v1/repos/{{key}}","tls":"","x":716.5,"y":303,"wires":[["87961250.08fe3"]]},{"id":"87961250.08fe3","type":"function","z":"cc909323.1bc6b","name":"","func":"msg.payload = {\n    \"result\" : msg.payload,\n    \"statusCode\" : msg.statusCode\n}\nreturn msg;","outputs":1,"noerr":0,"x":887.5,"y":308,"wires":[[]]},{"id":"f3964dd2.6662d","type":"http request","z":"cc909323.1bc6b","name":"GET","method":"GET","ret":"obj","url":"https://ese00c.canzea.cc/grafana/api/dashboards/db/{{{key}}}","tls":"","x":437.5,"y":354,"wires":[["77b3b86f.dd3568"]]},{"id":"77b3b86f.dd3568","type":"function","z":"cc909323.1bc6b","name":"","func":"msg.payload = {\n    \"result\" : msg.payload,\n    \"statusCode\" : msg.statusCode\n}\nreturn msg;","outputs":1,"noerr":0,"x":884.5,"y":365,"wires":[[]]},{"id":"1a339ad.58b0965","type":"function","z":"cc909323.1bc6b","name":"Invalid Topic","func":"throw new Error (\"Invalid topic \" + msg.topic);","outputs":1,"noerr":0,"x":100,"y":417,"wires":[[]]},{"id":"4bd7ba7c.cf3804","type":"http request","z":"cc909323.1bc6b","name":"SEARCH","method":"GET","ret":"obj","url":"http://174.138.36.126:10080/api/v1/user/repos","tls":"","x":443,"y":304,"wires":[["a3f6667e.8e9ba8"]]},{"id":"a3f6667e.8e9ba8","type":"function","z":"cc909323.1bc6b","name":"Find","func":"let found = false;\nfor (let k in msg.payload) {\n    let item = msg.payload[k];\n    if (item['name'] == msg.key) {\n        msg.key = \"\" + item['owner']['username'] + \"/\" + item['name'];\n        found = true;\n    }\n}\nif (found === false) {\n    throw new Error (\"Repository not found\");\n}\nmsg.headers = {\n    'Authorization': 'token ' + msg.token\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":570.5,"y":304,"wires":[["4364655e.d9be7c"]]},{"id":"8ae28ffd.5569d","type":"http request","z":"cc909323.1bc6b","name":"POST","method":"POST","ret":"obj","url":"http://gitea.service.dc1.consul:11080/api/v1/admin/users","tls":"","x":570,"y":480,"wires":[["6884a7da.3c0078"]]},{"id":"743b1caa.a66594","type":"function","z":"cc909323.1bc6b","name":"","func":"msg.payload['username'] = msg.key;\nmsg._username = msg.key;\nmsg._repositories = msg.payload['repositories'];\nreturn msg;\n","outputs":1,"noerr":0,"x":430,"y":480,"wires":[["8ae28ffd.5569d"]]},{"id":"4f330caf.58aa84","type":"function","z":"cc909323.1bc6b","name":"","func":"return msg;","outputs":1,"noerr":0,"x":590,"y":420,"wires":[["771fb2af.5b8c1c"]]},{"id":"e82f3ff1.2c1f6","type":"http request","z":"cc909323.1bc6b","name":"DELETE","method":"DELETE","ret":"txt","url":"http://174.138.36.126:10080/api/v1/admin/users/{{key}}","tls":"","x":440.5,"y":546,"wires":[["cbe8b62b.0a7208"]]},{"id":"cbe8b62b.0a7208","type":"function","z":"cc909323.1bc6b","name":"","func":"\nreturn msg;","outputs":1,"noerr":0,"x":888.5,"y":554,"wires":[[]]},{"id":"fc0169fd.272f78","type":"http request","z":"cc909323.1bc6b","name":"GET","method":"GET","ret":"obj","url":"http://174.138.36.126:10080/api/v1/users/{{key}}","tls":"","x":438.5,"y":600,"wires":[["887366b7.e5cf68"]]},{"id":"887366b7.e5cf68","type":"function","z":"cc909323.1bc6b","name":"","func":"\nreturn msg;","outputs":1,"noerr":0,"x":885.5,"y":611,"wires":[[]]},{"id":"771fb2af.5b8c1c","type":"function","z":"cc909323.1bc6b","name":"Collaborators","func":"//k = Object.keys(msg.payload.repositories)[0];\nkeys = msg.key.split('/')\nmsg._repo = keys[0] + '/' + keys[1];\n\nmsg._username = msg.payload.user;\n\nmsg.payload = {\n    \"permission\" : msg.payload.permission\n}\nreturn msg;\n","outputs":1,"noerr":0,"x":740,"y":420,"wires":[["9aee5381.900f2","9ad18e7a.97dc6"]]},{"id":"9aee5381.900f2","type":"http request","z":"cc909323.1bc6b","name":"PUT","method":"PUT","ret":"txt","url":"http://gitea.service.dc1.consul:11080/api/v1/repos/{{{_repo}}}/collaborators/{{_username}}","tls":"","x":890,"y":420,"wires":[["8eb5fdba.2899"]]},{"id":"ba97acf6.37fec","type":"http request","z":"cc909323.1bc6b","name":"POST","method":"POST","ret":"obj","url":"http://gitea.service.dc1.consul:11080/api/v1/users/{{key}}/tokens","tls":"","x":671,"y":773,"wires":[["6b662908.3e7198","278fa611.ab690a"]]},{"id":"a5530f90.066cf","type":"function","z":"cc909323.1bc6b","name":"","func":"return msg;\n","outputs":1,"noerr":0,"x":419,"y":774,"wires":[["ba97acf6.37fec"]]},{"id":"6b662908.3e7198","type":"function","z":"cc909323.1bc6b","name":"","func":"return msg;","outputs":1,"noerr":0,"x":799,"y":773,"wires":[[]]},{"id":"fe8ae5a2.67ecb8","type":"switch","z":"cc909323.1bc6b","name":"Auth Choice","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"plus:source_control_token","vt":"str"},{"t":"eq","v":"minus:source_control_token","vt":"str"},{"t":"eq","v":"plus:source_control_public_key","vt":"str"},{"t":"eq","v":"plus:source_control_user_repo","vt":"str"},{"t":"else"}],"checkall":"false","outputs":5,"x":213.5,"y":83,"wires":[["b383085f.9c9e08"],["b383085f.9c9e08"],["b383085f.9c9e08"],["b383085f.9c9e08"],["54b908b1.b6d058"]]},{"id":"8a3da7a5.267118","type":"function","z":"cc909323.1bc6b","name":"CREDS","func":"username = msg.envs[msg.envKey + '_USER_NAME'];\npassword = msg.envs[msg.envKey + '_PASSWORD'];\n\nup = new Buffer(username + \":\" + password).toString('base64');\n\nmsg.headers = {\n    'Authorization': 'Basic ' + up,\n    'Clear': username + \":\" + password\n}\nreturn msg;\n","outputs":1,"noerr":0,"x":675,"y":68,"wires":[["20829a0d.dac8b6"]]},{"id":"7e675900.3a6dd8","type":"http request","z":"cc909323.1bc6b","name":"DELETE","method":"DELETE","ret":"txt","url":"http://174.138.36.126:10080/api/v1/users/{{key}}/tokens/{{_token}}","tls":"","x":555,"y":867,"wires":[[]]},{"id":"222514fc.6e944c","type":"function","z":"cc909323.1bc6b","name":"","func":"msg._token = 'access';\nreturn msg;","outputs":1,"noerr":0,"x":390,"y":840,"wires":[["7e675900.3a6dd8"]]},{"id":"38bf5521.4a135a","type":"http request","z":"cc909323.1bc6b","name":"POST","method":"POST","ret":"obj","url":"http://gitea.service.dc1.consul:11080/api/v1/user/keys","tls":"","x":456,"y":926,"wires":[[]]},{"id":"9c6a0471.7859d8","type":"function","z":"cc909323.1bc6b","name":"","func":"node.warn(JSON.stringify(msg.payload,null,3));\nreturn msg;","outputs":1,"noerr":0,"x":314,"y":927,"wires":[["38bf5521.4a135a"]]},{"id":"f238ced3.21639","type":"vars","z":"cc909323.1bc6b","name":"","propertyType":{"context":{"location":{"href":"https://esdade.canzea.cc/gwadmin/#flow/cc909323.1bc6b","ancestorOrigins":{},"origin":"https://esdade.canzea.cc","protocol":"https:","host":"esdade.canzea.cc","hostname":"esdade.canzea.cc","port":"","pathname":"/gwadmin/","search":"","hash":"#flow/cc909323.1bc6b"},"jQuery11130622822423511479":1},"selector":"#node-input-property"},"rules":[{"t":"secret","v":"secretKey","vt":"msg"}],"checkall":"true","outputs":1,"tls":"94073df5.ac54f","url":"https://vault.service.dc1.consul:8200","x":527.5,"y":69,"wires":[["8a3da7a5.267118"]]},{"id":"54b908b1.b6d058","type":"vars","z":"cc909323.1bc6b","name":"","propertyType":{"context":{"location":{"href":"https://esdade.canzea.cc/gwadmin/#flow/cc909323.1bc6b","ancestorOrigins":{},"origin":"https://esdade.canzea.cc","protocol":"https:","host":"esdade.canzea.cc","hostname":"esdade.canzea.cc","port":"","pathname":"/gwadmin/","search":"","hash":"#flow/cc909323.1bc6b"},"jQuery11130622822423511479":1},"selector":"#node-input-property"},"rules":[{"t":"secret","v":"gitea/root","vt":"str"}],"checkall":"true","outputs":1,"tls":"94073df5.ac54f","url":"https://vault.service.dc1.consul:8200","x":525,"y":108,"wires":[["bb70e123.8e1c9"]]},{"id":"278fa611.ab690a","type":"debug","z":"cc909323.1bc6b","name":"","active":true,"console":"false","complete":"true","x":823.5,"y":834,"wires":[]},{"id":"bb70e123.8e1c9","type":"function","z":"cc909323.1bc6b","name":"CREDS","func":"token = msg.envs['GITEA_ROOT_TOKEN'];\nmsg.headers = {\n    'Authorization': 'token ' + token\n}\nreturn msg;","outputs":1,"noerr":0,"x":675,"y":108,"wires":[["20829a0d.dac8b6"]]},{"id":"3b3da074.3223b","type":"catch","z":"cc909323.1bc6b","name":"","scope":null,"x":929.5,"y":186,"wires":[[]]},{"id":"b383085f.9c9e08","type":"function","z":"cc909323.1bc6b","name":"","func":"// key is [user]/[refid]\nuser = msg.key.split('/')[0]\nmsg.secretKey = \"service/gitea/\" + user + \"/credentials\";\nmsg.envKey = (\"SERVICE_GITEA_\" + user + \"_CREDENTIALS\").toUpperCase();\nreturn msg;","outputs":1,"noerr":0,"x":383.5,"y":69,"wires":[["f238ced3.21639"]]},{"id":"6884a7da.3c0078","type":"switch","z":"cc909323.1bc6b","name":"","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"201","vt":"str"},{"t":"eq","v":"422","vt":"str"},{"t":"else"}],"checkall":"false","outputs":3,"x":710,"y":480,"wires":[[],[],[]]},{"id":"74b27ea5.d529b","type":"debug","z":"cc909323.1bc6b","name":"","active":true,"console":"false","complete":"true","x":1090,"y":460,"wires":[]},{"id":"8eb5fdba.2899","type":"switch","z":"cc909323.1bc6b","name":"","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"201","vt":"str"},{"t":"else"}],"checkall":"false","outputs":2,"x":1150,"y":160,"wires":[["f23dea12.a98128"],[]]},{"id":"f23dea12.a98128","type":"json","z":"cc909323.1bc6b","name":"","pretty":false,"x":1284,"y":154,"wires":[[]]},{"id":"f5681294.672e6","type":"switch","z":"cc909323.1bc6b","name":"","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"plus:source_control_repository","vt":"str"},{"t":"eq","v":"minus:source_control_repository","vt":"str"},{"t":"eq","v":"check:source_control_repository","vt":"str"}],"checkall":"true","outputs":3,"x":270,"y":300,"wires":[["13d0e456.ce5b4c"],["4bd7ba7c.cf3804"],["f3964dd2.6662d"]]},{"id":"2e878982.65ae26","type":"switch","z":"cc909323.1bc6b","name":"","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"plus:source_control_user_repo","vt":"str"},{"t":"eq","v":"plus:source_control_user","vt":"str"},{"t":"eq","v":"minus:source_control_user","vt":"str"},{"t":"eq","v":"check:source_control_user","vt":"str"}],"checkall":"true","outputs":4,"x":270,"y":460,"wires":[["4f330caf.58aa84"],["743b1caa.a66594"],["e82f3ff1.2c1f6"],["fc0169fd.272f78"]]},{"id":"9038ddeb.6cd72","type":"switch","z":"cc909323.1bc6b","name":"","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"plus:source_control_token","vt":"str"},{"t":"eq","v":"minus:source_control_token","vt":"str"}],"checkall":"true","outputs":2,"x":250,"y":720,"wires":[["a5530f90.066cf"],["222514fc.6e944c"]]},{"id":"20829a0d.dac8b6","type":"link out","z":"cc909323.1bc6b","name":"","links":["77fdf44e.b1c02c"],"x":801.5,"y":85,"wires":[["77fdf44e.b1c02c"]]},{"id":"77fdf44e.b1c02c","type":"link in","z":"cc909323.1bc6b","name":"","links":["20829a0d.dac8b6"],"x":28.5,"y":237,"wires":[["cbce0248.c4efb"]]},{"id":"9ad18e7a.97dc6","type":"debug","z":"cc909323.1bc6b","name":"","active":true,"console":"false","complete":"true","x":755.5,"y":377,"wires":[]},{"id":"cc909323.1bc6b","type":"subflow","name":"GOGS","info":"","in":[{"x":58,"y":83,"wires":[{"id":"fe8ae5a2.67ecb8"}]}],"out":[{"x":1327,"y":386,"wires":[{"id":"5a8b7fc4.342d5","port":0},{"id":"87961250.08fe3","port":0},{"id":"77b3b86f.dd3568","port":0},{"id":"cbe8b62b.0a7208","port":0},{"id":"6b662908.3e7198","port":0},{"id":"7e675900.3a6dd8","port":0},{"id":"38bf5521.4a135a","port":0},{"id":"3b3da074.3223b","port":0},{"id":"6884a7da.3c0078","port":"2"},{"id":"8eb5fdba.2899","port":1},{"id":"6884a7da.3c0078","port":0},{"id":"6884a7da.3c0078","port":1},{"id":"f23dea12.a98128","port":0}]}]},{"id":"15591bdf.bd0854","type":"subflow","name":"Kibana","info":"","in":[],"out":[]},{"id":"cf40f271.7485f","type":"http request","z":"357b5975.8ef876","name":"Get","method":"GET","ret":"obj","url":"http://gocd.service.dc1.consul:8153/go/api/admin/{{{type}}}/{{{key}}}","tls":"","x":410,"y":280,"wires":[[]]},{"id":"128e2c17.56c554","type":"switch","z":"357b5975.8ef876","name":"","property":"topic","propertyType":"msg","rules":[{"t":"cont","v":"pipeline_pipeline","vt":"str"}],"checkall":"true","outputs":1,"x":130,"y":40,"wires":[["91688f10.fa48b"]]},{"id":"d140838f.0eac3","type":"switch","z":"357b5975.8ef876","name":"Pipeline","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"plus:pipeline_pipeline","vt":"str"},{"t":"eq","v":"minus:pipeline_pipeline","vt":"str"},{"t":"eq","v":"check:pipeline_pipeline","vt":"str"},{"t":"else"}],"checkall":"true","outputs":4,"x":240,"y":120,"wires":[["b0c3cf50.a5ee3"],["a6043eb1.ca64f"],["cf40f271.7485f"],[]]},{"id":"a6043eb1.ca64f","type":"http request","z":"357b5975.8ef876","name":"Delete","method":"DELETE","ret":"obj","url":"http://gocd.service.dc1.consul:8153/go/api/admin/{{{type}}}/{{{key}}}","tls":"","x":410,"y":240,"wires":[[]]},{"id":"91688f10.fa48b","type":"function","z":"357b5975.8ef876","name":"Headers","func":"msg.type = 'pipelines';\nmsg.headers = {\n    'Accept' : 'application/vnd.go.cd.v4+json',\n    'Content-Type' : 'application/json'\n}\nreturn msg;","outputs":1,"noerr":0,"x":100,"y":120,"wires":[["d140838f.0eac3"]]},{"id":"6f98edd3.ebeb24","type":"http request","z":"357b5975.8ef876","name":"Get","method":"GET","ret":"txt","url":"http://gocd.service.dc1.consul:8153/go/api/admin/{{{type}}}/{{{key}}}","tls":"","x":410,"y":120,"wires":[["39e95198.7cd00e"]]},{"id":"39e95198.7cd00e","type":"switch","z":"357b5975.8ef876","name":"","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"true","outputs":2,"x":410,"y":160,"wires":[["2c12d8ee.496ad8"],["a3267f64.9a68e"]]},{"id":"37ae140.50de6ec","type":"http request","z":"357b5975.8ef876","name":"Post","method":"POST","ret":"txt","url":"http://gocd.service.dc1.consul:8153/go/api/admin/{{{type}}}","tls":"","x":670,"y":200,"wires":[[]]},{"id":"7be7d4a2.d613bc","type":"http request","z":"357b5975.8ef876","name":"Put","method":"PUT","ret":"txt","url":"http://gocd.service.dc1.consul:8153/go/api/admin/{{{type}}}/{{{key}}}","tls":"","x":670,"y":160,"wires":[[]]},{"id":"2c12d8ee.496ad8","type":"function","z":"357b5975.8ef876","name":"200","func":"msg.payload = msg.temp;\nmsg.headers = {\n    'Accept' : 'application/vnd.go.cd.v4+json',\n    'Content-Type' : 'application/json',\n    'If-Match' : msg.headers['etag']\n}\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":160,"wires":[["7be7d4a2.d613bc"]]},{"id":"b0c3cf50.a5ee3","type":"function","z":"357b5975.8ef876","name":"","func":"msg.temp = msg.payload\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":80,"wires":[["6f98edd3.ebeb24"]]},{"id":"a3267f64.9a68e","type":"function","z":"357b5975.8ef876","name":"new","func":"msg.payload = msg.temp;\nmsg.type = 'pipelines';\nmsg.headers = {\n    'Accept' : 'application/vnd.go.cd.v4+json',\n    'Content-Type' : 'application/json'\n}\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":200,"wires":[["37ae140.50de6ec"]]},{"id":"357b5975.8ef876","type":"subflow","name":"Go.CD","info":"","in":[{"x":40,"y":40,"wires":[{"id":"128e2c17.56c554"}]}],"out":[{"x":800,"y":240,"wires":[{"id":"cf40f271.7485f","port":0},{"id":"a6043eb1.ca64f","port":0},{"id":"37ae140.50de6ec","port":0},{"id":"7be7d4a2.d613bc","port":0}]}]},{"id":"f09befd2.ba5fa","type":"function","z":"109c70f5.f87c1f","name":"Set Headers","func":"\ncreds = Buffer.from('sp_gocd_admin' + \":\" + msg.envs.SERVICE_GOCD_SP_GOCD_ADMIN_CREDENTIALS_PASSWORD).toString('base64');\n\nmsg.headers = {\n  'Accept' : \"application/vnd.go.cd.v6+json\",\n  'Content-Type' : 'application/json',\n  'Authorization' : \"Basic \" + creds\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":530,"y":40,"wires":[["30ecd882.5b9d28"]]},{"id":"c6260b5f.7a4118","type":"vars","z":"109c70f5.f87c1f","name":"CONSUL","propertyType":{"context":{"location":{"href":"https://esdade.canzea.cc/gwadmin/#flow/109c70f5.f87c1f","ancestorOrigins":{},"origin":"https://esdade.canzea.cc","protocol":"https:","host":"esdade.canzea.cc","hostname":"esdade.canzea.cc","port":"","pathname":"/gwadmin/","search":"","hash":"#flow/109c70f5.f87c1f"},"jQuery111309588051960709292":1},"selector":"#node-input-property"},"rules":[{"t":"service","v":"gocd","vt":"str"}],"checkall":"true","outputs":1,"tls":"c792be07.29d4","url":"https://consul.service.dc1.consul:8080","x":230,"y":31,"wires":[["407e4c12.066984"]]},{"id":"3ca185d8.142a5a","type":"http request","z":"109c70f5.f87c1f","name":"ADD PIPELINE","method":"POST","ret":"obj","url":"{{{envs.GOCD_URL}}}/go/api/admin/pipelines","tls":"","x":432.5,"y":119,"wires":[[]]},{"id":"92b986e1.794cd8","type":"switch","z":"109c70f5.f87c1f","name":"Pipelines","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"plus:pipeline_pipeline","vt":"str"},{"t":"eq","v":"minus:pipeline_pipeline","vt":"str"},{"t":"eq","v":"check:pipeline_pipeline","vt":"str"},{"t":"else"}],"checkall":"false","outputs":4,"x":204.5,"y":137,"wires":[["3ca185d8.142a5a"],["ac569094.a791d"],["358aca25.9f25e6"],["358aca25.9f25e6"]]},{"id":"30ecd882.5b9d28","type":"link out","z":"109c70f5.f87c1f","name":"","links":["50fd1185.40a1e"],"x":675,"y":40,"wires":[["50fd1185.40a1e"]]},{"id":"50fd1185.40a1e","type":"link in","z":"109c70f5.f87c1f","name":"","links":["30ecd882.5b9d28"],"x":94.5,"y":136,"wires":[["92b986e1.794cd8"]]},{"id":"358aca25.9f25e6","type":"function","z":"109c70f5.f87c1f","name":"ERROR","func":"msg.payload = {\n    statusCode: 400,\n    message: \"Invalid topic \" + msg.topic\n}\nreturn msg;","outputs":1,"noerr":0,"x":431.5,"y":238,"wires":[[]]},{"id":"ac569094.a791d","type":"http request","z":"109c70f5.f87c1f","name":"DEL PIPELINE","method":"DELETE","ret":"txt","url":"{{{envs.GOCD_URL}}}/go/api/admin/pipelines/{{{key}}}","tls":"","x":433,"y":161,"wires":[[]]},{"id":"407e4c12.066984","type":"vars","z":"109c70f5.f87c1f","name":"VAULT","propertyType":{"context":{"location":{"href":"https://8281205.xyz/gwadmin/#flow/d773a612.5b2d98","ancestorOrigins":{},"origin":"https://8281205.xyz","protocol":"https:","host":"8281205.xyz","hostname":"8281205.xyz","port":"","pathname":"/gwadmin/","search":"","hash":"#flow/d773a612.5b2d98"},"jQuery1113097090410759886":1},"selector":"#node-input-property"},"rules":[{"t":"secret","v":"service/gocd/sp_gocd_admin/credentials","vt":"str"}],"checkall":"true","outputs":1,"tls":"94073df5.ac54f","url":"https://vault.service.dc1.consul:8200","x":370,"y":40,"wires":[["f09befd2.ba5fa"]]},{"id":"109c70f5.f87c1f","type":"subflow","name":"Go.CD Pipelines","info":"","in":[{"x":50,"y":30,"wires":[{"id":"c6260b5f.7a4118"}]}],"out":[{"x":692,"y":160,"wires":[{"id":"3ca185d8.142a5a","port":0},{"id":"358aca25.9f25e6","port":0},{"id":"ac569094.a791d","port":0}]}]},{"id":"b9fc27e.941b2d8","type":"http request","z":"d773a612.5b2d98","name":"Get Secret","method":"GET","ret":"obj","url":"https://vault.service.dc1.consul:8200/v1/secret/{{{key}}}","tls":"1e6bec6e.0a5634","x":527.111083984375,"y":288.3333282470703,"wires":[["cf58a755.ff2ab8"]]},{"id":"e0c6bbd.97afd48","type":"switch","z":"d773a612.5b2d98","name":"","property":"topic","propertyType":"msg","rules":[{"t":"cont","v":"secret","vt":"str"},{"t":"cont","v":"polic","vt":"str"},{"t":"cont","v":"user","vt":"str"},{"t":"cont","v":"approle","vt":"str"},{"t":"else"}],"checkall":"false","outputs":5,"x":90,"y":240,"wires":[["61084c4.4cf48b4"],["f2db90d6.621a2"],["98eae683.cd6398"],["1ace3344.6ecfdd"],["cf7a1e5b.d834a"]]},{"id":"155d5d9e.59c672","type":"function","z":"d773a612.5b2d98","name":"Success","func":"//msg.payload = (msg.payload ? msg.payload.data:\"\");\nreturn msg;","outputs":1,"noerr":0,"x":825.611083984375,"y":306.3333282470703,"wires":[[]]},{"id":"b893bc22.373bf","type":"catch","z":"d773a612.5b2d98","name":"","scope":null,"x":705.611083984375,"y":218.33331298828125,"wires":[["f0f8d663.dac918"]]},{"id":"f0f8d663.dac918","type":"function","z":"d773a612.5b2d98","name":"Error","func":"msg.payload = {\n    \"error\": msg.message\n};\nmsg.statusCode = 400;\nreturn msg;","outputs":1,"noerr":0,"x":834.111083984375,"y":218.33331298828125,"wires":[[]]},{"id":"cf58a755.ff2ab8","type":"switch","z":"d773a612.5b2d98","name":"","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","outputs":2,"x":691.111083984375,"y":321.33331298828125,"wires":[["155d5d9e.59c672"],["6cad931f.f7f67c"]]},{"id":"6cad931f.f7f67c","type":"function","z":"d773a612.5b2d98","name":"Error","func":"return msg;","outputs":1,"noerr":0,"x":826.111083984375,"y":355.3333282470703,"wires":[[]]},{"id":"cf7a1e5b.d834a","type":"function","z":"d773a612.5b2d98","name":"Invalid Topic","func":"msg.payload = {\n    \"error\": \"Unknown topic \" + msg.topic\n};\nmsg.statusCode = 400;\nreturn msg;","outputs":1,"noerr":0,"x":818.611083984375,"y":25.33331298828125,"wires":[[]]},{"id":"dff296f5.5384d8","type":"function","z":"d773a612.5b2d98","name":"Set Headers","func":"msg.headers = {\n    \"X-Vault-Token\":msg.envs.SERVICE_VAULT_TOKEN\n};\nreturn msg;\n","outputs":1,"noerr":0,"x":136,"y":77,"wires":[["e0c6bbd.97afd48"]]},{"id":"ffd0e092.8655d","type":"http request","z":"d773a612.5b2d98","name":"Put Secret","method":"PUT","ret":"txt","url":"https://vault.service.dc1.consul:8200/v1/secret/{{{key}}}","tls":"94073df5.ac54f","x":529,"y":320,"wires":[["cf58a755.ff2ab8"]]},{"id":"63cb357e.53e49c","type":"http request","z":"d773a612.5b2d98","name":"Delete Secret","method":"DELETE","ret":"txt","url":"https://vault.service.dc1.consul:8200/v1/secret/{{{key}}}","tls":"1e6bec6e.0a5634","x":537,"y":352,"wires":[["cf58a755.ff2ab8"]]},{"id":"9c3c7e8d.24c94","type":"http request","z":"d773a612.5b2d98","name":"Get Policies","method":"GET","ret":"obj","url":"https://vault.service.dc1.consul:8200/v1/sys/policy","tls":"1e6bec6e.0a5634","x":533,"y":540,"wires":[["2a9a16b2.bc11da"]]},{"id":"28174ad9.4ed356","type":"http request","z":"d773a612.5b2d98","name":"Get Policy","method":"GET","ret":"obj","url":"https://vault.service.dc1.consul:8200/v1/sys/policy/{{{key}}}","tls":"1e6bec6e.0a5634","x":536,"y":661,"wires":[["2a9a16b2.bc11da"]]},{"id":"a18a0063.e2989","type":"http request","z":"d773a612.5b2d98","name":"Put Policy","method":"PUT","ret":"txt","url":"https://vault.service.dc1.consul:8200/v1/sys/policy/{{{key}}}","tls":"1e6bec6e.0a5634","x":527,"y":581,"wires":[["2a9a16b2.bc11da"]]},{"id":"3759fe8c.979772","type":"http request","z":"d773a612.5b2d98","name":"Delete Policy","method":"DELETE","ret":"obj","url":"https://vault.service.dc1.consul:8200/v1/sys/policy/{{{key}}}","tls":"1e6bec6e.0a5634","x":535,"y":619,"wires":[["2a9a16b2.bc11da"]]},{"id":"ead91683.581ea8","type":"http request","z":"d773a612.5b2d98","name":"Get Users","method":"GET","ret":"obj","url":"https://vault.service.dc1.consul:8200/v1/auth/userpass/users?list=true","tls":"1e6bec6e.0a5634","x":513,"y":389,"wires":[["bde85b9a.32a0d8"]]},{"id":"5795713f.fbad2","type":"http request","z":"d773a612.5b2d98","name":"Get AppRoles","method":"GET","ret":"obj","url":"https://vault.service.dc1.consul:8200/v1/auth/approle/role?list=true","tls":"1e6bec6e.0a5634","x":545,"y":698,"wires":[["63e90bf9.60d604"]]},{"id":"27703b6e.13e104","type":"switch","z":"d773a612.5b2d98","name":"","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","outputs":2,"x":770,"y":760,"wires":[["c9cfd7a0.f8e608"],["7d23f768.f6eeb8"]]},{"id":"c9cfd7a0.f8e608","type":"function","z":"d773a612.5b2d98","name":"Success","func":"msg.payload = (msg.payload ? msg.payload.data:\"\");\nreturn msg;","outputs":1,"noerr":0,"x":932,"y":741,"wires":[[]]},{"id":"7d23f768.f6eeb8","type":"function","z":"d773a612.5b2d98","name":"Error","func":"return msg;","outputs":1,"noerr":0,"x":920.5,"y":780,"wires":[[]]},{"id":"98ccb2cd.3e93f","type":"http request","z":"d773a612.5b2d98","name":"Get AppRole","method":"GET","ret":"obj","url":"https://vault.service.dc1.consul:8200/v1/auth/approle/role/{{{key}}}","tls":"1e6bec6e.0a5634","x":536,"y":823,"wires":[["27703b6e.13e104"]]},{"id":"492115cf.17ffdc","type":"http request","z":"d773a612.5b2d98","name":"Put AppRole","method":"POST","ret":"txt","url":"https://vault.service.dc1.consul:8200/v1/auth/approle/role/{{{key}}}","tls":"1e6bec6e.0a5634","x":533,"y":740,"wires":[["27703b6e.13e104"]]},{"id":"79f97f97.5971a","type":"http request","z":"d773a612.5b2d98","name":"Delete AppRole","method":"DELETE","ret":"obj","url":"https://vault.service.dc1.consul:8200/v1/auth/approle/role/{{{key}}}","tls":"1e6bec6e.0a5634","x":545,"y":782,"wires":[["27703b6e.13e104"]]},{"id":"50dda7c9.b6e308","type":"http request","z":"d773a612.5b2d98","name":"POST User","method":"POST","ret":"txt","url":"https://vault.service.dc1.consul:8200/v1/auth/userpass/users/{{key}}","tls":"1e6bec6e.0a5634","x":523,"y":425,"wires":[["bde85b9a.32a0d8","e8845cbc.41176"]]},{"id":"609802f2.4fbc3c","type":"http request","z":"d773a612.5b2d98","name":"DELETE User","method":"DELETE","ret":"txt","url":"https://vault.service.dc1.consul:8200/v1/auth/userpass/users/{{key}}","tls":"1e6bec6e.0a5634","x":535,"y":463,"wires":[["bde85b9a.32a0d8"]]},{"id":"d3564373.7dcca","type":"http request","z":"d773a612.5b2d98","name":"GET User","method":"GET","ret":"obj","url":"https://vault.service.dc1.consul:8200/v1/auth/userpass/users/{{key}}","tls":"1e6bec6e.0a5634","x":522,"y":501,"wires":[["bde85b9a.32a0d8"]]},{"id":"90061bb4.000bc8","type":"vars","z":"d773a612.5b2d98","name":"VAULT","propertyType":{"context":{"location":{"href":"https://8281205.xyz/gwadmin/#flow/d773a612.5b2d98","ancestorOrigins":{},"origin":"https://8281205.xyz","protocol":"https:","host":"8281205.xyz","hostname":"8281205.xyz","port":"","pathname":"/gwadmin/","search":"","hash":"#flow/d773a612.5b2d98"},"jQuery1113097090410759886":1},"selector":"#node-input-property"},"rules":[{"t":"secret","v":"service/vault","vt":"str"}],"checkall":"true","outputs":1,"tls":"94073df5.ac54f","url":"https://vault.service.dc1.consul:8200","x":158.5,"y":31,"wires":[["dff296f5.5384d8"]]},{"id":"1ace3344.6ecfdd","type":"switch","z":"d773a612.5b2d98","name":"APPROLE","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"get-approles","vt":"str"},{"t":"eq","v":"put-approle","vt":"str"},{"t":"eq","v":"delete-approle","vt":"str"},{"t":"eq","v":"get-approle","vt":"str"}],"checkall":"false","outputs":4,"x":331,"y":764,"wires":[["5795713f.fbad2"],["492115cf.17ffdc"],["79f97f97.5971a"],["98ccb2cd.3e93f"]]},{"id":"f2db90d6.621a2","type":"switch","z":"d773a612.5b2d98","name":"POLICY","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"get-policies","vt":"str"},{"t":"eq","v":"plus:vault_policy","vt":"str"},{"t":"eq","v":"minus:vault_policy","vt":"str"},{"t":"eq","v":"get-policy","vt":"str"}],"checkall":"false","outputs":4,"x":337,"y":603,"wires":[["9c3c7e8d.24c94"],["a9e91ff8.e7047","b5687d56.1fbb4"],["3759fe8c.979772"],["28174ad9.4ed356"]]},{"id":"98eae683.cd6398","type":"switch","z":"d773a612.5b2d98","name":"USER","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"get-users","vt":"str"},{"t":"eq","v":"plus:vault_user","vt":"str"},{"t":"eq","v":"minus:vault_user","vt":"str"},{"t":"eq","v":"check:vault_user","vt":"str"}],"checkall":"false","outputs":4,"x":337,"y":470,"wires":[["ead91683.581ea8"],["50dda7c9.b6e308","a9e91ff8.e7047"],["609802f2.4fbc3c"],["d3564373.7dcca"]]},{"id":"61084c4.4cf48b4","type":"switch","z":"d773a612.5b2d98","name":"SECRET","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"get-secrets","vt":"str"},{"t":"eq","v":"check:vault_secret","vt":"str"},{"t":"eq","v":"plus:vault_secret","vt":"str"},{"t":"eq","v":"minus:vault_secret","vt":"str"},{"t":"else"}],"checkall":"false","outputs":5,"x":329,"y":324,"wires":[["fff9ccc4.ffab5"],["b9fc27e.941b2d8"],["ffd0e092.8655d"],["63cb357e.53e49c"],["cf7a1e5b.d834a"]]},{"id":"2a9a16b2.bc11da","type":"switch","z":"d773a612.5b2d98","name":"","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","outputs":2,"x":750,"y":598,"wires":[["9c031d34.be741"],["27b16771.700d28"]]},{"id":"9c031d34.be741","type":"function","z":"d773a612.5b2d98","name":"Success","func":"msg.payload = (msg.payload ? msg.payload.data:\"\");\nreturn msg;","outputs":1,"noerr":0,"x":883,"y":604,"wires":[[]]},{"id":"27b16771.700d28","type":"function","z":"d773a612.5b2d98","name":"Error","func":"return msg;","outputs":1,"noerr":0,"x":871.5,"y":643,"wires":[[]]},{"id":"bde85b9a.32a0d8","type":"switch","z":"d773a612.5b2d98","name":"","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","outputs":2,"x":733,"y":444,"wires":[["9e1e2fe5.e94fc"],["43b210aa.138e4"]]},{"id":"9e1e2fe5.e94fc","type":"function","z":"d773a612.5b2d98","name":"Success","func":"msg.payload = (msg.payload ? msg.payload.data:\"\");\nreturn msg;","outputs":1,"noerr":0,"x":887,"y":417,"wires":[[]]},{"id":"43b210aa.138e4","type":"function","z":"d773a612.5b2d98","name":"Error","func":"return msg;","outputs":1,"noerr":0,"x":875.5,"y":456,"wires":[[]]},{"id":"a9e91ff8.e7047","type":"debug","z":"d773a612.5b2d98","name":"","active":true,"console":"false","complete":"false","x":766.5,"y":546,"wires":[]},{"id":"b5687d56.1fbb4","type":"function","z":"d773a612.5b2d98","name":"","func":"msg.payload = {\n    \"name\": msg.key,\n    \"policy\": JSON.stringify(msg.payload, null, 3)\n}\nreturn msg;","outputs":1,"noerr":0,"x":358.5,"y":541,"wires":[["a18a0063.e2989"]]},{"id":"e8845cbc.41176","type":"debug","z":"d773a612.5b2d98","name":"","active":true,"console":"false","complete":"false","x":787.5,"y":506,"wires":[]},{"id":"c8768521.3ece28","type":"http request","z":"d773a612.5b2d98","name":"Secret Inventory","method":"use","ret":"obj","url":"https://vault.service.dc1.consul:8200/v1/secret/{{{key}}}","tls":"1e6bec6e.0a5634","x":440,"y":220,"wires":[["ae4da850.7f86c8"]]},{"id":"fff9ccc4.ffab5","type":"function","z":"d773a612.5b2d98","name":"","func":"msg.method = \"LIST\"\nreturn msg;","outputs":1,"noerr":0,"x":466.5,"y":184,"wires":[["c8768521.3ece28"]]},{"id":"ae4da850.7f86c8","type":"switch","z":"d773a612.5b2d98","name":"","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"eq","v":"404","vt":"str"},{"t":"else"}],"checkall":"false","outputs":3,"x":690,"y":260,"wires":[["1a280f7e.4a8681"],["8ddf685d.b9b3a8"],["6cad931f.f7f67c"]]},{"id":"1a280f7e.4a8681","type":"function","z":"d773a612.5b2d98","name":"Success","func":"msg.payload = (msg.payload ? msg.payload.data:\"\");\nreturn msg;","outputs":1,"noerr":0,"x":824.5,"y":245.00001525878906,"wires":[[]]},{"id":"8ddf685d.b9b3a8","type":"function","z":"d773a612.5b2d98","name":"Empty","func":"msg.payload = {\n    keys:[]\n}\nmsg.statusCode = 200\nreturn msg;","outputs":1,"noerr":0,"x":830,"y":280,"wires":[[]]},{"id":"f10b0103.b2536","type":"function","z":"d773a612.5b2d98","name":"Empty","func":"msg.payload = {\n    keys:[]\n}\nmsg.statusCode = 200\nreturn msg;","outputs":1,"noerr":0,"x":910,"y":700,"wires":[[]]},{"id":"63e90bf9.60d604","type":"switch","z":"d773a612.5b2d98","name":"","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"eq","v":"404","vt":"str"},{"t":"else"}],"checkall":"false","outputs":3,"x":770,"y":700,"wires":[["c9cfd7a0.f8e608"],["f10b0103.b2536"],["7d23f768.f6eeb8"]]},{"id":"1e6bec6e.0a5634","type":"tls-config","z":"d773a612.5b2d98","name":"","cert":"/etc/vault/ssl/vault.cert","key":"/etc/vault/ssl/vault.key","ca":"/etc/vault/ssl/ca.cert","certname":"","keyname":"","caname":"","verifyservercert":false},{"id":"d773a612.5b2d98","type":"subflow","name":"Vault","info":"# Input\n\nmsg.key = msg.req.query.key;\n\nmsg.topic = 'get-secret';\n\n","in":[{"x":50,"y":30,"wires":[{"id":"90061bb4.000bc8"}]}],"out":[{"x":1000,"y":340,"wires":[{"id":"155d5d9e.59c672","port":0},{"id":"6cad931f.f7f67c","port":0},{"id":"cf7a1e5b.d834a","port":0},{"id":"f0f8d663.dac918","port":0},{"id":"c9cfd7a0.f8e608","port":0},{"id":"7d23f768.f6eeb8","port":0},{"id":"9c031d34.be741","port":0},{"id":"27b16771.700d28","port":0},{"id":"9e1e2fe5.e94fc","port":0},{"id":"43b210aa.138e4","port":0},{"id":"1a280f7e.4a8681","port":0},{"id":"8ddf685d.b9b3a8","port":0},{"id":"f10b0103.b2536","port":0}]}]},{"type":"tab","label":"Pipelines 2","id":"ddea0b03.5c5658"},{"id":"30e6f4a9.12525c","type":"http in","z":"ddea0b03.5c5658","name":"","url":"/pipelines","method":"post","swaggerDoc":"","x":116,"y":238,"wires":[["327747e9.2766e8"]]},{"id":"327747e9.2766e8","type":"json-schema","z":"ddea0b03.5c5658","name":"","func":"{\n    \"$schema\": \"http://json-schema.org/draft-04/schema#\",\n    \"title\": \"Pipeline\",\n    \"type\": \"object\",\n    \"properties\": {\n        \"name\": {\n            \"description\": \"Name of the component\",\n            \"type\": \"string\"\n        },\n        \"url\": {\n            \"description\": \"Material URL\",\n            \"type\": \"string\"\n        },\n        \"branch\": {\n            \"description\": \"Material Branch\",\n            \"type\": \"string\"\n        },\n        \"pipelineName\": {\n            \"description\": \"Name of the pipeline\",\n            \"type\": \"string\"\n        }\n    },\n    \"required\": [\"name\", \"url\", \"branch\", \"pipelineName\"]\n}","x":372,"y":238,"wires":[["2ade4c04.460634"]]},{"id":"cd60d0ce.01276","type":"comment","z":"ddea0b03.5c5658","name":"Pipelines (create/destroy)","info":"As part of the micro-service architecture, the ability to\ncreate and destroy pipelines easily.","x":142.5,"y":44,"wires":[]},{"id":"f58b61ab.588ad","type":"function","z":"ddea0b03.5c5658","name":"Prepare UPD FOR DEPLOY","func":"args = {\n    \"name\":\"hello-world-svc-app\",\n    \"branch\":\"hotfix-1.0.3\", \n    \"version\":\"1.0.3\",\n    \"qualifier\":\"N\",\n    \"port\":\"1235\",\n    \"N\":{\n        \"pattern\":\"Deploy\",\n        \"name\":\"another-svc-app-hotfix-1.0.3-Deploy\"\n    }, \n    \"localUrl\":\"https://IKE_CI:55665566@gitlab.com/ikethecoder/hello-world-svc-app.git\",\n    \"localBranch\":\"master\"\n};\n\nfunction replaceAll(str, find, replace) {\n  return str.replace(new RegExp(find, 'g'), replace);\n}\n\nargsString = replaceAll(JSON.stringify(args),'\"', '\"');\n\nmsg.payload = [\n    \"--lifecycle=wire\",\n    \"--solution=gocd\",\n    \"--action=update-pipeline-for-deploy\",\n    \"--args='\" + argsString + \"'\"].join(' ');\n\nreturn msg;\n\n","outputs":"2","noerr":0,"x":290,"y":158,"wires":[["331ba2b9.3a7f3e"],[]]},{"id":"331ba2b9.3a7f3e","type":"bigexec","z":"ddea0b03.5c5658","name":"","command":"/home/pm2user/canzea.sh","commandArgs":"","minError":1,"minWarning":1,"cwd":"/home/pm2user/.ecosystem-catalog/catalog","shell":"","extraArgumentProperty":"","envProperty":"","format":"utf8","limiter":true,"payloadIs":"argumentNoStdin","x":511,"y":153,"wires":[[],[],[]]},{"id":"d42dae8.4bae45","type":"inject","z":"ddea0b03.5c5658","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":107,"y":114,"wires":[["f58b61ab.588ad"]]},{"id":"1aad2b6e.675395","type":"subflow:a1cb3587.05ca68","z":"ddea0b03.5c5658","name":"","x":746.5,"y":305,"wires":[["74955386.5e890c"],[]],"subflow":"a1cb3587.05ca68"},{"id":"74955386.5e890c","type":"http response","z":"ddea0b03.5c5658","name":"","x":915.5,"y":307,"wires":[]},{"id":"208adeec.40fcc2","type":"catch","z":"ddea0b03.5c5658","name":"","scope":null,"x":659,"y":505,"wires":[["b0d47d29.69c92","29518f8d.69449"]]},{"id":"b0d47d29.69c92","type":"function","z":"ddea0b03.5c5658","name":"Error","func":"msg.payload = {\n    \"error\": msg.message\n};\nmsg.statusCode = 400;\nreturn msg;","outputs":1,"noerr":0,"x":787.5,"y":505,"wires":[["74955386.5e890c"]]},{"id":"2ade4c04.460634","type":"function","z":"ddea0b03.5c5658","name":"prepare-for-build","func":"msg.topic = 'prepare-for-build';\nreturn msg;","outputs":1,"noerr":0,"x":484.5,"y":286,"wires":[["1aad2b6e.675395"]]},{"id":"7c9c3177.0fa2b","type":"function","z":"ddea0b03.5c5658","name":"create-build-pipeline","func":"msg.topic = 'create-build-pipeline';\nreturn msg;","outputs":1,"noerr":0,"x":457,"y":389,"wires":[["1aad2b6e.675395"]]},{"id":"d13325a7.d3c948","type":"http in","z":"ddea0b03.5c5658","name":"","url":"/build-pipelines","method":"post","swaggerDoc":"","x":144,"y":349,"wires":[["7c9c3177.0fa2b"]]},{"id":"7a0ea8c1.915d08","type":"function","z":"ddea0b03.5c5658","name":"unpause","func":"msg.topic = 'unpause';\nreturn msg;","outputs":1,"noerr":0,"x":377,"y":520,"wires":[["1aad2b6e.675395"]]},{"id":"a91b825b.58abc","type":"http in","z":"ddea0b03.5c5658","name":"","url":"/unpause","method":"post","swaggerDoc":"","x":177,"y":521,"wires":[["7a0ea8c1.915d08"]]},{"id":"b30cf16a.08dff","type":"function","z":"ddea0b03.5c5658","name":"schedule","func":"msg.topic = 'schedule';\nreturn msg;","outputs":1,"noerr":0,"x":375,"y":572,"wires":[["1aad2b6e.675395"]]},{"id":"e46d1cb5.ce65d","type":"http in","z":"ddea0b03.5c5658","name":"","url":"/schedule","method":"post","swaggerDoc":"","x":177,"y":570,"wires":[["b30cf16a.08dff"]]},{"id":"5edd2786.a0d5c8","type":"http in","z":"ddea0b03.5c5658","name":"","url":"/prepare-pipelines","method":"post","swaggerDoc":"","x":140,"y":280,"wires":[["23a8fd44.c06ad2"]]},{"id":"23a8fd44.c06ad2","type":"function","z":"ddea0b03.5c5658","name":"prepare-for-deploy","func":"msg.topic = 'prepare-for-deploy';\nreturn msg;","outputs":1,"noerr":0,"x":485,"y":322,"wires":[["1aad2b6e.675395"]]},{"id":"21750101.c21e4e","type":"http in","z":"ddea0b03.5c5658","name":"","url":"/deploy-pipelines","method":"post","swaggerDoc":"","x":142,"y":314,"wires":[["f7bed930.df6238"]]},{"id":"f7bed930.df6238","type":"function","z":"ddea0b03.5c5658","name":"create-deploy-pipeline","func":"msg.topic = 'create-deploy-pipeline';\nreturn msg;","outputs":1,"noerr":0,"x":463,"y":356,"wires":[["1aad2b6e.675395"]]},{"id":"31539abb.18ca16","type":"function","z":"ddea0b03.5c5658","name":"get-environment","func":"msg.topic = 'get-environment';\nreturn msg;","outputs":1,"noerr":0,"x":405,"y":638,"wires":[["1aad2b6e.675395"]]},{"id":"df7ed55.d99e928","type":"http in","z":"ddea0b03.5c5658","name":"","url":"/get-environment","method":"post","swaggerDoc":"","x":186,"y":637,"wires":[["31539abb.18ca16"]]},{"id":"d6c5c2a8.d9634","type":"http in","z":"ddea0b03.5c5658","name":"","url":"/add-to-environment","method":"post","swaggerDoc":"","x":207,"y":702,"wires":[["798f67c2.554e18"]]},{"id":"798f67c2.554e18","type":"function","z":"ddea0b03.5c5658","name":"add-pipeline-to-environment","func":"msg.topic = 'add-pipeline-to-environment';\nreturn msg;","outputs":1,"noerr":0,"x":533,"y":700,"wires":[["1aad2b6e.675395"]]},{"id":"b1c5a3bb.6d41d","type":"http in","z":"ddea0b03.5c5658","name":"","url":"/save-environment","method":"post","swaggerDoc":"","x":188,"y":744,"wires":[["b35d745.5df7a88"]]},{"id":"b35d745.5df7a88","type":"function","z":"ddea0b03.5c5658","name":"save-environment","func":"msg.topic = 'save-environment';\nreturn msg;","outputs":1,"noerr":0,"x":494,"y":742,"wires":[["1aad2b6e.675395"]]},{"id":"29518f8d.69449","type":"debug","z":"ddea0b03.5c5658","name":"","active":true,"console":"false","complete":"true","x":785.5,"y":566,"wires":[]},{"id":"c77e547f.992878","type":"http in","z":"ddea0b03.5c5658","name":"","url":"/enable-agent","method":"post","swaggerDoc":"","x":167,"y":786,"wires":[["2e87ca8c.e36af6"]]},{"id":"2e87ca8c.e36af6","type":"function","z":"ddea0b03.5c5658","name":"enable-agent","func":"msg.topic = 'enable-agent';\nreturn msg;","outputs":1,"noerr":0,"x":473,"y":784,"wires":[["1aad2b6e.675395"]]},{"id":"291042b8.d6622e","type":"http in","z":"ddea0b03.5c5658","name":"","url":"/link-agent-to-environment","method":"post","swaggerDoc":"","x":216.25,"y":832.5,"wires":[["2023797b.752f36"]]},{"id":"2023797b.752f36","type":"function","z":"ddea0b03.5c5658","name":"link-agent-to-environment","func":"msg.topic = 'link-agent-to-environment';\nreturn msg;","outputs":1,"noerr":0,"x":522.25,"y":830.5,"wires":[["1aad2b6e.675395"]]},{"id":"35702cf7.f9bff4","type":"http in","z":"ddea0b03.5c5658","name":"","url":"/unlink-agent-from-environment","method":"post","swaggerDoc":"","x":240,"y":876.25,"wires":[["b2f59b65.8257d8"]]},{"id":"b2f59b65.8257d8","type":"function","z":"ddea0b03.5c5658","name":"unlink-agent-from-environment","func":"msg.topic = 'unlink-agent-from-environment';\nreturn msg;","outputs":1,"noerr":0,"x":546,"y":874.25,"wires":[["1aad2b6e.675395"]]},{"id":"278da8aa.19f6b8","type":"http in","z":"ddea0b03.5c5658","name":"","url":"/delete-agent","method":"post","swaggerDoc":"","x":177.5,"y":918.75,"wires":[["fa9f54ed.ee15a8"]]},{"id":"fa9f54ed.ee15a8","type":"function","z":"ddea0b03.5c5658","name":"delete-agent","func":"msg.topic = 'delete-agent';\nreturn msg;","outputs":1,"noerr":0,"x":483.5,"y":916.75,"wires":[["1aad2b6e.675395"]]},{"id":"dec9b1ff.42ed5","type":"http in","z":"ddea0b03.5c5658","name":"","url":"/create-environment","method":"post","swaggerDoc":"","x":191,"y":977,"wires":[["8072af80.2a79"]]},{"id":"8072af80.2a79","type":"function","z":"ddea0b03.5c5658","name":"create-environment","func":"msg.topic = 'create-environment';\nreturn msg;","outputs":1,"noerr":0,"x":497,"y":975,"wires":[["1aad2b6e.675395"]]},{"id":"6401cffd.4e788","type":"http in","z":"ddea0b03.5c5658","name":"","url":"/delete-environment","method":"delete","swaggerDoc":"","x":195,"y":1025,"wires":[["d9e70b61.56c2c8"]]},{"id":"d9e70b61.56c2c8","type":"function","z":"ddea0b03.5c5658","name":"delete-environment","func":"msg.topic = 'delete-environment';\nreturn msg;","outputs":1,"noerr":0,"x":488,"y":1027,"wires":[["1aad2b6e.675395"]]},{"id":"88eaf589.5861f8","type":"http in","z":"ddea0b03.5c5658","name":"","url":"/disable-agent","method":"post","swaggerDoc":"","x":184,"y":810,"wires":[["f36d51b4.2da"]]},{"id":"f36d51b4.2da","type":"function","z":"ddea0b03.5c5658","name":"disable-agent","func":"msg.topic = 'disable-agent';\nreturn msg;","outputs":1,"noerr":0,"x":490,"y":808,"wires":[["1aad2b6e.675395"]]},{"id":"b99aed9d.02087","type":"http in","z":"ddea0b03.5c5658","name":"","url":"/unlink-pipeline-from-environment","method":"post","swaggerDoc":"","x":228,"y":1076,"wires":[["147a1774.bc0409"]]},{"id":"147a1774.bc0409","type":"function","z":"ddea0b03.5c5658","name":"unlink-pipeline-from-environment","func":"msg.topic = 'unlink-pipeline-from-environment';\nreturn msg;","outputs":1,"noerr":0,"x":534,"y":1074,"wires":[["1aad2b6e.675395"]]},{"type":"tab","label":"Pipelines 3","id":"628500c4.2bd49"},{"id":"22c490bd.7ac23","type":"http in","z":"628500c4.2bd49","name":"","url":"/set-key-value","method":"put","swaggerDoc":"","x":155.5,"y":111,"wires":[["9deef954.73bd38","db98cb0e.a27748"]]},{"id":"be4a7e41.274e1","type":"http response","z":"628500c4.2bd49","name":"","x":575.5,"y":284,"wires":[]},{"id":"9deef954.73bd38","type":"function","z":"628500c4.2bd49","name":"","func":"msg.topic = 'set-key-value';\nmsg.key = msg.payload.key;\nmsg.payload = msg.payload.data;\nreturn msg;","outputs":1,"noerr":0,"x":369.5,"y":112,"wires":[["b7c8670c.bbd988"]]},{"id":"b7c8670c.bbd988","type":"subflow:a6b9a798.463af8","z":"628500c4.2bd49","x":483.5,"y":188,"wires":[["be4a7e41.274e1"]],"subflow":"a6b9a798.463af8"},{"id":"27eef299.cb3a4e","type":"catch","z":"628500c4.2bd49","name":"","scope":null,"x":108.5,"y":353,"wires":[["db98cb0e.a27748"]]},{"id":"db98cb0e.a27748","type":"debug","z":"628500c4.2bd49","name":"","active":true,"console":"false","complete":"true","x":247.5,"y":353,"wires":[]},{"id":"50b5493a.abdbb8","type":"comment","z":"628500c4.2bd49","name":"Sample CURL","info":"curl -v -H \"Authorization: Bearer 858b01ac65893ad97ba5b2ced893019b51f3bcc2\" -X PUT https://ese00c.canzea.cc/gw/api/set-key-value -d '{\"key\":\"components/gs-actuator-service-5/cd_pipelines/intg/name\", \"data\":\"gs-actuator-service-5-master-Integration-deploy\"}' -H \"Content-Type:application/json\"\n\ncurl -v -H \"Authorization: Bearer 858b01ac65893ad97ba5b2ced893019b51f3bcc2\" -X PUT https://ese00c.canzea.cc/gw/api/set-key-value -d '{\"key\":\"components/gs-actuator-service-5/cd_pipelines/intg/lastDeploy\", \"data\":\"1501527359510\"}' -H \"Content-Type:application/json\"\n","x":123.5,"y":430,"wires":[]},{"type":"tab","label":"Pipelines","id":"59b02de.59e79d4"},{"id":"61969da4.8edb94","type":"inject","z":"59b02de.59e79d4","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":98.5,"y":75,"wires":[["28217028.172f7"]]},{"id":"c8126364.1cb8e","type":"debug","z":"59b02de.59e79d4","name":"","active":true,"console":"false","complete":"true","x":642.5,"y":299,"wires":[]},{"id":"8fc128bd.21b498","type":"function","z":"59b02de.59e79d4","name":"Prepare","func":"pl = msg.payload;\nname = pl.name;\nmsg0 = {\"payload\":{\"name\":name}, \"filename\":\"/tmp/environments-\" + name + \".json\"};\nmsg.env = {\"CONSUL_URL\": \"https://consul.service.dc1.consul:8080\"};\nmsg.payload = \"--lifecycle=wire --solution=gocd --action=post-object-v1 --args='{\\\"type\\\":\\\"environments\\\",\\\"name\\\":\\\"\" + name + \"\\\"}'\";\nreturn [msg0, msg, msg];\n\n","outputs":"3","noerr":0,"x":306.5,"y":318,"wires":[["420bc8b4.e9d448"],["d57f1c76.303a3","5855d25f.abab8c"],[]]},{"id":"420bc8b4.e9d448","type":"file","z":"59b02de.59e79d4","name":"Prepare payload","filename":"","appendNewline":false,"createDir":false,"overwriteFile":"true","x":534.5,"y":203,"wires":[]},{"id":"784c37e0.cd2508","type":"http in","z":"59b02de.59e79d4","name":"","url":"/environments","method":"post","swaggerDoc":"","x":137.5,"y":489,"wires":[["3a6715f4.074efa","314c7d76.abef02"]]},{"id":"28217028.172f7","type":"function","z":"59b02de.59e79d4","name":"Default","func":"msg.payload = {'name':'test100'};\nreturn msg;","outputs":1,"noerr":0,"x":237.5,"y":75,"wires":[["8fc128bd.21b498"]]},{"id":"314c7d76.abef02","type":"json-schema","z":"59b02de.59e79d4","name":"","func":"{\n    \"$schema\": \"http://json-schema.org/draft-04/schema#\",\n    \"title\": \"Environment\",\n    \"type\": \"object\",\n    \"properties\": {\n        \"name\": {\n            \"description\": \"Name of the environment\",\n            \"type\": \"string\"\n        }\n    },\n    \"required\": [\"name\"]\n}","x":373.5,"y":489,"wires":[["8fc128bd.21b498"]]},{"id":"ce5c09bd.545018","type":"comment","z":"59b02de.59e79d4","name":"curl -H \"Authorization: Bearer 33ef854766b61e7901ddc1c41f2fee8f693aa423\" -X POST https://escd27.canzea.cc/gw/api/environments --data 'name=dude5'","info":"","x":550.5,"y":682,"wires":[]},{"id":"b8c2183d.343988","type":"http response","z":"59b02de.59e79d4","name":"","x":987.5,"y":364,"wires":[]},{"id":"3a6715f4.074efa","type":"debug","z":"59b02de.59e79d4","name":"","active":true,"console":"false","complete":"true","x":347,"y":546,"wires":[]},{"id":"58e09871.0576a8","type":"switch","z":"59b02de.59e79d4","name":"","property":"control.state","propertyType":"msg","rules":[{"t":"eq","v":"start","vt":"str"},{"t":"eq","v":"running","vt":"str"},{"t":"eq","v":"error","vt":"str"},{"t":"eq","v":"end","vt":"str"}],"checkall":"false","outputs":4,"x":667.5,"y":384,"wires":[[],[],["645c70a3.6df13"],["98ff3e98.c461f"]]},{"id":"645c70a3.6df13","type":"function","z":"59b02de.59e79d4","name":"Error","func":"msg.payload = \"ERROR \" + JSON.stringify(msg.error ? msg.error : msg.control);\nmsg.statusCode = 500;\nreturn msg;","outputs":1,"noerr":0,"x":819.5,"y":294,"wires":[["b8c2183d.343988"]]},{"id":"98ff3e98.c461f","type":"function","z":"59b02de.59e79d4","name":"Success","func":"msg.payload = null;\nmsg.statusCode = 200;\nmsg.topic = 'result';\nreturn msg;","outputs":1,"noerr":0,"x":814,"y":462,"wires":[["b8c2183d.343988"]]},{"id":"d57f1c76.303a3","type":"debug","z":"59b02de.59e79d4","name":"","active":true,"console":"false","complete":"true","x":490,"y":378,"wires":[]},{"id":"5855d25f.abab8c","type":"bigexec","z":"59b02de.59e79d4","name":"","command":"/home/pm2user/canzea.sh","commandArgs":"","minError":1,"minWarning":1,"cwd":"/tmp","shell":"","extraArgumentProperty":"","envProperty":"","format":"utf8","limiter":true,"payloadIs":"argumentNoStdin","x":480.5,"y":299.5,"wires":[["c8126364.1cb8e"],["c8126364.1cb8e","58e09871.0576a8"],["c8126364.1cb8e"]]},{"id":"8150aca.da6695","type":"catch","z":"59b02de.59e79d4","name":"","scope":null,"x":675.5,"y":147,"wires":[["645c70a3.6df13"]]},{"type":"tab","label":"Play Area","id":"e8e16179.5b2af"},{"id":"8b2e796.d16f788","type":"subflow:811542a8.5ac78","z":"e8e16179.5b2af","x":447.5,"y":271,"wires":[["e10487e3.bc0768"]],"subflow":"811542a8.5ac78"},{"id":"22c71c06.26ef84","type":"inject","z":"e8e16179.5b2af","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":104.5,"y":148,"wires":[["230fb1c1.4d8cae"]]},{"id":"e10487e3.bc0768","type":"debug","z":"e8e16179.5b2af","name":"","active":true,"console":"false","complete":"payload","x":641.5,"y":274,"wires":[]},{"id":"230fb1c1.4d8cae","type":"function","z":"e8e16179.5b2af","name":"","func":"msg.topic = 'plus:monitoring_dashboard';\nmsg.key = 'platform-overview';\nmsg.req = {\n    \"headers\": {\n        \"X-Vault-Token\": \"990cc0fc-fec8-e0dc-b8f9-817e63b58565\"\n    }\n}\nmsg.payload = \n{\n    \"id\": msg.key,\n    \"title\": \"Production Overview\",\n    \"tags\": [ \"templated\" ],\n    \"timezone\": \"browser\",\n    \"rows\": [\n      {\n      }\n    ],\n    \"schemaVersion\": 6,\n    \"version\": 0\n}\nreturn msg;","outputs":1,"noerr":0,"x":228.5,"y":204,"wires":[["8b2e796.d16f788"]]},{"id":"102125f.c6fcdda","type":"function","z":"e8e16179.5b2af","name":"MINUS","func":"msg.topic = 'minus:monitoring_dashboard';\nmsg.key = 'production-overview';\nmsg.req = {\n    \"headers\": {\n        \"X-Vault-Token\": \"990cc0fc-fec8-e0dc-b8f9-817e63b58565\"\n    }\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":268,"y":345,"wires":[["8b2e796.d16f788"]]},{"id":"b7791da9.2508d","type":"inject","z":"e8e16179.5b2af","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":102,"y":349,"wires":[["102125f.c6fcdda"]]},{"id":"f79990e3.c9165","type":"subflow:d8491633.ad8e18","z":"e8e16179.5b2af","x":471.5,"y":455,"wires":[["f23f5de9.0bc53"]],"subflow":"d8491633.ad8e18"},{"id":"34dbe42.36e271c","type":"inject","z":"e8e16179.5b2af","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":90,"y":458,"wires":[["7ef75112.f7adf"]]},{"id":"7ef75112.f7adf","type":"function","z":"e8e16179.5b2af","name":"SET","func":"msg.req = {\n    \"headers\": {\n        \"x-vault-token\":\"p990cc0fc-fec8-e0dc-b8f9-817e63b58565\"\n    }\n}\nmsg.payload = 'github/ikethecoder/hello-world-svc-app';\nreturn msg;","outputs":1,"noerr":0,"x":266,"y":457,"wires":[["f79990e3.c9165"]]},{"id":"fc7356b6.a660e8","type":"debug","z":"e8e16179.5b2af","name":"","active":false,"console":"false","complete":"true","x":721,"y":459,"wires":[]},{"id":"4bde04c2.9d3bec","type":"subflow:cc909323.1bc6b","z":"e8e16179.5b2af","x":340.5,"y":563,"wires":[[]],"subflow":"cc909323.1bc6b"},{"id":"d6c81063.bdde7","type":"function","z":"e8e16179.5b2af","name":"SET","func":"msg.req = {\n    \"headers\": {\n        \"x-vault-token\":\"p990cc0fc-fec8-e0dc-b8f9-817e63b58565\"\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"x":150,"y":564,"wires":[["4bde04c2.9d3bec"]]},{"id":"af170359.2134a","type":"catch","z":"e8e16179.5b2af","name":"","scope":null,"x":336.5,"y":669,"wires":[["91e2f41c.b80fe8"]]},{"id":"bfdb1167.c00a5","type":"debug","z":"e8e16179.5b2af","name":"","active":true,"console":"false","complete":"true","x":617.5,"y":668,"wires":[]},{"id":"f23f5de9.0bc53","type":"function","z":"e8e16179.5b2af","name":"","func":"node.warn (\"Got here\")\nreturn msg;","outputs":1,"noerr":0,"x":642.5,"y":412,"wires":[["fc7356b6.a660e8"]]},{"id":"91e2f41c.b80fe8","type":"function","z":"e8e16179.5b2af","name":"","func":"msg.payload = \"Catch all - unable to process\";\nreturn msg;","outputs":1,"noerr":0,"x":485.5,"y":628,"wires":[["bfdb1167.c00a5"]]},{"id":"8205995d.d43ee8","type":"http in","z":"e8e16179.5b2af","name":"","url":"/playground/mirror","method":"post","swaggerDoc":"","x":188.5,"y":68,"wires":[["f5885fa3.3324a"]]},{"id":"f5885fa3.3324a","type":"http response","z":"e8e16179.5b2af","name":"","x":379.5,"y":69,"wires":[]},{"type":"tab","label":"Policies Users","id":"1b7970ae.98de3f"},{"id":"75153709.148b78","type":"function","z":"1b7970ae.98de3f","name":"get-policies","func":"msg.topic = 'get-policies'\nreturn msg;","outputs":1,"noerr":0,"x":330.5,"y":41,"wires":[["494aa725.5dde68"]]},{"id":"be1cb6b3.e92c58","type":"http in","z":"1b7970ae.98de3f","name":"","url":"/policies","method":"get","swaggerDoc":"","x":98.5,"y":40,"wires":[["75153709.148b78"]]},{"id":"f3a8d513.86a288","type":"http response","z":"1b7970ae.98de3f","name":"","x":711.5,"y":251,"wires":[]},{"id":"65c7d186.e56a7","type":"function","z":"1b7970ae.98de3f","name":"get-policy","func":"msg.key = msg.req.params.id;\nmsg.topic = 'get-policy'\nreturn msg;","outputs":1,"noerr":0,"x":322,"y":92,"wires":[["494aa725.5dde68"]]},{"id":"80ee00a4.17989","type":"http in","z":"1b7970ae.98de3f","name":"","url":"/policy/:id","method":"get","swaggerDoc":"","x":110,"y":91,"wires":[["65c7d186.e56a7"]]},{"id":"9624f510.f7f788","type":"function","z":"1b7970ae.98de3f","name":"put-policy","func":"msg.key = msg.req.params.id;\nmsg.topic = 'put-policy'\nreturn msg;","outputs":1,"noerr":0,"x":321,"y":142,"wires":[["494aa725.5dde68"]]},{"id":"be0363e.67f55a","type":"http in","z":"1b7970ae.98de3f","name":"","url":"/policy/:id","method":"put","swaggerDoc":"","x":109,"y":141,"wires":[["9624f510.f7f788"]]},{"id":"d5ba39ca.671d78","type":"function","z":"1b7970ae.98de3f","name":"delete-policy","func":"msg.key = msg.req.params.id;\nmsg.topic = 'delete-policy'\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":192,"wires":[["494aa725.5dde68"]]},{"id":"421bcef2.29f03","type":"http in","z":"1b7970ae.98de3f","name":"","url":"/policy/:id","method":"delete","swaggerDoc":"","x":117,"y":192,"wires":[["d5ba39ca.671d78"]]},{"id":"1ef0db6e.0e38a5","type":"http in","z":"1b7970ae.98de3f","name":"","url":"/users","method":"get","swaggerDoc":"","x":101,"y":299,"wires":[["4160b23d.efd4ac"]]},{"id":"4160b23d.efd4ac","type":"function","z":"1b7970ae.98de3f","name":"get-users","func":"msg.topic = 'get-users'\nreturn msg;","outputs":1,"noerr":0,"x":322,"y":291,"wires":[["a35fa815.abde18"]]},{"id":"dd4a59e4.aa49a8","type":"function","z":"1b7970ae.98de3f","name":"get-user","func":"msg.key = msg.req.params.id;\nmsg.topic = 'check:vault_user'\nreturn msg;","outputs":1,"noerr":0,"x":327,"y":348,"wires":[["a35fa815.abde18"]]},{"id":"1a44eea6.c4c0b1","type":"http in","z":"1b7970ae.98de3f","name":"","url":"/user/:id","method":"get","upload":false,"swaggerDoc":"","x":105,"y":342,"wires":[["dd4a59e4.aa49a8"]]},{"id":"49e3de8a.e03b4","type":"function","z":"1b7970ae.98de3f","name":"put-user","func":"msg.key = msg.req.params.id;\nmsg.topic = 'plus:vault_user'\nreturn msg;","outputs":1,"noerr":0,"x":334,"y":397,"wires":[["a35fa815.abde18"]]},{"id":"76c65a8f.6b81e4","type":"http in","z":"1b7970ae.98de3f","name":"","url":"/user/:id","method":"put","upload":false,"swaggerDoc":"","x":112,"y":396,"wires":[["49e3de8a.e03b4"]]},{"id":"c1e1c6b1.7f3d38","type":"function","z":"1b7970ae.98de3f","name":"delete-user","func":"msg.key = msg.req.params.id;\nmsg.topic = 'minus:vault_user'\nreturn msg;","outputs":1,"noerr":0,"x":345,"y":447,"wires":[["a35fa815.abde18"]]},{"id":"d04ae327.8f5b5","type":"http in","z":"1b7970ae.98de3f","name":"","url":"/user/:id","method":"delete","upload":false,"swaggerDoc":"","x":123,"y":446,"wires":[["c1e1c6b1.7f3d38"]]},{"id":"494aa725.5dde68","type":"subflow:d773a612.5b2d98","z":"1b7970ae.98de3f","x":550.5,"y":118,"wires":[["f3a8d513.86a288"]],"subflow":"d773a612.5b2d98"},{"id":"a35fa815.abde18","type":"subflow:d773a612.5b2d98","z":"1b7970ae.98de3f","x":510,"y":360,"wires":[["f3a8d513.86a288"]],"subflow":"d773a612.5b2d98"},{"type":"tab","label":"Rocket.Chat","id":"c5d174f1.e74f08"},{"id":"2ffedc15.007f04","type":"inject","z":"c5d174f1.e74f08","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":116,"y":120,"wires":[["f923a92.6a54f58"]]},{"id":"ec3a2fda.153b8","type":"http request","z":"c5d174f1.e74f08","name":"Login","method":"POST","ret":"obj","url":"http://localhost:8780/api/login","tls":"","x":375.5,"y":261,"wires":[["f7ba7b42.faa3c8","11c157d2.32c4b8"]]},{"id":"f923a92.6a54f58","type":"function","z":"c5d174f1.e74f08","name":"","func":"msg.payload = {\n    \"user\": \"aidan\",\n    \"password\": \"acope29\"\n};\nreturn msg;","outputs":1,"noerr":0,"x":224.5,"y":262,"wires":[["ec3a2fda.153b8"]]},{"id":"c799be66.23a85","type":"debug","z":"c5d174f1.e74f08","name":"","active":true,"console":"false","complete":"true","x":669.5,"y":199,"wires":[]},{"id":"f7ba7b42.faa3c8","type":"function","z":"c5d174f1.e74f08","name":"","func":"token = msg.payload.data.authToken;\nuserId = msg.payload.data.userId;\nmsg.headers = {\n    \"X-Auth-Token\": token,\n    \"X-User-Id\": userId,\n    'Content-Type': 'application/json'\n};\nmsg.req_headers = msg.headers;\nreturn msg;","outputs":1,"noerr":0,"x":493.5,"y":340,"wires":[["a26d30e3.61ec5","c799be66.23a85"]]},{"id":"a26d30e3.61ec5","type":"http request","z":"c5d174f1.e74f08","name":"Public Rooms","method":"GET","ret":"obj","url":"http://localhost:8780/api/v1/channels.list","tls":"","x":519,"y":404,"wires":[["c799be66.23a85","67b2281c.6325c8"]]},{"id":"a3a58a0a.93df88","type":"file","z":"c5d174f1.e74f08","name":"","filename":"/home/pm2user/req.log","appendNewline":true,"createDir":false,"overwriteFile":"true","x":737.5,"y":482,"wires":[]},{"id":"468bc807.963a48","type":"function","z":"c5d174f1.e74f08","name":"Find Room","func":"msg.topic = msg.payload.channels[0]._id;\nmsg.headers = msg.req_headers;\nreturn msg;\n","outputs":1,"noerr":0,"x":426.5,"y":496,"wires":[["f2be4714.701348"]]},{"id":"f2be4714.701348","type":"http request","z":"c5d174f1.e74f08","name":"Get Room","method":"GET","ret":"txt","url":"http://localhost:8780/api/v1/channels.info?roomId={{topic}}","tls":"","x":561,"y":563,"wires":[["a3a58a0a.93df88","c799be66.23a85"]]},{"id":"427a89ef.0d1f38","type":"http request","z":"c5d174f1.e74f08","name":"Post Message","method":"POST","ret":"txt","url":"http://localhost:8780/api/v1/chat.postMessage","tls":"","x":571,"y":627,"wires":[[]]},{"id":"67b2281c.6325c8","type":"function","z":"c5d174f1.e74f08","name":"Post Message","func":"//msg.topic = msg.payload.channels[0]._id;\nmsg.headers = msg.req_headers;\nmsg.payload = {\n    \"channel\": \"#\" + msg.topic,\n    \"text\": msg.message\n}\nreturn msg;\n","outputs":1,"noerr":0,"x":375,"y":626,"wires":[["427a89ef.0d1f38"]]},{"id":"a115f5fd.bc2208","type":"http request","z":"c5d174f1.e74f08","name":"Create Channel","method":"POST","ret":"obj","url":"http://localhost:8780/api/v1/channels.create","tls":"","x":289,"y":410,"wires":[["c799be66.23a85"]]},{"id":"11c157d2.32c4b8","type":"function","z":"c5d174f1.e74f08","name":"","func":"token = msg.payload.data.authToken;\nuserId = msg.payload.data.userId;\nmsg.headers = {\n    \"X-Auth-Token\": token,\n    \"X-User-Id\": userId,\n    'Content-Type': 'application/json'\n};\nmsg.req_headers = msg.headers;\nmsg.payload = {\n    \"name\":\"Env-1\"\n}\nreturn msg;","outputs":1,"noerr":0,"x":139,"y":410,"wires":[["a115f5fd.bc2208"]]},{"id":"d9a3482e.b99b78","type":"function","z":"c5d174f1.e74f08","name":"","func":"msg.topic = msg.req.params.channel;\nmsg.message = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"x":143.5,"y":624,"wires":[["f923a92.6a54f58"]]},{"id":"2cf2ee3b.2aa582","type":"http in","z":"c5d174f1.e74f08","name":"","url":"/channel/:channel/message","method":"post","swaggerDoc":"","x":184,"y":704,"wires":[["cbd18711.092498"]]},{"id":"cbd18711.092498","type":"function","z":"c5d174f1.e74f08","name":"Prep Data","func":"msg.topic = 'send-message';\nmsg.payload = {\n    \"text\": msg.payload\n};\nreturn msg;","outputs":1,"noerr":0,"x":428.5,"y":704,"wires":[["bcddd3c6.0aa9c"]]},{"id":"bcddd3c6.0aa9c","type":"subflow:459ae946.b59388","z":"c5d174f1.e74f08","x":631.5,"y":704,"wires":[["ae551134.6a178"]],"subflow":"459ae946.b59388"},{"id":"ae551134.6a178","type":"http response","z":"c5d174f1.e74f08","name":"","x":824.5,"y":705,"wires":[]},{"id":"db5c7d6e.0737c","type":"comment","z":"c5d174f1.e74f08","name":"https://escd27.canzea.cc/gw/api/channel/Env-1/message","info":"","x":249.5,"y":745,"wires":[]},{"id":"9987d84d.47c658","type":"http in","z":"c5d174f1.e74f08","name":"","url":"/user","method":"post","swaggerDoc":"","x":117.22221755981445,"y":854.4443969726562,"wires":[["26d6c.1b33b294e"]]},{"id":"26d6c.1b33b294e","type":"function","z":"c5d174f1.e74f08","name":"Prep Data","func":"msg.topic = 'create-user';\nreturn msg;","outputs":1,"noerr":0,"x":431.72221755981445,"y":854.4443969726562,"wires":[["381ae123.45cb9e"]]},{"id":"74b163ed.95d54c","type":"http response","z":"c5d174f1.e74f08","name":"","x":827.7222175598145,"y":855.4443969726562,"wires":[]},{"id":"381ae123.45cb9e","type":"subflow:9ed8bb48.699498","z":"c5d174f1.e74f08","x":617.2221984863281,"y":851.1110973358154,"wires":[["74b163ed.95d54c"]],"subflow":"9ed8bb48.699498"},{"id":"e9add4cb.66d538","type":"http in","z":"c5d174f1.e74f08","name":"","url":"/group","method":"post","swaggerDoc":"","x":121.66666793823242,"y":896.6666259765625,"wires":[["cf4426d0.e91528"]]},{"id":"cf4426d0.e91528","type":"function","z":"c5d174f1.e74f08","name":"Prep Data","func":"msg.topic = 'create-group';\nmsg.payload = {\n    \"name\": msg.payload\n};\nreturn msg;","outputs":1,"noerr":0,"x":436.1666679382324,"y":896.6666259765625,"wires":[["aeddbcc2.4f46e"]]},{"id":"2c368e75.577792","type":"http response","z":"c5d174f1.e74f08","name":"","x":832.1666679382324,"y":897.6666259765625,"wires":[]},{"id":"aeddbcc2.4f46e","type":"subflow:3206ac46.8fc5e4","z":"c5d174f1.e74f08","x":619.444465637207,"y":897.777759552002,"wires":[["2c368e75.577792"]],"subflow":"3206ac46.8fc5e4"},{"id":"23c7180b.93ea48","type":"http in","z":"c5d174f1.e74f08","name":"","url":"/rocketchat_hook","method":"post","swaggerDoc":"","x":179.44444444444446,"y":958.8888888888889,"wires":[["c5ccdcdc.b324d","9e0389.b6593c78"]]},{"id":"c5ccdcdc.b324d","type":"function","z":"c5d174f1.e74f08","name":"Build response","func":"txt = msg.payload.text;\nnam = msg.payload.user_name;\nmsg.payload = \n{\n  \"text\": nam + \", hi!\",\n  \"xattachments\": [\n    {\n      \"title\": \"Canzea Ecosystem\",\n      \"title_link\": \"https://escd27.canzea.cc\",\n      \"text\": \"Your ecosystem is up and running.\",\n      \"image_url\": \"https://canzea.gitlab.io/img/canzea_logo.png\",\n      \"color\": \"#764FA5\"\n    }\n  ]\n};\n\nreturn msg;","outputs":1,"noerr":0,"x":416.1111183166504,"y":1015.5555744171143,"wires":[["c60c100f.c07bf"]]},{"id":"c60c100f.c07bf","type":"http response","z":"c5d174f1.e74f08","name":"","x":602.7777252197266,"y":1016.6666469573975,"wires":[]},{"id":"9e0389.b6593c78","type":"debug","z":"c5d174f1.e74f08","name":"","active":true,"console":"false","complete":"false","x":399.44444444444446,"y":961.1111111111111,"wires":[]},{"id":"13eaec4d.936774","type":"http in","z":"c5d174f1.e74f08","name":"","url":"/channel/:channel/pipeline_message","method":"post","swaggerDoc":"","x":185,"y":664,"wires":[["9ac26443.dc1fc8"]]},{"id":"9ac26443.dc1fc8","type":"function","z":"c5d174f1.e74f08","name":"","func":"msg.payload = \"Added component \" + msg.payload.name + \" to the ecosystem.\";\nreturn msg;","outputs":1,"noerr":0,"x":439.5,"y":663,"wires":[["cbd18711.092498"]]},{"type":"tab","label":"Secrets","id":"ccbcb802.9b5ce8"},{"id":"523b9dbc.7d9504","type":"subflow:d773a612.5b2d98","z":"ccbcb802.9b5ce8","name":"","x":600,"y":240,"wires":[["b68ff2b9.07ee7"]],"subflow":"d773a612.5b2d98"},{"id":"b68ff2b9.07ee7","type":"http response","z":"ccbcb802.9b5ce8","name":"","x":737,"y":240,"wires":[]},{"id":"b1bf0e85.f8ee2","type":"function","z":"ccbcb802.9b5ce8","name":"get-secrets","func":"msg.topic = 'get-secrets'\nmsg.key = msg.req.params.type;\nreturn msg;","outputs":1,"noerr":0,"x":355.5,"y":229,"wires":[["523b9dbc.7d9504"]]},{"id":"3081011.43dcafe","type":"http in","z":"ccbcb802.9b5ce8","name":"","url":"/secrets/:type","method":"get","upload":false,"swaggerDoc":"","x":143.5,"y":228,"wires":[["b1bf0e85.f8ee2"]]},{"id":"a161bd61.a3d3f","type":"catch","z":"ccbcb802.9b5ce8","name":"","scope":null,"x":380,"y":500,"wires":[["c1a8422c.c04bc","b68ff2b9.07ee7"]]},{"id":"c1a8422c.c04bc","type":"debug","z":"ccbcb802.9b5ce8","name":"","active":true,"console":"false","complete":"false","x":621,"y":512,"wires":[]},{"id":"cc261194.9a5be","type":"function","z":"ccbcb802.9b5ce8","name":"get-secret","func":"msg.key = msg.req.params.id;\nmsg.topic = 'check:vault_secret'\nreturn msg;","outputs":1,"noerr":0,"x":355.5,"y":269,"wires":[["523b9dbc.7d9504"]]},{"id":"a394dfc3.6633c","type":"http in","z":"ccbcb802.9b5ce8","name":"","url":"/secret/:id","method":"get","upload":false,"swaggerDoc":"","x":133.5,"y":263,"wires":[["cc261194.9a5be"]]},{"id":"8047b94f.7e4a28","type":"function","z":"ccbcb802.9b5ce8","name":"put-secret","func":"msg.key = msg.req.params.id;\nmsg.topic = 'plus:vault_secret'\nreturn msg;","outputs":1,"noerr":0,"x":362.5,"y":318,"wires":[["523b9dbc.7d9504"]]},{"id":"4fcee91c.899a78","type":"http in","z":"ccbcb802.9b5ce8","name":"","url":"/secret/:id","method":"put","upload":false,"swaggerDoc":"","x":140.5,"y":317,"wires":[["8047b94f.7e4a28"]]},{"id":"6fe23942.11eb28","type":"function","z":"ccbcb802.9b5ce8","name":"delete-secret","func":"msg.key = msg.req.params.id;\nmsg.topic = 'minus:vault_secret'\nreturn msg;","outputs":1,"noerr":0,"x":363.5,"y":368,"wires":[["523b9dbc.7d9504"]]},{"id":"4be0fdae.ccc044","type":"http in","z":"ccbcb802.9b5ce8","name":"","url":"/secret/:id","method":"delete","upload":false,"swaggerDoc":"","x":151.5,"y":367,"wires":[["6fe23942.11eb28"]]},{"id":"440ec897.602dd8","type":"http in","z":"ccbcb802.9b5ce8","name":"","url":"/secrets","method":"get","upload":false,"swaggerDoc":"","x":120,"y":160,"wires":[["3bc74794.75aee8"]]},{"id":"3bc74794.75aee8","type":"function","z":"ccbcb802.9b5ce8","name":"get-secrets","func":"msg.topic = 'get-secrets'\nmsg.key = \"\";\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":160,"wires":[["523b9dbc.7d9504"]]},{"type":"tab","label":"Services","id":"463d7654.9dff28"},{"id":"ba73ea78.709e88","type":"subflow:a6b9a798.463af8","z":"463d7654.9dff28","name":"","x":542.5,"y":278,"wires":[["a5954dda.e93ea"]],"subflow":"a6b9a798.463af8"},{"id":"6a0ec521.8f985c","type":"http in","z":"463d7654.9dff28","name":"","url":"/services","method":"post","swaggerDoc":"","x":102.5,"y":78,"wires":[["65e2ddf4.3d94d4"]]},{"id":"f6b73012.90ca1","type":"function","z":"463d7654.9dff28","name":"put-service","func":"msg.topic = 'put-service'\nreturn msg;","outputs":1,"noerr":0,"x":279.5,"y":131,"wires":[["ba73ea78.709e88"]]},{"id":"a5954dda.e93ea","type":"http response","z":"463d7654.9dff28","name":"","x":698.5,"y":278,"wires":[]},{"id":"65e2ddf4.3d94d4","type":"function","z":"463d7654.9dff28","name":"Prep","func":"p = msg.payload;\n\nid = p.environment + \"-\" + p.name + \"-\" + p.port;\n\nargs = {\n    \"name\":p.name,\n    \"id\": id,\n    \"address\": \"10.136.41.145\", \n    \"port\": Number(p.port)\n};\n\ntags = [\n    \"urlprefix-www.dev/api\"\n];\n\ncheck = {\n    \"http\" : \"http://10.136.41.145:3333/api/query/q/test\",\n    \"interval\" : \"10s\",\n    \"timeout\" : \"1s\"\n};\n\nmsg.payload = {\n        \"Name\" : args.name, \n        \"ID\" : args.id, \n        \"Address\" : args.address, \n        \"Port\" : args.port, \n        \"Tags\" : tags,\n        \"Check\" : check\n}\nreturn msg;\n","outputs":1,"noerr":0,"x":121,"y":130,"wires":[["f6b73012.90ca1","878f3062.6c77c"]]},{"id":"3e79e63f.f030aa","type":"http in","z":"463d7654.9dff28","name":"","url":"/service_check","method":"put","swaggerDoc":"","x":115,"y":519,"wires":[["a61d358b.aa7d18"]]},{"id":"cd24f6ca.f74fd8","type":"function","z":"463d7654.9dff28","name":"put-service","func":"msg.topic = 'put-service'\nreturn msg;","outputs":1,"noerr":0,"x":320,"y":603,"wires":[["ba73ea78.709e88"]]},{"id":"a61d358b.aa7d18","type":"function","z":"463d7654.9dff28","name":"Prep","func":"args = {\n    \"id\":\"enterprise-1236-5\",\n    \"Name\":\"enterprise\",\n    \"address\":\"10.136.17.79\", \n    \"port\":1236\n};\n\ntags = [\n    \"urlprefix-/enterprise\"\n];\n\ncheck = {\n    \"http\" : \"http://10.136.17.79:1235/health\",\n    \"interval\" : \"10s\",\n    \"timeout\" : \"1s\"\n};\n\nmsg.payload = {\n        \"ID\" : args.id, \n        \"Name\" : args.serviceName, \n        \"Address\" : args.address, \n        \"Port\" : args.port, \n        \"Tags\" : tags,\n        \"Check\" : check\n}\nreturn msg;\n","outputs":1,"noerr":0,"x":161.5,"y":602,"wires":[["cd24f6ca.f74fd8"]]},{"id":"d6b075db.21ffb8","type":"http in","z":"463d7654.9dff28","name":"","url":"/services","method":"delete","swaggerDoc":"","x":105,"y":189,"wires":[["f6aaa661.78fa18"]]},{"id":"10c506a.7790ef9","type":"function","z":"463d7654.9dff28","name":"delete-service","func":"msg.topic = 'delete-service'\nreturn msg;","outputs":1,"noerr":0,"x":292,"y":242,"wires":[["ba73ea78.709e88"]]},{"id":"f6aaa661.78fa18","type":"function","z":"463d7654.9dff28","name":"Prep","func":"args = {\n    \"name\":\"enterprise2\",\n    \"id\":\"test\",\n    \"address\":\"10.136.17.79\", \n    \"port\":1236\n};\n\ntags = [\n    \"urlprefix-/enterprise\"\n];\n\ncheck = {\n    \"http\" : \"http://10.136.17.79:1235/health\",\n    \"interval\" : \"10s\",\n    \"timeout\" : \"1s\"\n};\n\nmsg.payload = {\n        \"Name\" : args.name, \n        \"ID\" : args.id, \n        \"Address\" : args.address, \n        \"Port\" : args.port, \n        \"Tags\" : tags,\n        \"Check\" : check\n}\nreturn msg;\n","outputs":1,"noerr":0,"x":123.5,"y":241,"wires":[["10c506a.7790ef9"]]},{"id":"a3cc77cb.b78d38","type":"http in","z":"463d7654.9dff28","name":"","url":"/services/:state","method":"get","swaggerDoc":"","x":110,"y":327,"wires":[["d7a28618.8dfc68"]]},{"id":"2cfb8d65.4ac062","type":"function","z":"463d7654.9dff28","name":"list-health","func":"msg.topic = 'list-health'\nreturn msg;","outputs":1,"noerr":0,"x":307,"y":406,"wires":[["ba73ea78.709e88"]]},{"id":"d7a28618.8dfc68","type":"function","z":"463d7654.9dff28","name":"Set Param","func":"msg.payload = {\"state\": msg.req.params.state};\nreturn msg;","outputs":1,"noerr":0,"x":145.5,"y":407,"wires":[["2cfb8d65.4ac062"]]},{"id":"b23bcd52.5cd9c","type":"comment","z":"463d7654.9dff28","name":"any, passing, warning, or critical","info":"","x":141.5,"y":287,"wires":[]},{"id":"1a139964.5f9d87","type":"http in","z":"463d7654.9dff28","name":"","url":"/services","method":"get","swaggerDoc":"","x":570,"y":620,"wires":[["7d32199a.e901f8"]]},{"id":"7d32199a.e901f8","type":"function","z":"463d7654.9dff28","name":"list-services","func":"msg.topic = 'list-services'\nreturn msg;","outputs":1,"noerr":0,"x":770,"y":620,"wires":[["ba73ea78.709e88"]]},{"id":"da906cc9.ed393","type":"catch","z":"463d7654.9dff28","name":"","scope":null,"x":539,"y":165,"wires":[["f6d4026a.c334e","d1d09f2b.ad0e"]]},{"id":"f6d4026a.c334e","type":"function","z":"463d7654.9dff28","name":"Error","func":"msg.payload = {\n    \"error\": msg.message\n};\nmsg.statusCode = 400;\nreturn msg;","outputs":1,"noerr":0,"x":667.5,"y":165,"wires":[["a5954dda.e93ea"]]},{"id":"d1d09f2b.ad0e","type":"debug","z":"463d7654.9dff28","name":"","active":true,"console":"false","complete":"true","x":651.5,"y":92,"wires":[]},{"id":"878f3062.6c77c","type":"debug","z":"463d7654.9dff28","name":"","active":true,"console":"false","complete":"true","x":334,"y":72,"wires":[]},{"id":"d84a2c78.943fa","type":"http in","z":"463d7654.9dff28","name":"","url":"/health/:service","method":"get","upload":false,"swaggerDoc":"","x":120,"y":480,"wires":[["8e0afe12.c8129"]]},{"id":"8e0afe12.c8129","type":"function","z":"463d7654.9dff28","name":"","func":"msg.payload = {\"service\": msg.req.params.service};\nmsg.topic = 'list-service-health';\nreturn msg;","outputs":1,"noerr":0,"x":341.5,"y":508,"wires":[["ba73ea78.709e88"]]},{"id":"1697b3c3.2a945c","type":"http in","z":"463d7654.9dff28","name":"","url":"/service_tags","method":"put","upload":false,"swaggerDoc":"","x":120,"y":660,"wires":[["ce96f0bd.cda6e"]]},{"id":"ce96f0bd.cda6e","type":"function","z":"463d7654.9dff28","name":"","func":"msg.topic = 'put-service'\nmsg.resource = Object.keys(msg.payload)[0];\nmsg.key = Object.keys(msg.payload[msg.resource])[0];\nmsg.payload = msg.payload[msg.resource][msg.key];\nreturn msg;","outputs":1,"noerr":0,"x":356.5,"y":686,"wires":[["ba73ea78.709e88"]]},{"type":"tab","label":"Simple HW","id":"38ff073a.a48ba8"},{"id":"25b2b11.36aa94e","type":"subflow:459ae946.b59388","z":"38ff073a.a48ba8","name":"","x":492.5,"y":98,"wires":[[]],"subflow":"459ae946.b59388"},{"id":"b3ebafc0.08f7e","type":"inject","z":"38ff073a.a48ba8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":125.5,"y":98,"wires":[["a0b29258.5eada"]]},{"id":"a0b29258.5eada","type":"function","z":"38ff073a.a48ba8","name":"","func":"msg.topic = 'send-message'\nmsg.channel = '#general'\nmsg.payload = {\n    \"text\": \"hello team\"\n}\nreturn msg;","outputs":1,"noerr":0,"x":268.5,"y":98,"wires":[["25b2b11.36aa94e"]]},{"type":"tab","label":"Slack Simulator","id":"98a3b817.51da78"},{"id":"e22072e4.1d607","type":"http in","z":"98a3b817.51da78","name":"","url":"/emu/slack","method":"post","upload":false,"swaggerDoc":"","x":170.5,"y":134,"wires":[["6213e675.244b98","b32ec11f.67322"]]},{"id":"6213e675.244b98","type":"http response","z":"98a3b817.51da78","name":"","statusCode":"","headers":{},"x":407.5,"y":135,"wires":[]},{"id":"b32ec11f.67322","type":"debug","z":"98a3b817.51da78","name":"","active":true,"console":"false","complete":"true","x":338.5,"y":243,"wires":[]},{"id":"a180255d.5e8a98","type":"http in","z":"98a3b817.51da78","name":"Go.CD GitLab Compatibility","url":"/v3/user","method":"get","upload":false,"swaggerDoc":"","x":137.5,"y":395,"wires":[["8be521ec.b0423","ad262b0f.980548"]]},{"id":"84e93199.6b90b","type":"http response","z":"98a3b817.51da78","name":"","statusCode":"","headers":{},"x":593,"y":374,"wires":[]},{"id":"8be521ec.b0423","type":"function","z":"98a3b817.51da78","name":"","func":"msg.payload = {\n    \"social-auth-manager\": {\n    \"name\": \"joe\",\n    \"email\": \"joe@gmail.com\",\n    \"username\": \"Joe\"\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"x":380.5,"y":375,"wires":[["58512f08.3ec95"]]},{"id":"ad262b0f.980548","type":"debug","z":"98a3b817.51da78","name":"","active":true,"console":"false","complete":"false","x":403.5,"y":431,"wires":[]},{"id":"58512f08.3ec95","type":"json","z":"98a3b817.51da78","name":"","pretty":false,"x":517.5,"y":320,"wires":[["84e93199.6b90b"]]},{"type":"tab","label":"VARS","id":"e2c8182c.ecdb28"},{"id":"9d10fd85.4d413","type":"inject","z":"e2c8182c.ecdb28","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":120,"y":60,"wires":[["c88d8361.91a9d"]]},{"id":"65cf8ef3.29e59","type":"vars","z":"e2c8182c.ecdb28","name":"VAULT","propertyType":{"context":{"location":{"href":"https://esdade.canzea.cc/gwadmin/#flow/8d16e131.e7aad","ancestorOrigins":{},"origin":"https://esdade.canzea.cc","protocol":"https:","host":"esdade.canzea.cc","hostname":"esdade.canzea.cc","port":"","pathname":"/gwadmin/","search":"","hash":"#flow/8d16e131.e7aad"},"jQuery111306105483551972906":1},"selector":"#node-input-property"},"rules":[{"t":"secret","v":"digitalocean","vt":"str"},{"t":"secret","v":"payload.key","vt":"msg"}],"checkall":"true","outputs":1,"tls":"94073df5.ac54f","url":"https://vault.service.dc1.consul:8200","x":450,"y":60,"wires":[["eccc3f5b.8f9d4"]]},{"id":"eccc3f5b.8f9d4","type":"debug","z":"e2c8182c.ecdb28","name":"","active":true,"console":"false","complete":"true","x":610,"y":60,"wires":[]},{"id":"835f305a.f2f83","type":"inject","z":"e2c8182c.ecdb28","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":120,"y":140,"wires":[["64fca6f1.0e0128"]]},{"id":"3d57f7bf.77ce68","type":"vars","z":"e2c8182c.ecdb28","name":"CONSUL","propertyType":{"context":{"location":{"href":"https://esdade.canzea.cc/gwadmin/#flow/cc909323.1bc6b","ancestorOrigins":{},"origin":"https://esdade.canzea.cc","protocol":"https:","host":"esdade.canzea.cc","hostname":"esdade.canzea.cc","port":"","pathname":"/gwadmin/","search":"","hash":"#flow/cc909323.1bc6b"},"jQuery11130187427721003254":1},"selector":"#node-input-property"},"rules":[{"t":"service","v":"payload.key","vt":"msg"}],"checkall":"true","outputs":1,"tls":"c792be07.29d4","url":"https://consul.service.dc1.consul:8080","x":460,"y":140,"wires":[["1f4418c4.21bb77"]]},{"id":"1f4418c4.21bb77","type":"debug","z":"e2c8182c.ecdb28","name":"","active":true,"console":"false","complete":"true","x":610,"y":140,"wires":[]},{"id":"c88d8361.91a9d","type":"function","z":"e2c8182c.ecdb28","name":"","func":"msg.payload = {key:'ABC'}\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":60,"wires":[["65cf8ef3.29e59"]]},{"id":"64fca6f1.0e0128","type":"function","z":"e2c8182c.ecdb28","name":"","func":"msg.payload = {key:'grafana'}\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":140,"wires":[["3d57f7bf.77ce68"]]},{"type":"tab","label":"Vault GET","id":"745f11ab.7452c"},{"id":"12e4f08f.af54ef","type":"http in","z":"745f11ab.7452c","name":"","url":"/vault","method":"get","swaggerDoc":"","x":115.55555725097656,"y":307.6666564941406,"wires":[["a74bc685.f65058"]]},{"id":"a74bc685.f65058","type":"function","z":"745f11ab.7452c","name":"Prep Request","func":"msg.key = msg.req.query.key;\nmsg.topic = 'check:vault_secret';\nreturn msg;","outputs":1,"noerr":0,"x":311.5,"y":307,"wires":[["682bafc5.01a9a"]]},{"id":"76d6a63c.33aef8","type":"http response","z":"745f11ab.7452c","name":"Response","x":609.5,"y":306,"wires":[]},{"id":"cd12da35.d45e18","type":"http in","z":"745f11ab.7452c","name":"","url":"/vault","method":"post","swaggerDoc":"","x":128,"y":364,"wires":[["547ab802.860318"]]},{"id":"547ab802.860318","type":"function","z":"745f11ab.7452c","name":"Prep Request","func":"msg.key = msg.req.query.key;\nmsg.topic = 'plus:vault_secret';\nreturn msg;","outputs":1,"noerr":0,"x":313.94444274902344,"y":363.3333435058594,"wires":[["682bafc5.01a9a"]]},{"id":"3ec41697.009aaa","type":"http in","z":"745f11ab.7452c","name":"","url":"/vault","method":"delete","swaggerDoc":"","x":126,"y":256,"wires":[["ea93eea.8e6501"]]},{"id":"ea93eea.8e6501","type":"function","z":"745f11ab.7452c","name":"Prep Request","func":"msg.key = msg.req.query.key;\nmsg.topic = 'minus:vault_secret';\nreturn msg;","outputs":1,"noerr":0,"x":311.94444274902344,"y":255.33334350585938,"wires":[["682bafc5.01a9a"]]},{"id":"682bafc5.01a9a","type":"subflow:d773a612.5b2d98","z":"745f11ab.7452c","name":"","x":462.5,"y":308,"wires":[["76d6a63c.33aef8"]],"subflow":"d773a612.5b2d98"},{"type":"tab","label":"Versioning","id":"9e6b666f.6c33f8"},{"id":"9e71ce8c.d68a9","type":"http in","z":"9e6b666f.6c33f8","name":"","url":"/versioning","method":"post","swaggerDoc":"","x":132.5,"y":92,"wires":[["e431f500.c8af88"]]},{"id":"5cbfcb3f.052a64","type":"http response","z":"9e6b666f.6c33f8","name":"Response","x":610.5,"y":149,"wires":[]},{"id":"c8f3bdf7.9b27d","type":"comment","z":"9e6b666f.6c33f8","name":"Major/Minor/Patch branching","info":"\nWhen a new branch of the code is created, it should\ncause a new build and deploy pipeline to be created.\n\nNeed to choose the environments for the pipeline.\n\nIt should also register in Consul the service so that it\nis picked up by Fabio.\n","x":138.5,"y":398,"wires":[]},{"id":"24ee88ff.e124b8","type":"function","z":"9e6b666f.6c33f8","name":"","func":"msg.topic = 'new';\nreturn msg;","outputs":1,"noerr":0,"x":317.5,"y":146,"wires":[["429afac5.f82bb4"]]},{"id":"429afac5.f82bb4","type":"subflow:cfce5daf.36867","z":"9e6b666f.6c33f8","name":"","x":470.5,"y":149,"wires":[["5cbfcb3f.052a64"]],"subflow":"cfce5daf.36867"},{"id":"60de5e6b.7c91d","type":"http in","z":"9e6b666f.6c33f8","name":"","url":"/versions","method":"post","swaggerDoc":"","x":100,"y":214,"wires":[["da2bf790.f14fd8"]]},{"id":"da2bf790.f14fd8","type":"function","z":"9e6b666f.6c33f8","name":"","func":"msg.topic = 'create';\nreturn msg;","outputs":1,"noerr":0,"x":312,"y":213,"wires":[["429afac5.f82bb4"]]},{"id":"86400a70.338348","type":"http in","z":"9e6b666f.6c33f8","name":"","url":"/versions-cleanup","method":"post","swaggerDoc":"","x":132,"y":270,"wires":[["d3e47cee.efc7f"]]},{"id":"d3e47cee.efc7f","type":"function","z":"9e6b666f.6c33f8","name":"","func":"msg.topic = 'cleanup';\nreturn msg;","outputs":1,"noerr":0,"x":314,"y":269,"wires":[["429afac5.f82bb4"]]},{"id":"e431f500.c8af88","type":"json-schema","z":"9e6b666f.6c33f8","name":"","func":"{\n    \"$schema\": \"http://json-schema.org/draft-04/schema#\",\n    \"title\": \"ComponentVersion\",\n    \"type\": \"object\",\n    \"properties\": {\n        \"name\": {\n            \"description\": \"Name of the component\",\n            \"type\": \"string\"\n        },\n        \"version\": {\n            \"description\": \"Baseline (default branch) version\",\n            \"type\": \"string\"\n        },\n        \"branch\": {\n            \"description\": \"Default Branch\",\n            \"type\": \"string\"\n        }\n    },\n    \"required\": [\"name\", \"branch\", \"version\"]\n}\n","x":335,"y":51,"wires":[["24ee88ff.e124b8"]]},{"type":"tab","label":"WebHooks","id":"6c933553.034aec"},{"id":"ccc1c6b1.6acc78","type":"http in","z":"6c933553.034aec","name":"","url":"/hooks/gogs","method":"post","upload":false,"swaggerDoc":"","x":131.5,"y":66,"wires":[["d2274c5a.befc7","af58491a.1ed538","b8475dfa.ebead"]]},{"id":"d2274c5a.befc7","type":"debug","z":"6c933553.034aec","name":"","active":true,"console":"false","complete":"true","x":406.5,"y":92,"wires":[]},{"id":"22041553.68d4fa","type":"subflow:459ae946.b59388","z":"6c933553.034aec","x":580,"y":140,"wires":[[]],"subflow":"459ae946.b59388"},{"id":"af58491a.1ed538","type":"function","z":"6c933553.034aec","name":"","func":"p = msg.payload;\nmsg.channel = 'general';\n\nmsg.payload = \"Source Control Event \" + p.repository.full_name;\n\ncolor = '#ff00ff';\n\ntextmsgs = [\n    \"**> \" + p.repository.full_name + '**',\n    \"**> \" + p.ref + '**',\n    \"Before: **\" + p.before.slice(0,10) + '**',\n    \"After:  **\" + p.after.slice(0,10) + '**\\n'\n];\n\np.commits.map((e) => {\n    textmsgs.push (e.message)\n    textmsgs.push ('Modified='+e.modified.length +', Added='+e.added.length +', Removed=' + e.removed.length + '\\n');\n});\n\nmsg.topic = 'send-message';\nmsg.payload = {\n    \"text\": msg.payload,\n    \"avatar\": \"https://es0390.canzea.cc/images/canzea_gw_icon_es.svg\",\n    \"attachments\": [{\n        \"color\": color,\n        \"text\": textmsgs.join('\\n')\n    }]\n};\nreturn msg;\n","outputs":1,"noerr":0,"x":360,"y":141,"wires":[["22041553.68d4fa"]]},{"id":"b8475dfa.ebead","type":"http response","z":"6c933553.034aec","name":"","statusCode":"","headers":{},"x":466.5,"y":26,"wires":[]}]