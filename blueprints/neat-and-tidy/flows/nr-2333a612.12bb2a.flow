{
  "id": "2333a612.12bb2a",
  "label": "Pipelines",
  "nodes": [
    {
      "id": "61969da4.8edb94",
      "type": "inject",
      "z": "2333a612.12bb2a",
      "name": "",
      "topic": "",
      "payload": "",
      "payloadType": "date",
      "repeat": "",
      "crontab": "",
      "once": false,
      "x": 98.5,
      "y": 75,
      "wires": [
        [
          "28217028.172f7"
        ]
      ]
    },
    {
      "id": "c8126364.1cb8e",
      "type": "debug",
      "z": "2333a612.12bb2a",
      "name": "",
      "active": true,
      "console": "false",
      "complete": "true",
      "x": 642.5,
      "y": 299,
      "wires": [

      ]
    },
    {
      "id": "8fc128bd.21b498",
      "type": "function",
      "z": "2333a612.12bb2a",
      "name": "Prepare",
      "func": "pl = msg.payload;\nname = pl.name;\nmsg0 = {\"payload\":{\"name\":name}, \"filename\":\"/tmp/environments-\" + name + \".json\"};\nmsg.env = {\"CONSUL_URL\": \"https://consul.service.dc1.consul:8080\"};\nmsg.payload = \"--lifecycle=wire --solution=gocd --action=post-object-v1 --args='{\\\"type\\\":\\\"environments\\\",\\\"name\\\":\\\"\" + name + \"\\\"}'\";\nmsg.req = \"dude\";\nmsg.res = \"shit\";\nmsg.topic = \"whatever\";\nreturn [msg0, msg, msg];\n\n",
      "outputs": "3",
      "noerr": 0,
      "x": 306.5,
      "y": 318,
      "wires": [
        [
          "420bc8b4.e9d448"
        ],
        [
          "d57f1c76.303a3",
          "5855d25f.abab8c"
        ],
        [

        ]
      ]
    },
    {
      "id": "420bc8b4.e9d448",
      "type": "file",
      "z": "2333a612.12bb2a",
      "name": "Prepare payload",
      "filename": "",
      "appendNewline": false,
      "createDir": false,
      "overwriteFile": "true",
      "x": 534.5,
      "y": 203,
      "wires": [

      ]
    },
    {
      "id": "784c37e0.cd2508",
      "type": "http in",
      "z": "2333a612.12bb2a",
      "name": "",
      "url": "/environments",
      "method": "post",
      "swaggerDoc": "",
      "x": 137.5,
      "y": 489,
      "wires": [
        [
          "3a6715f4.074efa",
          "314c7d76.abef02"
        ]
      ]
    },
    {
      "id": "28217028.172f7",
      "type": "function",
      "z": "2333a612.12bb2a",
      "name": "Default",
      "func": "msg.payload = {'name':'test'};\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 237.5,
      "y": 75,
      "wires": [
        [
          "8fc128bd.21b498"
        ]
      ]
    },
    {
      "id": "314c7d76.abef02",
      "type": "json-schema",
      "z": "2333a612.12bb2a",
      "name": "",
      "func": "{\n    \"$schema\": \"http://json-schema.org/draft-04/schema#\",\n    \"title\": \"Environment\",\n    \"type\": \"object\",\n    \"properties\": {\n        \"name\": {\n            \"description\": \"Name of the environment\",\n            \"type\": \"string\"\n        }\n    },\n    \"required\": [\"name\"]\n}",
      "x": 373.5,
      "y": 489,
      "wires": [
        [
          "8fc128bd.21b498"
        ]
      ]
    },
    {
      "id": "ce5c09bd.545018",
      "type": "comment",
      "z": "2333a612.12bb2a",
      "name": "curl -H \"Authorization: Bearer 33ef854766b61e7901ddc1c41f2fee8f693aa423\" -X POST https://escd27.canzea.cc/gw/api/environments --data 'name=dude5'",
      "info": "",
      "x": 550.5,
      "y": 682,
      "wires": [

      ]
    },
    {
      "id": "b8c2183d.343988",
      "type": "http response",
      "z": "2333a612.12bb2a",
      "name": "",
      "x": 987.5,
      "y": 364,
      "wires": [

      ]
    },
    {
      "id": "3a6715f4.074efa",
      "type": "debug",
      "z": "2333a612.12bb2a",
      "name": "",
      "active": true,
      "console": "false",
      "complete": "true",
      "x": 314,
      "y": 631,
      "wires": [

      ]
    },
    {
      "id": "58e09871.0576a8",
      "type": "switch",
      "z": "2333a612.12bb2a",
      "name": "",
      "property": "control.state",
      "propertyType": "msg",
      "rules": [
        {
          "t": "eq",
          "v": "start",
          "vt": "str"
        },
        {
          "t": "eq",
          "v": "running",
          "vt": "str"
        },
        {
          "t": "eq",
          "v": "errors",
          "vt": "str"
        },
        {
          "t": "eq",
          "v": "end",
          "vt": "str"
        }
      ],
      "checkall": "false",
      "outputs": 4,
      "x": 667.5,
      "y": 384,
      "wires": [
        [

        ],
        [

        ],
        [
          "645c70a3.6df13"
        ],
        [
          "98ff3e98.c461f"
        ]
      ]
    },
    {
      "id": "645c70a3.6df13",
      "type": "function",
      "z": "2333a612.12bb2a",
      "name": "Error",
      "func": "msg.payload = \"ERROR \" + JSON.stringify(msg.error);\nmsg.statusCode = 500;\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 819.5,
      "y": 294,
      "wires": [
        [
          "b8c2183d.343988"
        ]
      ]
    },
    {
      "id": "455992d7.14cd2c",
      "type": "catch",
      "z": "2333a612.12bb2a",
      "name": "",
      "scope": [
        "5855d25f.abab8c"
      ],
      "x": 644.5,
      "y": 247,
      "wires": [
        [
          "645c70a3.6df13"
        ]
      ]
    },
    {
      "id": "98ff3e98.c461f",
      "type": "function",
      "z": "2333a612.12bb2a",
      "name": "Success",
      "func": "msg.payload = null;\nmsg.statusCode = 200;\nmsg.topic = 'result';\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 814,
      "y": 462,
      "wires": [
        [
          "b8c2183d.343988"
        ]
      ]
    },
    {
      "id": "d57f1c76.303a3",
      "type": "debug",
      "z": "2333a612.12bb2a",
      "name": "",
      "active": true,
      "console": "false",
      "complete": "true",
      "x": 490,
      "y": 378,
      "wires": [

      ]
    },
    {
      "id": "5855d25f.abab8c",
      "type": "bigexec",
      "z": "2333a612.12bb2a",
      "name": "",
      "command": "/home/pm2user/canzea.sh",
      "commandArgs": "",
      "minError": 1,
      "minWarning": 1,
      "cwd": "/tmp",
      "shell": "",
      "extraArgumentProperty": "",
      "envProperty": "",
      "format": "utf8",
      "limiter": true,
      "payloadIs": "argumentNoStdin",
      "x": 480.5,
      "y": 299.5,
      "wires": [
        [
          "c8126364.1cb8e"
        ],
        [
          "c8126364.1cb8e",
          "58e09871.0576a8"
        ],
        [
          "c8126364.1cb8e"
        ]
      ]
    }
  ]
}